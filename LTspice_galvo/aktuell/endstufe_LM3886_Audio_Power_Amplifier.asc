Version 4
SHEET 1 2292 1376
WIRE 336 -752 304 -752
WIRE 368 -752 336 -752
WIRE 304 -736 304 -752
WIRE 1472 -672 1392 -672
WIRE 1616 -672 1536 -672
WIRE 304 -640 304 -656
WIRE 352 -640 304 -640
WIRE 368 -640 352 -640
WIRE 1872 -640 1808 -640
WIRE 2064 -640 1936 -640
WIRE 304 -624 304 -640
WIRE -96 -592 -128 -592
WIRE -80 -592 -96 -592
WIRE 1392 -592 1392 -672
WIRE 1520 -592 1392 -592
WIRE 1616 -592 1616 -672
WIRE 1616 -592 1600 -592
WIRE 1648 -592 1616 -592
WIRE 1936 -560 1808 -560
WIRE 2064 -560 2064 -640
WIRE 2064 -560 2016 -560
WIRE 2080 -560 2064 -560
WIRE 2176 -560 2160 -560
WIRE -96 -544 -128 -544
WIRE -80 -544 -96 -544
WIRE 304 -544 304 -560
WIRE 1536 -544 1520 -544
WIRE 1536 -528 1536 -544
WIRE 1952 -512 1936 -512
WIRE 2176 -512 2176 -560
WIRE -96 -496 -128 -496
WIRE -80 -496 -96 -496
WIRE 1952 -496 1952 -512
WIRE 1616 -480 1616 -592
WIRE 1616 -480 1568 -480
WIRE -96 -448 -128 -448
WIRE -80 -448 -96 -448
WIRE 304 -448 304 -464
WIRE 1296 -448 1280 -448
WIRE 1392 -448 1392 -592
WIRE 1392 -448 1360 -448
WIRE 1424 -448 1392 -448
WIRE 2064 -448 2064 -560
WIRE 2064 -448 1984 -448
WIRE 1680 -416 1648 -416
WIRE 1712 -416 1680 -416
WIRE 1808 -416 1808 -560
WIRE 1808 -416 1792 -416
WIRE 1840 -416 1808 -416
WIRE 1280 -384 1280 -448
WIRE 1296 -384 1280 -384
WIRE 1376 -384 1360 -384
WIRE 2176 -384 2176 -432
WIRE 2176 -384 1984 -384
WIRE 336 -352 304 -352
WIRE 384 -352 336 -352
WIRE 592 -352 576 -352
WIRE 640 -352 592 -352
WIRE 1488 -352 1488 -368
WIRE 1680 -352 1680 -416
WIRE 1536 -336 1536 -368
WIRE 1680 -336 1680 -352
WIRE 2176 -336 2176 -384
WIRE 304 -320 304 -352
WIRE 576 -320 576 -352
WIRE 1904 -320 1904 -336
WIRE 1376 -304 1376 -384
WIRE 1952 -304 1952 -336
WIRE 1680 -256 1680 -288
WIRE 304 -224 304 -240
WIRE 576 -224 576 -240
WIRE 16 -192 -48 -192
WIRE 96 -192 80 -192
WIRE 16 -128 -48 -128
WIRE 96 -128 96 -192
WIRE 96 -128 80 -128
WIRE 16 -64 -48 -64
WIRE 96 -64 96 -128
WIRE 96 -64 80 -64
WIRE 256 -64 96 -64
WIRE 288 -64 256 -64
WIRE 288 -32 288 -64
WIRE 16 -16 -32 -16
WIRE 96 -16 96 -64
WIRE 96 -16 80 -16
WIRE 608 -16 592 -16
WIRE 624 -16 608 -16
WIRE 592 0 592 -16
WIRE 352 16 320 16
WIRE 464 16 432 16
WIRE 560 16 512 16
WIRE 704 32 624 32
WIRE 816 32 704 32
WIRE 848 32 816 32
WIRE 464 48 464 16
WIRE 560 48 464 48
WIRE 288 80 288 64
WIRE 592 80 592 64
WIRE 608 80 592 80
WIRE 624 80 608 80
WIRE 848 128 848 32
WIRE 512 176 512 16
WIRE 560 176 512 176
WIRE 704 176 704 32
WIRE 704 176 640 176
WIRE 512 192 512 176
WIRE 848 240 848 208
WIRE 512 288 512 272
WIRE 512 368 512 352
FLAG -96 -544 V2-
FLAG -96 -592 V2+
FLAG -96 -448 V-
FLAG -96 -496 V+
FLAG -48 -64 stimac
FLAG -48 -128 stimOffs
FLAG -32 -16 0
FLAG -48 -192 stimpwl
FLAG 336 -752 stimOffs
FLAG 576 -224 0
FLAG 592 -352 calcSum
FLAG 304 -224 0
FLAG 336 -352 stimpwl
FLAG 304 -448 0
FLAG 352 -640 stimac
FLAG 2176 -336 0
FLAG 2176 -560 shunt
FLAG 1680 -256 0
FLAG 1728 -592 0
FLAG 1376 -304 stimac
FLAG 1648 -416 Isensa
FLAG 1552 -416 0
FLAG 1568 -416 0
FLAG 608 80 V+
FLAG 608 -16 V-
FLAG 576 128 0
FLAG 512 368 0
FLAG 288 80 0
FLAG 256 -64 in
FLAG 848 240 0
FLAG 816 32 out
SYMBOL source-Vmarker -128 -592 R0
SYMATTR Value V=12
SYMATTR InstName U4
SYMBOL source-Vmarker -128 -544 R0
SYMATTR Value V=-12V
SYMATTR InstName U5
SYMBOL source-Vmarker -128 -496 R0
SYMATTR Value V={Vsup}
SYMATTR InstName U6
SYMBOL source-Vmarker -128 -448 R0
SYMATTR Value V={-Vsup}
SYMATTR InstName U7
SYMBOL Misc\\jumper 48 -128 R0
SYMATTR InstName X1
SYMBOL source-V 304 -752 R0
WINDOW 0 -27 56 VBottom 2
WINDOW 3 184 44 Top 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value PULSE({Vstim_peak} 0 0 100u)
SYMBOL bv 576 -336 R0
WINDOW 3 49 50 Left 2
SYMATTR Value V=V(stimoffs)-V(isensa)
SYMATTR InstName B1
SYMBOL source-V 304 -336 R0
WINDOW 3 -112 173 Left 2
WINDOW 123 -311 -37 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PWL(0 0 200u 1u 201u {V1} 900u {V1-1u} 901u 0 1.6m 1u 1.601m {-V1} 2.3m {-V1+1u} 2.301m 0)
SYMATTR InstName V2
SYMBOL source-V 304 -560 R0
WINDOW 3 43 95 Left 2
WINDOW 123 43 67 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value SINE(20m 1 1k 1m)
SYMATTR Value2 AC 1
SYMATTR InstName V3
SYMBOL MDB_sym\\jumperRes 368 -592 R90
SYMATTR InstName U2
SYMBOL res 2160 -528 R0
SYMATTR InstName Rshunt1
SYMATTR Value 0.015
SYMBOL Opamps\\LTC2050 1952 -416 M0
SYMATTR InstName U3
SYMBOL source-Vmarker 1936 -512 R0
SYMATTR InstName U8
SYMBOL source-Vmarker 1952 -304 R180
SYMATTR Value V=-5V
SYMATTR InstName U9
SYMBOL res 1920 -544 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value 680
SYMBOL res 2176 -576 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 27
SYMBOL source-Vmarker 1904 -320 R0
SYMATTR InstName U10
SYMBOL Opamps\\LTC2050 1536 -448 M0
SYMATTR InstName U11
SYMBOL source-Vmarker 1520 -544 R0
SYMATTR InstName U12
SYMBOL source-Vmarker 1536 -336 R180
SYMATTR Value V=-5V
SYMATTR InstName U13
SYMBOL res 1504 -576 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value 180
SYMBOL res 1696 -400 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL source-Vmarker 1488 -352 R0
SYMATTR InstName U14
SYMBOL res 1632 -576 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R5
SYMATTR Value 20
SYMBOL Misc\\jumper 1328 -528 M0
SYMATTR InstName X2
SYMBOL cap 1664 -352 R0
SYMATTR InstName C1
SYMATTR Value {1/(2*pi*1k*100k)}
SYMBOL res 336 32 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL EXTRA\\Misc\\pot 288 16 M0
SYMATTR InstName U15
SYMATTR Value2 T=.05
SYMBOL res 496 176 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL res 656 160 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 200k
SYMBOL res 832 112 R0
SYMATTR InstName R9
SYMATTR Value 8
SYMBOL MDB_sym\\LM3886 592 96 M180
SYMATTR InstName U1
SYMBOL cap 496 288 R0
SYMATTR InstName C2
SYMATTR Value 10µ
TEXT -680 -96 Left 2 !; ---------------------\n;   Power amp\n; ---------------------\n;.param Rset_bias = 100\n;.param Ik3 = 1m\n;.param UV1 = 0.75V\n.param bias_be1 = 150\n;.param bias_b1 = {UV1/Ik3}\n.param bias_b1 = 750\n.param Lcoil = 170u
TEXT -936 -96 Left 2 !; ---------------------\n;   Compensator\n; ---------------------\n.param Rsu = 1k\n.param Kp = 70\n;.param Ki = 15000
TEXT -936 80 Left 2 !; ---------------------\n;   SOURCES\n; ---------------------\n.param Vsup = 20V\n.param Vstim_peak = 5
TEXT 344 -272 Left 2 !.param V1=1;
TEXT 240 -408 Left 2 ;PULSE({-Vstim_peak} {Vstim_peak} 0 100n 100n 1m 2m)\nPULSE({-Vstim_peak} {Vstim_peak} 0 100m 100n 500u 100m)
TEXT -928 -584 Left 2 ;;.tran 0 100m 1m\n;.options plotwinsize=0\n;.tran 0 2.8m 1.9m 1e-7\n.ac oct 100 10 1meg
TEXT -928 -448 Left 2 !.option noopiter\n.options plotwinsize=0\n.four 1k 10 I(L1)
TEXT -928 -480 Left 2 ;.dc V3 -5 5 .01
TEXT -928 -616 Left 2 ;.op
TEXT -928 -360 Left 2 ;.options plotwinsize=0
TEXT -920 -296 Left 2 !.tran 0 50m\n.options plotwinsize=0
TEXT 1872 -264 Left 2 ;Vu1= -10/3
TEXT 1480 -280 Left 2 ;Vu2 = 20
TEXT 2080 -264 Left 2 !.param clag=1f
RECTANGLE Normal -400 208 -992 -144 2
RECTANGLE Normal 944 -128 144 -784 2
RECTANGLE Normal -648 -224 -976 -640 2
