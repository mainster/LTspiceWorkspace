Version 4
SHEET 1 1316 720
WIRE -1264 -1328 -1296 -1328
WIRE -1232 -1328 -1264 -1328
WIRE -1296 -1296 -1296 -1328
WIRE -1296 -1184 -1296 -1216
WIRE -1264 -1184 -1296 -1184
WIRE -1232 -1184 -1264 -1184
WIRE -1296 -1136 -1296 -1184
WIRE 272 -1072 272 -1120
WIRE 368 -1072 368 -1120
WIRE -304 -1056 -304 -1088
WIRE -1296 -1040 -1296 -1056
WIRE 16 -976 16 -1088
WIRE 16 -976 -128 -976
WIRE 272 -944 272 -992
WIRE 368 -944 368 -992
WIRE 368 -944 272 -944
WIRE -304 -928 -304 -976
WIRE -224 -928 -304 -928
WIRE -192 -928 -224 -928
WIRE 16 -928 16 -976
WIRE -592 -912 -1792 -912
WIRE -304 -912 -304 -928
WIRE 368 -912 368 -944
WIRE -560 -896 -1776 -896
WIRE -592 -880 -1760 -880
WIRE -128 -848 -128 -880
WIRE -80 -848 -128 -848
WIRE -32 -848 -80 -848
WIRE -304 -816 -304 -832
WIRE -128 -784 -128 -848
WIRE -96 -784 -128 -784
WIRE 16 -784 16 -832
WIRE 16 -784 -16 -784
WIRE 16 -736 16 -784
WIRE -528 -720 -544 -720
WIRE -528 -704 -528 -720
WIRE -560 -688 -592 -688
WIRE -464 -672 -496 -672
WIRE -400 -672 -464 -672
WIRE -304 -672 -304 -752
WIRE -304 -672 -336 -672
WIRE -240 -672 -304 -672
WIRE -560 -656 -608 -656
WIRE -464 -656 -464 -672
WIRE -240 -640 -240 -672
WIRE -528 -624 -528 -640
WIRE -528 -624 -544 -624
WIRE -304 -608 -304 -672
WIRE -608 -560 -608 -656
WIRE -464 -560 -464 -592
WIRE -464 -560 -608 -560
WIRE -416 -560 -464 -560
WIRE -240 -560 -240 -576
WIRE -240 -560 -336 -560
WIRE 16 -560 16 -656
WIRE 16 -560 -240 -560
WIRE 128 -560 16 -560
WIRE 160 -560 128 -560
WIRE 256 -560 224 -560
WIRE -1824 -544 -1840 -544
WIRE -1792 -544 -1792 -912
WIRE -1792 -544 -1824 -544
WIRE -1760 -544 -1760 -880
WIRE -1728 -544 -1760 -544
WIRE -1712 -544 -1728 -544
WIRE -1776 -528 -1776 -896
WIRE -304 -528 -304 -608
WIRE -304 -528 -432 -528
WIRE 16 -528 16 -560
WIRE -608 -496 -608 -560
WIRE -304 -496 -304 -528
WIRE -2208 -432 -2240 -432
WIRE -2128 -432 -2144 -432
WIRE -2080 -432 -2128 -432
WIRE -1968 -432 -2000 -432
WIRE -1920 -432 -1968 -432
WIRE -1824 -432 -1840 -432
WIRE -1248 -416 -1280 -416
WIRE -1136 -416 -1168 -416
WIRE -432 -416 -432 -528
WIRE 256 -416 256 -560
WIRE -96 -400 -128 -400
WIRE 16 -400 16 -448
WIRE 16 -400 -16 -400
WIRE -2240 -384 -2272 -384
WIRE -2208 -384 -2240 -384
WIRE -2128 -384 -2128 -432
WIRE -2128 -384 -2144 -384
WIRE -1888 -368 -1904 -368
WIRE -304 -368 -304 -432
WIRE 16 -368 16 -400
WIRE -1888 -352 -1888 -368
WIRE -1200 -352 -1216 -352
WIRE 16 -352 16 -368
WIRE -1968 -336 -1968 -432
WIRE -1920 -336 -1968 -336
WIRE -1200 -336 -1200 -352
WIRE -128 -336 -128 -400
WIRE -64 -336 -128 -336
WIRE -32 -336 -64 -336
WIRE -1824 -320 -1824 -432
WIRE -1824 -320 -1856 -320
WIRE -1776 -320 -1824 -320
WIRE -1728 -320 -1776 -320
WIRE -1632 -320 -1648 -320
WIRE -1568 -320 -1632 -320
WIRE -1536 -320 -1568 -320
WIRE -1376 -320 -1472 -320
WIRE -1280 -320 -1280 -416
WIRE -1280 -320 -1296 -320
WIRE -1232 -320 -1280 -320
WIRE -1040 -320 -1072 -320
WIRE -928 -320 -976 -320
WIRE -896 -320 -928 -320
WIRE -608 -320 -608 -352
WIRE -608 -320 -896 -320
WIRE -432 -320 -432 -352
WIRE -432 -320 -608 -320
WIRE -2208 -304 -2240 -304
WIRE -2128 -304 -2144 -304
WIRE -2096 -304 -2128 -304
WIRE -1968 -304 -2016 -304
WIRE -1920 -304 -1968 -304
WIRE -1728 -304 -1728 -320
WIRE -1136 -304 -1136 -416
WIRE -1136 -304 -1168 -304
WIRE -1072 -304 -1072 -320
WIRE -1072 -304 -1136 -304
WIRE -128 -304 -128 -336
WIRE -1232 -288 -1264 -288
WIRE -1888 -272 -1888 -288
WIRE -1888 -272 -1904 -272
WIRE -1568 -272 -1568 -320
WIRE -1536 -272 -1568 -272
WIRE -1392 -272 -1472 -272
WIRE 256 -272 256 -336
WIRE 656 -272 256 -272
WIRE -2240 -256 -2272 -256
WIRE -2208 -256 -2240 -256
WIRE -2128 -256 -2128 -304
WIRE -2128 -256 -2144 -256
WIRE -1200 -256 -1200 -272
WIRE -1200 -256 -1216 -256
WIRE -304 -256 -304 -288
WIRE -240 -256 -304 -256
WIRE -192 -256 -240 -256
WIRE -1968 -240 -1968 -304
WIRE -1584 -240 -1584 -256
WIRE 256 -240 256 -272
WIRE -304 -224 -304 -256
WIRE 656 -224 656 -272
WIRE 16 -208 16 -256
WIRE 16 -208 -128 -208
WIRE -1392 -192 -1392 -272
WIRE -1200 -192 -1392 -192
WIRE -1040 -192 -1120 -192
WIRE -896 -192 -896 -320
WIRE -896 -192 -976 -192
WIRE -1200 -176 -1200 -192
WIRE -1968 -144 -1968 -160
WIRE -304 -128 -304 -144
WIRE -1200 -112 -1200 -128
WIRE 656 -96 656 -144
WIRE -1584 -80 -1584 -96
WIRE 16 -80 16 -208
WIRE 16 -80 0 -80
WIRE 256 -48 256 -160
WIRE 416 -48 256 -48
WIRE 736 -32 704 -32
WIRE -1584 -16 -1584 -32
WIRE 736 0 736 -32
WIRE -1696 16 -1968 16
WIRE -1584 16 -1584 -16
WIRE -1584 16 -1696 16
WIRE -1552 16 -1584 16
WIRE -1120 16 -1472 16
WIRE 256 16 256 -48
WIRE 256 16 -1040 16
WIRE 288 16 256 16
WIRE 416 16 416 -48
WIRE 656 16 656 -16
WIRE 656 16 416 16
WIRE 736 16 736 0
WIRE -1040 32 -1040 16
WIRE 256 32 256 16
WIRE -2000 48 -2000 -80
WIRE 128 112 128 48
WIRE 256 112 128 112
WIRE 256 128 256 112
WIRE 736 128 736 80
WIRE -1056 336 -1072 336
WIRE -976 336 -1056 336
WIRE -864 336 -896 336
WIRE -816 336 -864 336
WIRE 368 352 368 320
WIRE -864 368 -864 336
WIRE -864 384 -864 368
WIRE 480 400 480 352
WIRE 368 448 368 432
WIRE 416 448 368 448
WIRE 368 496 368 448
WIRE -864 512 -864 496
WIRE 736 512 736 464
WIRE 480 528 480 496
WIRE 480 528 400 528
WIRE 480 560 480 528
WIRE 736 640 736 592
WIRE 368 656 368 560
WIRE 432 656 368 656
WIRE 480 656 480 640
WIRE 480 656 432 656
FLAG 128 -560 out_A
FLAG -64 -336 Gp1
FLAG 16 -368 Sp1
FLAG 16 -784 Sn1
FLAG -80 -848 Gn1
FLAG 432 656 Vmin
FLAG 368 -912 0
FLAG -224 -928 b1
FLAG -240 -256 b2
FLAG 256 128 0
FLAG 480 272 0
FLAG 736 464 Vcs
FLAG 736 640 0
FLAG 768 656 0
FLAG -1456 672 0
FLAG 288 16 shunt
FLAG 272 -1120 V+
FLAG 16 -1088 V+
FLAG 368 320 V+
FLAG 368 -1120 V-
FLAG 0 -80 V-
FLAG -592 -688 0
FLAG -528 -624 V+
FLAG -528 -720 V-
FLAG -1264 -288 0
FLAG -1888 -272 V-
FLAG -1200 -256 V-
FLAG -1888 -368 V+
FLAG -1200 -352 V+
FLAG -1296 -1040 0
FLAG -1264 -1184 stimac
FLAG -1264 -1328 stimOffs
FLAG -304 -1168 V+
FLAG -304 -48 V-
FLAG -304 -608 dd
FLAG -592 -880 V+
FLAG -592 -912 V-
FLAG -560 -896 0
FLAG -1824 -544 V-
FLAG -1728 -544 V+
FLAG -1776 -528 0
FLAG -2000 -80 0
FLAG -1584 -256 0
FLAG -1696 16 IsensF
FLAG -864 512 0
FLAG -816 336 fbfil
FLAG -1056 336 stimoffs
FLAG 736 128 0
FLAG 768 144 0
FLAG 704 -80 0
FLAG -2240 -304 IsensF
FLAG -2240 -432 stimac
FLAG -1632 -320 diff2
FLAG -928 -320 Prop
FLAG -1968 -144 0
FLAG -1648 -240 0
FLAG -1728 -256 0
FLAG -1776 -320 diff1
FLAG -1120 96 0
FLAG -1040 80 0
FLAG -2240 -384 IsensF
FLAG -2240 -256 stimac
FLAG -1200 -112 0
FLAG -1120 -112 0
SYMBOL res -112 -768 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value {bias}
SYMBOL res 0 -384 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 78 92 VBottom 2
SYMATTR InstName R2
SYMATTR Value {bias*te}
SYMBOL res 240 -256 R0
SYMATTR InstName Rload1
SYMATTR Value {1.5}
SYMBOL EIT_Semiconductors\\nmos -32 -928 R0
SYMATTR InstName M1
SYMATTR Value IRFP240
SYMBOL EIT_Semiconductors\\pmos -32 -256 M180
SYMATTR InstName M2
SYMATTR Value IRFP9240
SYMBOL ind 240 -432 R0
SYMATTR InstName L1
SYMATTR Value 170f
SYMBOL res 384 336 M0
SYMATTR InstName R10
SYMATTR Value 4.7k
SYMBOL EIT_Semiconductors\\npn 416 400 R0
SYMATTR InstName Q1
SYMATTR Value BC547B
SYMBOL res 464 544 R0
SYMATTR InstName R11
SYMATTR Value 315
SYMBOL source-V 272 -1088 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -87 92 Left 2
SYMATTR Value {vsup}
SYMATTR InstName V1
SYMBOL source-V 368 -1088 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -72 98 Left 2
SYMATTR Value {-vsup}
SYMATTR InstName V2
SYMBOL res -320 -240 R0
SYMATTR InstName R12
SYMATTR Value 1m
SYMBOL res -320 -1072 R0
SYMATTR InstName R13
SYMATTR Value 1m
SYMBOL source-I -304 -1088 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I1
SYMATTR Value {ik1}
SYMBOL source-I -304 -48 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I2
SYMATTR Value {Ik1}
SYMBOL res 240 16 R0
SYMATTR InstName R5
SYMATTR Value {0.1+(100t*jp)}
SYMBOL res 0 -752 R0
SYMATTR InstName R8
SYMATTR Value {Rs}
SYMBOL res 0 -544 R0
SYMATTR InstName R9
SYMATTR Value {Rs}
SYMBOL res 464 256 R0
SYMATTR InstName R16
SYMATTR Value 100
SYMBOL source-V 736 496 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -87 92 Left 2
SYMATTR Value 30
SYMATTR InstName V8
SYMBOL Misc\\jumper 192 -624 R0
SYMATTR InstName X1
SYMBOL EXTRA\\VolReg\\TL431 384 496 M0
SYMATTR InstName U2
SYMBOL res -624 -400 M180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL res -432 -576 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 32 57 VTop 2
SYMATTR InstName R17
SYMATTR Value 10k
SYMBOL res -1264 -400 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R18
SYMATTR Value {10k}
SYMBOL res -1392 -304 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL res -1984 -416 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R21
SYMATTR Value {Rsu}
SYMBOL res -2112 -288 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R22
SYMATTR Value {Rsu}
SYMBOL res -1936 -416 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R23
SYMATTR Value {Rsu}
SYMBOL res -1952 -144 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R24
SYMATTR Value {Rsu}
SYMBOL voltage -1296 -1152 R0
WINDOW 123 -460 275 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -460 247 Left 2
SYMATTR Value2 AC 1
SYMATTR Value PULSE(0 1 0 100m)
SYMATTR InstName Vstim1
SYMBOL source-V -1296 -1312 R0
WINDOW 0 -27 56 VBottom 2
WINDOW 3 -223 300 Top 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value PULSE({Vstim_peak} 0 0.5m 50n 50n 1)
SYMBOL res -320 -928 R0
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res -320 -384 R0
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL Misc\\jumper -368 -736 R0
SYMATTR InstName X3
SYMBOL diode -320 -816 R0
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode -320 -496 R0
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL NJM4580 -1888 -384 R0
SYMATTR InstName U3
SYMBOL NJM4580 -1200 -368 R0
SYMATTR InstName U5
SYMBOL NJM4580 -528 -608 M180
WINDOW 3 -82 164 Left 2
SYMATTR InstName U1
SYMBOL EIT_Semiconductors\\npn -192 -976 R0
SYMATTR InstName T1
SYMATTR Value 2N2222
SYMBOL EIT_Semiconductors\\pnp -192 -208 M180
SYMATTR InstName T2
SYMATTR Value 2N4403
SYMBOL cap -480 -656 R0
SYMATTR InstName C2
SYMATTR Value {cm}
SYMBOL Misc\\jumper -1520 -208 R90
SYMATTR InstName X2
SYMBOL res -1456 0 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R6
SYMATTR Value {1/(2*pi*Cf*100k)}
SYMBOL cap -1568 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C1
SYMATTR Value {Cf}
SYMBOL Misc\\jumper -928 464 R270
SYMATTR InstName X4
SYMBOL res -992 352 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 73 60 VBottom 2
SYMATTR InstName R14
SYMATTR Value {1/(2*pi*Cf*250k)}
SYMBOL cap -880 368 R0
SYMATTR InstName C3
SYMATTR Value {Cf}
SYMBOL res -1568 -80 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R15
SYMATTR Value {1u+100t*filoff}
SYMBOL Misc\\jumper -1504 -336 R0
SYMATTR InstName X5
SYMBOL res 640 -240 R0
SYMATTR InstName R19
SYMATTR Value 2
SYMBOL sw 656 -112 M0
SYMATTR InstName S1
SYMATTR Value SWx
SYMBOL source-V 736 -16 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -87 92 Left 2
SYMATTR Value PULSE(-1 1 70m 500u 100u 10m)
SYMATTR InstName V3
SYMBOL crtl-V-V -1648 -336 R0
SYMATTR InstName E1
SYMATTR Value 1
SYMBOL Misc\\jumper -544 -384 R90
SYMATTR InstName X6
SYMBOL crtl-V-V -1120 0 M0
SYMATTR InstName E2
SYMATTR Value 30
SYMBOL Misc\\jumper -2176 -448 R0
SYMATTR InstName X7
SYMBOL Misc\\jumper -2176 -320 R0
SYMATTR InstName X8
SYMBOL crtl-V-V -1120 -208 R0
SYMATTR InstName E3
SYMATTR Value -10
SYMBOL Misc\\jumper -1008 -256 R0
SYMATTR InstName X9
TEXT -688 304 Left 2 !.model npnx npn (Bf=200 Is={10m/exp(0.7/26m)}\n.model pnpx pnp (Bf=200 Is={10m/exp(0.7/26m)}\n.model Dx D (Is={(20*50u)/exp(0.7/26m)}\n.model Osw SW(Ron=10u Roff=10meg Vt=12 Vh=-.2)
TEXT 128 -1280 Left 2 !;ac oct 100 1 100meg
TEXT 248 -1360 Left 2 !.tran 100m
TEXT -984 -1248 Left 2 !; ---------------------\n;   Power amp\n; ---------------------\n.param Ik1 = 4.2m\n.param bias = 420\n.param bias_b = 200\n.param Rs = 1u
TEXT -680 -1496 Left 2 !; ---------------------\n;   Compensator\n; ---------------------\n.param Rsu = 10k\n.param Kpv = 2\n.param Gain = 1
TEXT -984 -1456 Left 2 !; ---------------------\n;   SOURCES\n; ---------------------\n.param Vsup =  12\n.param Ipeak = 10A\n.param Vstim_peak = 1
TEXT 248 -1336 Left 2 !.option noopiter
TEXT 232 -768 Left 2 !;ac oct 100 1 10meg
TEXT -656 -1296 Left 3 ;PCB mit fix
TEXT -2560 -616 Left 3 ;Externer Regler
TEXT 96 -48 Left 2 !.param jp = 0
TEXT -48 280 Left 2 ;.step param jp list 0 1
TEXT -1232 -1048 Left 2 !.param Cm = 10p\n;step param cm list 1p 10p 50p 150p 500p
TEXT -600 -1224 Left 2 ;.step param Kpv list 1 2 5 10
TEXT -656 -1168 Left 2 ;.step param Gain 1 10 2
TEXT -984 120 Left 2 ;.step param filoff list 1 0
TEXT -1616 72 Left 2 ;{1/(2*pi*Cf*250k)}
TEXT -1096 392 Left 2 !.param Cf = 1n
TEXT -1608 -416 Left 2 !.param filoff = 0
TEXT -144 -496 Left 2 ;{bias*0.7}
TEXT -552 -232 Left 2 !.param te = 1;
TEXT -576 -1008 Left 2 !;tran 40m
TEXT -2488 -944 Left 2 ;PULSE({-Vstim_peak} {Vstim_peak} 0.5m 50n 50n 1m 2m)
TEXT -1008 616 Left 2 !.model SWx SW(Ron=1u Roff=100Meg Vt=0 Vh=-.5 )
RECTANGLE Normal 448 224 -672 -1264 1
RECTANGLE Normal -1680 -48 -2576 -576 2
