Version 4
SHEET 1 1316 868
WIRE -1264 -1328 -1296 -1328
WIRE -1232 -1328 -1264 -1328
WIRE -1296 -1296 -1296 -1328
WIRE -1296 -1184 -1296 -1216
WIRE -1264 -1184 -1296 -1184
WIRE -1232 -1184 -1264 -1184
WIRE -1296 -1136 -1296 -1184
WIRE 272 -1072 272 -1120
WIRE 368 -1072 368 -1120
WIRE -304 -1056 -304 -1088
WIRE -1296 -1040 -1296 -1056
WIRE 16 -976 16 -1088
WIRE 16 -976 -128 -976
WIRE 272 -944 272 -992
WIRE 368 -944 368 -992
WIRE 368 -944 272 -944
WIRE -304 -928 -304 -976
WIRE -224 -928 -304 -928
WIRE -192 -928 -224 -928
WIRE 16 -928 16 -976
WIRE -304 -912 -304 -928
WIRE 368 -912 368 -944
WIRE -128 -848 -128 -880
WIRE -80 -848 -128 -848
WIRE -32 -848 -80 -848
WIRE -304 -816 -304 -832
WIRE -128 -784 -128 -848
WIRE -96 -784 -128 -784
WIRE 16 -784 16 -832
WIRE 16 -784 -16 -784
WIRE 16 -736 16 -784
WIRE -528 -720 -544 -720
WIRE -432 -720 -464 -720
WIRE -400 -720 -432 -720
WIRE -304 -720 -304 -752
WIRE -304 -720 -336 -720
WIRE -528 -704 -528 -720
WIRE -560 -688 -592 -688
WIRE -464 -672 -496 -672
WIRE -400 -672 -464 -672
WIRE -304 -672 -304 -720
WIRE -304 -672 -336 -672
WIRE -240 -672 -304 -672
WIRE -560 -656 -608 -656
WIRE -464 -656 -464 -672
WIRE -240 -640 -240 -672
WIRE -528 -624 -528 -640
WIRE -528 -624 -544 -624
WIRE -304 -608 -304 -672
WIRE -608 -560 -608 -656
WIRE -464 -560 -464 -592
WIRE -464 -560 -608 -560
WIRE -416 -560 -464 -560
WIRE -240 -560 -240 -576
WIRE -240 -560 -336 -560
WIRE 16 -560 16 -656
WIRE 16 -560 -240 -560
WIRE 128 -560 16 -560
WIRE 160 -560 128 -560
WIRE 256 -560 224 -560
WIRE 16 -528 16 -560
WIRE -608 -496 -608 -560
WIRE -304 -496 -304 -608
WIRE 608 -496 496 -496
WIRE -1184 -448 -1200 -448
WIRE -1072 -448 -1104 -448
WIRE -1024 -448 -1072 -448
WIRE -928 -448 -944 -448
WIRE 608 -448 608 -496
WIRE 256 -416 256 -560
WIRE -96 -400 -128 -400
WIRE 16 -400 16 -448
WIRE 16 -400 -16 -400
WIRE -992 -384 -1008 -384
WIRE -992 -368 -992 -384
WIRE -304 -368 -304 -432
WIRE 16 -368 16 -400
WIRE -1072 -352 -1072 -448
WIRE -1024 -352 -1072 -352
WIRE 16 -352 16 -368
WIRE -928 -336 -928 -448
WIRE -928 -336 -960 -336
WIRE -864 -336 -928 -336
WIRE -128 -336 -128 -400
WIRE -64 -336 -128 -336
WIRE -32 -336 -64 -336
WIRE -1232 -320 -1296 -320
WIRE -1200 -320 -1232 -320
WIRE -1072 -320 -1120 -320
WIRE -1024 -320 -1072 -320
WIRE -640 -320 -752 -320
WIRE -608 -320 -608 -416
WIRE -608 -320 -640 -320
WIRE 256 -320 256 -336
WIRE 496 -320 496 -496
WIRE 496 -320 256 -320
WIRE 608 -320 608 -368
WIRE -128 -304 -128 -336
WIRE -992 -288 -992 -304
WIRE -992 -288 -1008 -288
WIRE -1424 -256 -1456 -256
WIRE -1312 -256 -1344 -256
WIRE -1072 -256 -1072 -320
WIRE -304 -256 -304 -288
WIRE -240 -256 -304 -256
WIRE -192 -256 -240 -256
WIRE 688 -256 656 -256
WIRE -304 -224 -304 -256
WIRE 688 -224 688 -256
WIRE 16 -208 16 -256
WIRE 16 -208 -128 -208
WIRE 256 -208 256 -240
WIRE 608 -208 608 -240
WIRE 608 -208 256 -208
WIRE 688 -208 688 -224
WIRE -1376 -192 -1392 -192
WIRE -1376 -176 -1376 -192
WIRE -1552 -160 -1584 -160
WIRE -1456 -160 -1456 -256
WIRE -1456 -160 -1472 -160
WIRE -1408 -160 -1456 -160
WIRE -1312 -144 -1312 -256
WIRE -1312 -144 -1344 -144
WIRE -1264 -144 -1312 -144
WIRE -1248 -144 -1264 -144
WIRE -1072 -144 -1072 -176
WIRE -1040 -144 -1072 -144
WIRE -1008 -144 -1040 -144
WIRE -1408 -128 -1440 -128
WIRE -304 -128 -304 -144
WIRE -1376 -96 -1376 -112
WIRE -1376 -96 -1392 -96
WIRE 688 -96 688 -144
WIRE 16 -80 16 -208
WIRE 16 -80 0 -80
WIRE -544 16 -1248 16
WIRE 64 16 -544 16
WIRE 256 16 256 -208
WIRE 256 16 144 16
WIRE 288 16 256 16
WIRE 64 48 64 16
WIRE 256 48 256 16
WIRE 144 64 144 16
WIRE 64 160 64 128
WIRE 144 160 144 112
WIRE 256 160 256 128
WIRE 368 352 368 320
WIRE 480 400 480 352
WIRE 368 448 368 432
WIRE 416 448 368 448
WIRE 368 496 368 448
WIRE 736 512 736 464
WIRE 480 528 480 496
WIRE 480 528 400 528
WIRE 480 560 480 528
WIRE 736 640 736 592
WIRE 368 656 368 560
WIRE 432 656 368 656
WIRE 480 656 480 640
WIRE 480 656 432 656
FLAG 128 -560 out_A
FLAG -64 -336 Gp1
FLAG 16 -368 Sp1
FLAG 16 -784 Sn1
FLAG -80 -848 Gn1
FLAG 432 656 Vmin
FLAG 368 -912 0
FLAG -224 -928 b1
FLAG -240 -256 b2
FLAG 256 160 0
FLAG 480 272 0
FLAG 736 464 Vcs
FLAG 736 640 0
FLAG 768 656 0
FLAG 288 16 shunt
FLAG 272 -1120 V+
FLAG 16 -1088 V+
FLAG 368 320 V+
FLAG 368 -1120 V-
FLAG 0 -80 V-
FLAG -592 -688 0
FLAG -528 -624 V+
FLAG -528 -720 V-
FLAG -1440 -128 0
FLAG -1200 -448 0
FLAG -992 -288 V-
FLAG -1376 -96 V-
FLAG -992 -384 V+
FLAG -1376 -192 V+
FLAG -1264 -144 preAmp
FLAG 64 160 0
FLAG 144 160 0
FLAG -1584 -160 stimoffs
FLAG -1296 -1040 0
FLAG -1264 -1184 stimac
FLAG -1264 -1328 stimOffs
FLAG -304 -1168 V+
FLAG -304 -48 V-
FLAG -304 -608 dd
FLAG -544 16 Isens
FLAG -432 -720 ctrl
FLAG -640 -320 ctrl
FLAG 656 -304 0
FLAG 688 -96 0
FLAG -1040 -144 Isens
FLAG -1232 -320 preAmp
FLAG -864 -336 ctrl
SYMBOL res -112 -768 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value {bias}
SYMBOL res 0 -384 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 78 92 VBottom 2
SYMATTR InstName R2
SYMATTR Value {bias*0.7}
SYMBOL res 240 -336 R0
SYMATTR InstName Rload1
SYMATTR Value 1.5
SYMBOL EIT_Semiconductors\\nmos -32 -928 R0
SYMATTR InstName M1
SYMATTR Value IRFP240
SYMBOL EIT_Semiconductors\\pmos -32 -256 M180
SYMATTR InstName M2
SYMATTR Value IRFP9240
SYMBOL ind 240 -432 R0
SYMATTR InstName L1
SYMATTR Value 170µ
SYMBOL res 384 336 M0
SYMATTR InstName R10
SYMATTR Value 4.7k
SYMBOL EIT_Semiconductors\\npn 416 400 R0
SYMATTR InstName Q1
SYMATTR Value BC547B
SYMBOL res 464 544 R0
SYMATTR InstName R11
SYMATTR Value 315
SYMBOL source-V 272 -1088 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -87 92 Left 2
SYMATTR Value {vsup}
SYMATTR InstName V1
SYMBOL source-V 368 -1088 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -72 98 Left 2
SYMATTR Value {-vsup}
SYMATTR InstName V2
SYMBOL res -320 -240 R0
SYMATTR InstName R12
SYMATTR Value 1m
SYMBOL res -320 -1072 R0
SYMATTR InstName R13
SYMATTR Value 1m
SYMBOL source-I -304 -1088 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I1
SYMATTR Value {IK1}
SYMBOL source-I -304 -48 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I2
SYMATTR Value {Ik1}
SYMBOL res 240 32 R0
SYMATTR InstName R5
SYMATTR Value {0.1+(100t*jp)}
SYMBOL res 0 -752 R0
SYMATTR InstName R8
SYMATTR Value {Rs}
SYMBOL res 0 -544 R0
SYMATTR InstName R9
SYMATTR Value {Rs}
SYMBOL res 464 256 R0
SYMATTR InstName R16
SYMATTR Value 100
SYMBOL source-V 736 496 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -87 92 Left 2
SYMATTR Value 30
SYMATTR InstName V8
SYMBOL Misc\\jumper 192 -624 R0
SYMATTR InstName X1
SYMBOL EXTRA\\VolReg\\TL431 384 496 M0
SYMATTR InstName U2
SYMBOL res -624 -400 M180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL res -432 -576 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 32 57 VTop 2
SYMATTR InstName R17
SYMATTR Value {10k*10}
SYMBOL res -1440 -240 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R18
SYMATTR Value {10k*Gain}
SYMBOL res -1568 -144 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL res -1088 -432 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R21
SYMATTR Value {Rsu}
SYMBOL res -1216 -304 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R22
SYMATTR Value {Rsu}
SYMBOL res -1040 -432 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R23
SYMATTR Value {Rsu}
SYMBOL res -1056 -160 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R24
SYMATTR Value {Rsu}
SYMBOL crtl-V-V 64 32 M0
SYMATTR InstName E2
SYMATTR Value 1
SYMBOL voltage -1296 -1152 R0
WINDOW 123 -460 275 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -460 247 Left 2
SYMATTR Value2 AC 1
SYMATTR Value PULSE({-Vstim_peak} {Vstim_peak} 0.5m 50n 50n 1 2m)
SYMATTR InstName Vstim1
SYMBOL source-V -1296 -1312 R0
WINDOW 0 -27 56 VBottom 2
WINDOW 3 -223 300 Top 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value PULSE({Vstim_peak} 0 0.5m 50n 50n 1)
SYMBOL res -320 -928 R0
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res -320 -384 R0
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL Misc\\jumper -368 -736 R0
SYMATTR InstName X3
SYMBOL diode -320 -816 R0
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode -320 -496 R0
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL NJM4580 -992 -400 R0
SYMATTR InstName U3
SYMBOL NJM4580 -1376 -208 R0
SYMATTR InstName U5
SYMBOL NJM4580 -528 -608 M180
WINDOW 3 -82 164 Left 2
SYMATTR InstName U1
SYMBOL EIT_Semiconductors\\npn -192 -976 R0
SYMATTR InstName T1
SYMATTR Value 2N2222
SYMBOL EIT_Semiconductors\\pnp -192 -208 M180
SYMATTR InstName T2
SYMATTR Value 2N4403
SYMBOL cap -480 -656 R0
SYMATTR InstName C2
SYMATTR Value {cm}
SYMBOL res 592 -464 R0
SYMATTR InstName R6
SYMATTR Value 2
SYMBOL sw 608 -336 M0
SYMATTR InstName S1
SYMATTR Value SWx
SYMBOL source-V 688 -240 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -87 92 Left 2
SYMATTR Value PULSE(-1 1 3m 500u 100u 5m)
SYMATTR InstName V3
TEXT -688 304 Left 2 !.model npnx npn (Bf=200 Is={10m/exp(0.7/26m)}\n.model pnpx pnp (Bf=200 Is={10m/exp(0.7/26m)}\n.model Dx D (Is={(20*50u)/exp(0.7/26m)}\n.model Osw SW(Ron=10u Roff=10meg Vt=12 Vh=-.2)
TEXT 128 -1280 Left 2 !;ac oct 100 1 100meg
TEXT 248 -1360 Left 2 ;.dc Vstim1 -0.1 0.1 0.0001
TEXT -984 -1248 Left 2 !; ---------------------\n;   Power amp\n; ---------------------\n.param Ik1 = 4.2m\n.param bias = 420\n.param bias_b = 200\n.param Rs = 1u
TEXT -680 -1496 Left 2 !; ---------------------\n;   Compensator\n; ---------------------\n.param Rsu = 10k\n.param Kpv = 3\n.param Gain = 1
TEXT -984 -1456 Left 2 !; ---------------------\n;   SOURCES\n; ---------------------\n.param Vsup =  12\n.param Ipeak = 10A\n.param Vstim_peak = 3
TEXT 248 -1336 Left 2 !.option noopiter
TEXT 232 -768 Left 2 !.tran 5m
TEXT -656 -1296 Left 3 ;PCB mit fix
TEXT -1664 -632 Left 3 ;Externer Regler
TEXT 96 -48 Left 2 !.param jp = 0
TEXT -48 280 Left 2 ;.step param jp list 0 1
TEXT -920 -848 Left 2 !.param Cm = 10p\n;.step param cm list 1p 10p 50p 150p 500p
TEXT -592 -1208 Left 2 ;.step param gain list 1 2 5 8
TEXT -1320 -672 Left 2 ;.step param Gain list 1 2 3 5
TEXT -376 544 Left 2 !.model SWx SW(Ron=1u Roff=100Meg Vt=0 Vh=-.5 )
RECTANGLE Normal 448 224 -672 -1264 1
RECTANGLE Normal -784 -64 -1680 -592 2
