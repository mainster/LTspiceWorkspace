* Z:\home\mainster\CODES_local\LTSpice_projects\galvoscanner\aktuell\bauteile_bestimmt\endstufe_BJT_EMIT_MJ1101xG_ltc6090_inkl_transducer_digital_offset_FERTIG.asc
R14 N018 shunt 1.5
L1 out_A N018 170µ
Rshunt shunt 0 0.01
R4 out_A N006 1t
C2 N006 0 100n
E4 fbSens 0 shunt 0 -25
R5 fbSens jjIsensA 1
C1 jjIsensA 0 1n
XU1 Vp vdc_single V=16
XU2 Vm vdc_single V=-16
R2 N015 IsensA {Rsu}
R6 stimDigOff N008 {Rsu}
R7 N015 sumB {Rsu}
R8 0 N008 {Rsu}
XU4 N008 N015 Vp Vm sumB NJM4580_1
R13 sumB N012 10k
XU5 0 N014 0 V- NC_01 opV V+ NC_02 LTC6090
R16 sumBinv N014 10k
R17 N014 out_A {10k*Kpi}
Q§T3 V+ bias_hi1 b_hi 0 FMMT624
Q§T4 V- bias_lo2 b_lo 0 FMMT723
R23 b_hi e_hi {bias_be1}
R24 e_lo b_lo {bias_be1}
R25 bias_hi1 bias_hi2 {bias_b1}
R26 bias_lo1 bias_lo2 {bias_b1}
I3 V+ bias_hi1 {IK3} load
I4 bias_lo2 V- {Ik3} load
R37 e_hi out_A {Rs}
R38 e_lo out_A {Rs}
C6 e_lo b_lo 10p
C7 b_hi e_hi 10p
XU6 V- b_lo e_lo MJ11015G_D MJ11015G_D
XU7 V+ b_hi e_hi MJ11016G_D MJ11016G_D
D8 N001 opV 1N4148
D10 opV N009 1N4148
R11 N020 N022 2
S1 N022 0 N023 0 SWx
V1 N023 0 PULSE(-1 1 5m 100u 100u 5m 80m)
V4 stimOffs stimac PULSE({Vstim_peak} 0 0 100u)
D1 bias_hi2 N001 1N4148
D2 N009 bias_lo1 1N4148
E2 sumBinv 0 N012 0 1
C4 N014 out_A {Cf}
B2 calcSum 0 V=V(stimoffs)-V(isensa)
V2 stimpwl 0 PWL(0 0 200u 1u 201u {V1} 900u {V1-1u} 901u 0 1.6m 1u 1.601m {-V1} 2.3m {-V1+1u} 2.301m 0)
XU8 0 N025 N027 N029 Isensa P001 LTC2050
XU10 N027 vdc_single V=5V
XU11 N029 vdc_single V=-5V
R9 Isensa N025 2.5k
R10 N025 shunt 25
C8 Isensa N025 10p
XU12 0 N026 N028 N030 t1 P002 LTC2050
XU13 N028 vdc_single V=5V
XU14 N030 vdc_single V=-5V
R12 t1 N026 2.5k
R15 N026 stimac {Rein}
C5 N026 0 6.4n
XU15 0 N031 N034 N035 t2 P003 LTC2050
XU16 N034 vdc_single V=5V
XU17 N035 vdc_single V=-5V
R18 t2 N031 2.5k
R19 N031 stimac {Rein}
XU18 P003 vdc_single V=5V
XU19 P002 vdc_single V=5V
C9 N031 0 1p
V3 stimac 0 AC 1
XU20 V+ vdc_single V={Vsup}
XU21 V- vdc_single V={-Vsup}
XU3 P001 vdc_single V=5V
V7 ue1_lv 0 SINE(1.25 1.1 2k 0)
XU9 N010 N005 Vp Vm stimDigOff OPA404
R1 ue1_lv N005 {R1}
R3 ue2_lv N010 {R3}
R20 N010 0 {R4}
R21 N005 stimDigOff {R2}
Vref1 u1 0 2.5V
R22 ue2_lv N017 {Ra}
XU22 N007 N017 Vp Vm ue2_lv OPA404
R27 N017 0 {Ra}
R28 u1 N007 1.45k
R29 u2_lv N007 10k
R30 N007 0 {R10}
V8 N016 0 PULSE(0 3 0 3m)
XU23 N016 u2_lv Vp Vm u2_lv OPA404
B1 NC_03 0 V=V(stimoffs)-V(isensa)
.model D D
.lib C:\Program Files (x86)\LTC_orig\LTspiceIV_4.18\lib\cmp\standard.dio
.model NPN NPN
.model PNP PNP
.lib C:\Program Files (x86)\LTC_orig\LTspiceIV_4.18\lib\cmp\standard.bjt
.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/ADA4700.sub
.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/LM358.sub
* Shunt monitor Gain
.tran 3m startup
; ---------------------
;   Power amp
; ---------------------
.param Ik1 = 3m
.param bias = 1k
;.param bias_b = 100
.param Rs = 10m
.param Rset_bias = 100
; ---------------------
;   Compensator
; ---------------------
.param Rsu = 10k
.param Kpi = 10
.param Ki = 15000
; ---------------------
;   SOURCES
; ---------------------
.param Vsup = 30V
.param Vstim_peak = 1
.MEAS TRAN slewHi DERIV I(Rshunt) WHEN I(Rshunt)='15'
.MEAS TRAN slewLo DERIV I(Rshunt) WHEN I(Rshunt)='-15'
.MEAS TRAN tRise TRIG I(Rshunt) VAL=-15 RISE=1
+ TARG I(Rshunt) VAL=15 TD 10ns RISE=1
.MEAS TRAN tFall TRIG I(Rshunt) VAL=15 FALL=1
+ TARG I(Rshunt) VAL=-15 TD 10ns FALL=2
* .step TEMP list 27 150
* .tran 0 2.8m 1.9m 1e-7
.param Ik3 = 1m
.param UV1 = 0.75V
.param bias_be1 = 15
.param bias_b1 = {UV1/Ik3}
.model SWx SW(Ron=1u Roff=100Meg Vt=0 Vh=-.5 )
.option noopiter
.param Cfe = 1p
* .step param Cfe list 1f 1p 2p 4p 10p
.param Cf = 2p
;.step param Cf 1p 250p 25p
* MINUS 25\nMINUS 25\nMINUS 25\nMINUS 25
* .step param sg 0 50 5
* .step param Kpi list 4.5 10 20
.options plotwinsize=0
* .step param Kpi 2.5 5 0.5
* .ac oct 100 1 100k
.param V1=1;
.param Rein 100
;.step param Rein list 1k 500 200 100
* PULSE({-Vstim_peak} {Vstim_peak} 0 100n 100n 1m 2m)
* Messwandler v1 \nSTM32 DAC out --> Endstufe Vin_ctrl\n0 ... 3V                --> -5V ... 5V\n \nENDSTUFE INVERTIERT!!!!
* STM32f4
* STM32 DAC \nVout_ctrl
.param R1=10k
.param R2={10/3*R1}
.param R3=7k
.param R4=6k
;.step param R3 list 7k 7.5k
* ------------------------------------------------------------------------\nUa=Ue2 * (R1+R2)/R1 * R4/(R3+R4) - Ue1 * R2/R1\nUe1 * R2/R1 @ Ue1=3V  !=  10V  \n -->  R2=10/3*R1\n------------------------------------------------------------------------\nUe2* 13/3 * R4/(R3+R4) @ Ue2=2.5V (ref)  !=  +5V\n --> R4/(R3+R4)  !=  5V * 3/(13 * 2.5V)\n<--> (R3+R4)/R4  !=  13/6\n--> R3=7a   R4=6a     a el. |R\n------------------------------------------------------------------------
.param Ra=22k
* siehe MATLAB OpAmp_addierer_spannTeiler.m
.param R10 = 1.4k
;.step param R10 list 1.4k 1.421k
* PULSE(0 3 2m 10n 10n 500u 1m)
.include /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/OPA404.LIB
.lib EIT_sub\vdc_single.sub
.lib LTC.lib
.lib LTC5.lib
.lib mj11015g_d.sub
.lib mj11016g_d.sub
.lib NJM4580_1.sub
.backanno
.end
