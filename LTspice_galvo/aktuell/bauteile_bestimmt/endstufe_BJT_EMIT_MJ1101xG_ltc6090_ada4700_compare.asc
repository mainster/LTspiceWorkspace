Version 4
SHEET 1 4408 6248
WIRE 48 128 16 128
WIRE 80 128 48 128
WIRE 16 160 16 128
WIRE 768 240 720 240
WIRE 800 240 768 240
WIRE 352 256 352 208
WIRE 480 256 480 208
WIRE 16 272 16 240
WIRE 48 272 16 272
WIRE 80 272 48 272
WIRE 768 304 720 304
WIRE 800 304 768 304
WIRE 16 320 16 272
WIRE 352 352 352 336
WIRE 480 352 480 336
WIRE 480 352 352 352
WIRE 352 368 352 352
WIRE 16 416 16 400
WIRE 1872 512 1872 464
WIRE 1376 592 1376 576
WIRE 1872 592 1872 512
WIRE 1872 592 1552 592
WIRE 1552 656 1552 592
WIRE 1376 704 1376 672
WIRE 1488 704 1376 704
WIRE 1872 704 1872 592
WIRE -272 736 -304 736
WIRE -192 736 -208 736
WIRE 1376 736 1376 704
WIRE 1552 768 1552 752
WIRE 1600 768 1552 768
WIRE 1664 768 1600 768
WIRE 1696 768 1664 768
WIRE -272 800 -304 800
WIRE -192 800 -192 736
WIRE -192 800 -208 800
WIRE -144 800 -192 800
WIRE -32 800 -64 800
WIRE 0 800 -32 800
WIRE 96 800 80 800
WIRE 304 800 272 800
WIRE 416 800 384 800
WIRE 1664 800 1664 768
WIRE 1600 816 1600 768
WIRE -272 848 -336 848
WIRE -192 848 -192 800
WIRE -192 848 -208 848
WIRE 32 848 16 848
WIRE 656 848 640 848
WIRE 1376 848 1376 816
WIRE 32 864 32 848
WIRE 352 864 336 864
WIRE 656 864 656 848
WIRE 1376 864 1376 848
WIRE -32 880 -32 800
WIRE 0 880 -32 880
WIRE 352 880 352 864
WIRE 624 880 608 880
WIRE 96 896 64 896
WIRE 144 896 96 896
WIRE 176 896 144 896
WIRE 272 896 272 800
WIRE 272 896 256 896
WIRE 320 896 272 896
WIRE 848 896 688 896
WIRE 976 896 928 896
WIRE 1008 896 976 896
WIRE 0 912 -32 912
WIRE 416 912 416 800
WIRE 416 912 384 912
WIRE 448 912 416 912
WIRE 480 912 448 912
WIRE 592 912 560 912
WIRE 624 912 592 912
WIRE 320 928 288 928
WIRE 32 944 32 928
WIRE 32 944 16 944
WIRE 592 944 592 912
WIRE 656 944 656 928
WIRE 656 944 640 944
WIRE 1376 944 1376 928
WIRE 352 960 352 944
WIRE 352 960 336 960
WIRE 1600 960 1600 880
WIRE 1664 960 1664 880
WIRE 1664 960 1600 960
WIRE 1840 960 1664 960
WIRE 1872 960 1872 912
WIRE 1872 960 1840 960
WIRE -160 976 -192 976
WIRE -32 976 -32 912
WIRE -32 976 -80 976
WIRE -16 976 -32 976
WIRE 96 976 96 896
WIRE 96 976 64 976
WIRE 1872 992 1872 960
WIRE 1216 1040 1200 1040
WIRE 1296 1040 1216 1040
WIRE 1376 1040 1376 1008
WIRE 1376 1040 1360 1040
WIRE 592 1056 592 1024
WIRE 848 1056 592 1056
WIRE 976 1056 928 1056
WIRE 1008 1056 976 1056
WIRE 1216 1120 1200 1120
WIRE 1296 1120 1216 1120
WIRE 1872 1120 1872 1072
WIRE 1872 1120 1360 1120
WIRE 2000 1120 1872 1120
WIRE 2032 1120 2000 1120
WIRE 2128 1120 2096 1120
WIRE 2256 1120 2128 1120
WIRE 2288 1120 2256 1120
WIRE 2400 1120 2352 1120
WIRE 1872 1136 1872 1120
WIRE 1376 1152 1376 1040
WIRE 2400 1152 2400 1120
WIRE 2480 1168 2480 1120
WIRE 2256 1200 2256 1120
WIRE -288 1216 -320 1216
WIRE -208 1216 -224 1216
WIRE 2128 1216 2128 1120
WIRE 1664 1232 1600 1232
WIRE 1824 1232 1664 1232
WIRE 1872 1232 1872 1216
WIRE 1872 1232 1824 1232
WIRE 2480 1232 2480 1216
WIRE 304 1248 256 1248
WIRE 496 1248 384 1248
WIRE 2400 1248 2400 1232
WIRE 1376 1264 1376 1216
WIRE -288 1280 -320 1280
WIRE -208 1280 -208 1216
WIRE -208 1280 -224 1280
WIRE -160 1280 -208 1280
WIRE -48 1280 -80 1280
WIRE -16 1280 -48 1280
WIRE 80 1280 64 1280
WIRE 704 1280 688 1280
WIRE 1872 1280 1872 1232
WIRE 704 1296 704 1280
WIRE 1664 1296 1664 1232
WIRE 304 1312 288 1312
WIRE 1600 1312 1600 1232
WIRE 2256 1312 2256 1280
WIRE -288 1328 -352 1328
WIRE -208 1328 -208 1280
WIRE -208 1328 -224 1328
WIRE 16 1328 0 1328
WIRE 304 1328 304 1312
WIRE 2128 1328 2128 1296
WIRE 16 1344 16 1328
WIRE 688 1344 656 1344
WIRE 1376 1344 1376 1328
WIRE -48 1360 -48 1280
WIRE -16 1360 -48 1360
WIRE 1376 1360 1376 1344
WIRE 80 1376 48 1376
WIRE 128 1376 80 1376
WIRE 160 1376 128 1376
WIRE 256 1376 256 1248
WIRE 256 1376 240 1376
WIRE 288 1376 256 1376
WIRE 880 1376 848 1376
WIRE 992 1376 960 1376
WIRE 1024 1376 992 1376
WIRE -16 1392 -48 1392
WIRE 496 1408 496 1248
WIRE 496 1408 448 1408
WIRE 528 1408 496 1408
WIRE 560 1408 528 1408
WIRE 656 1408 640 1408
WIRE 688 1408 656 1408
WIRE 2256 1408 2256 1376
WIRE 16 1424 16 1408
WIRE 16 1424 0 1424
WIRE 1600 1424 1600 1376
WIRE 1600 1424 1552 1424
WIRE 1632 1424 1600 1424
WIRE 1664 1424 1664 1376
WIRE 1664 1424 1632 1424
WIRE 1696 1424 1664 1424
WIRE 288 1440 256 1440
WIRE 1552 1440 1552 1424
WIRE -176 1456 -208 1456
WIRE -48 1456 -48 1392
WIRE -48 1456 -96 1456
WIRE -32 1456 -48 1456
WIRE 80 1456 80 1376
WIRE 80 1456 48 1456
WIRE 704 1472 704 1456
WIRE 704 1472 688 1472
WIRE 1376 1488 1376 1440
WIRE 1488 1488 1376 1488
WIRE 304 1504 304 1488
WIRE 304 1504 288 1504
WIRE 1376 1520 1376 1488
WIRE 656 1536 656 1408
WIRE 704 1536 656 1536
WIRE 880 1536 784 1536
WIRE 992 1536 960 1536
WIRE 1024 1536 992 1536
WIRE 1552 1600 1552 1536
WIRE 1872 1600 1872 1488
WIRE 1872 1600 1552 1600
WIRE 1376 1616 1376 1600
WIRE 1872 1632 1872 1600
WIRE 1872 1648 1872 1632
WIRE 2128 1760 2128 1408
WIRE 1456 1808 1392 1808
WIRE 1520 1808 1456 1808
WIRE 1568 1808 1520 1808
WIRE 1680 1808 1648 1808
WIRE 1792 1808 1744 1808
WIRE 1808 1808 1792 1808
WIRE 1904 1808 1808 1808
WIRE 2128 1808 2128 1760
WIRE 2128 1808 1984 1808
WIRE 2128 1824 2128 1808
WIRE 1520 1840 1520 1808
WIRE 1904 1840 1904 1808
WIRE 1984 1856 1984 1808
WIRE 1520 1920 1520 1904
WIRE 1984 1920 1984 1904
WIRE 2128 1920 2128 1904
WIRE 2128 1920 1984 1920
WIRE 1904 1936 1904 1920
WIRE 2128 1952 2128 1920
WIRE 1456 1968 1392 1968
WIRE 1520 1968 1456 1968
WIRE 1568 1968 1520 1968
WIRE 1792 1968 1792 1808
WIRE 1792 1968 1648 1968
WIRE 1520 2000 1520 1968
WIRE 1520 2080 1520 2064
FLAG 352 368 0
FLAG 352 208 V+
FLAG 480 208 V-
FLAG 16 416 0
FLAG 2128 1952 0
FLAG 2128 1760 shunt
FLAG 304 1312 V+
FLAG 304 1504 V-
FLAG 48 272 stimac
FLAG 2256 1408 0
FLAG 1904 1936 0
FLAG 1808 1808 fbSens
FLAG -304 800 stimac
FLAG 48 128 stimOffs
FLAG -304 736 stimOffs
FLAG -336 848 0
FLAG 32 848 V2-
FLAG 32 944 V2+
FLAG 96 800 0
FLAG -192 976 IsensA
FLAG 144 896 sumA
FLAG 288 928 0
FLAG 352 960 V-
FLAG 352 864 V+
FLAG 1520 1920 0
FLAG 1456 1808 IsensA
FLAG 448 912 errA
FLAG 768 304 V2-
FLAG 768 240 V2+
FLAG 256 1440 0
FLAG 608 880 0
FLAG 656 848 V-
FLAG 656 944 V+
FLAG 976 896 opV
FLAG 976 1056 ucoil
FLAG -320 1280 stimac
FLAG -320 1216 stimOffs
FLAG -352 1328 0
FLAG 16 1328 V2-
FLAG 16 1424 V2+
FLAG 80 1280 0
FLAG -208 1456 IsensB
FLAG 128 1376 sumB
FLAG 704 1472 V+
FLAG 704 1280 V-
FLAG 656 1344 0
FLAG 528 1408 errB
FLAG 1520 2080 0
FLAG 1456 1968 IsensB
FLAG 2000 1120 Ucoil
FLAG 1376 1696 0
FLAG 1376 496 0
FLAG 1872 1632 V-
FLAG 1872 512 V+
FLAG 1216 1120 Ucoil
FLAG 1664 768 b_hi
FLAG 1840 960 e_hi
FLAG 1824 1232 e_lo
FLAG 1632 1424 b_lo
FLAG 1376 1344 bias_lo1
FLAG 1376 1488 bias_lo2
FLAG 1376 704 bias_hi1
FLAG 1376 848 bias_hi2
FLAG 1216 1040 opV
FLAG 2400 1248 0
FLAG 2480 1232 0
FLAG 2480 1120 stimoffs
FLAG 992 1536 ucoil
FLAG 992 1376 opV
SYMBOL voltage 352 240 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value 30
SYMBOL voltage 480 240 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V7
SYMATTR Value -30
SYMBOL voltage 16 304 R0
WINDOW 123 24 44 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -460 247 Left 2
SYMATTR Value2 AC 1
SYMATTR Value PULSE({-Vstim_peak} {Vstim_peak} 0.5m 50n 50n 1m 2m)
SYMATTR InstName Vstim
SYMBOL res 2112 1312 R0
SYMATTR InstName R14
SYMATTR Value 1.5
SYMBOL ind 2112 1200 R0
SYMATTR InstName L1
SYMATTR Value 170µ
SYMBOL res 2112 1808 R0
SYMATTR InstName Rshunt
SYMATTR Value 0.01
SYMBOL res 2240 1184 R0
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL cap 2240 1312 R0
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL Misc\\jumper 2064 1056 R0
SYMATTR InstName X4
SYMBOL Misc\\jumper 1712 1744 R0
SYMATTR InstName X7
SYMBOL crtl-V-V 1904 1824 M0
SYMATTR InstName E4
SYMATTR Value 25
SYMBOL source-V 16 144 R0
WINDOW 0 -27 56 VBottom 2
WINDOW 3 -223 300 Top 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value PULSE({Vstim_peak} 0 0.5m 50n 50n 1)
SYMBOL Misc\\jumper -240 672 R0
SYMATTR InstName X1
SYMBOL res -64 960 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R50
SYMATTR Value {Rsu}
SYMBOL res -160 784 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R51
SYMATTR Value {Rsu}
SYMBOL res -32 960 M90
WINDOW 0 56 114 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R52
SYMATTR Value {Rsu}
SYMBOL res 96 816 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 81 59 VBottom 2
SYMATTR InstName R53
SYMATTR Value {Rsu}
SYMBOL NJM4580 32 960 M180
SYMATTR InstName U17
SYMBOL res 288 816 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R54
SYMATTR Value {10k*Kpi}
SYMBOL res 160 912 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R55
SYMATTR Value 10k
SYMBOL res 1664 1792 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 1µ
SYMBOL cap 1504 1840 R0
SYMATTR InstName C1
SYMATTR Value 1n
SYMBOL source-Vmarker 720 240 R0
SYMATTR Value V=16
SYMATTR InstName U1
SYMBOL source-Vmarker 720 304 R0
SYMATTR Value V=-16
SYMATTR InstName U2
SYMBOL Opamps\\opamp2 352 848 R0
WINDOW 3 13 9 Left 2
SYMATTR Value ada4700
SYMATTR InstName U11
SYMATTR SpiceModel ada4700
SYMBOL Opamps\\LTC6090 352 1408 R0
SYMATTR InstName U16
SYMBOL res 608 928 M0
SYMATTR InstName R1
SYMATTR Value {10k*Kpv}
SYMBOL Opamps\\opamp2 656 960 M180
WINDOW 3 18 101 Left 2
SYMATTR Value ada4700
SYMATTR InstName U3
SYMATTR SpiceModel ada4700
SYMBOL res 464 928 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL Misc\\jumper -256 1152 R0
SYMATTR InstName X9
SYMBOL res -80 1440 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {Rsu}
SYMBOL res -176 1264 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R6
SYMATTR Value {Rsu}
SYMBOL res -48 1440 M90
WINDOW 0 56 114 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R7
SYMATTR Value {Rsu}
SYMBOL res 80 1296 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 81 59 VBottom 2
SYMATTR InstName R8
SYMATTR Value {Rsu}
SYMBOL NJM4580 16 1440 M180
SYMATTR InstName U4
SYMBOL res 144 1392 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res 288 1264 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R15
SYMATTR Value {10k*Kpi}
SYMBOL Opamps\\LTC6090 752 1376 M180
WINDOW 0 63 -48 Left 2
SYMATTR InstName U5
SYMBOL res 544 1392 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL res 688 1520 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R17
SYMATTR Value {10k*Kpv}
SYMBOL res 864 1392 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R18
SYMATTR Value {1m+100t*JP}
SYMBOL res 864 1552 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R19
SYMATTR Value {1m+100t*JP}
SYMBOL res 1664 1952 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 1µ
SYMBOL cap 1504 2000 R0
SYMATTR InstName C3
SYMATTR Value 1n
SYMBOL EIT_Semiconductors\\npn 1488 656 R0
SYMATTR InstName T3
SYMATTR Value FMMT624
SYMBOL EIT_Semiconductors\\pnp 1488 1536 M180
SYMATTR InstName T4
SYMATTR Value FMMT723
SYMBOL res 1680 784 M0
WINDOW 3 63 201 Right 2
SYMATTR Value {bias_be1}
SYMATTR InstName R23
SYMBOL res 1648 1280 R0
WINDOW 3 -17 -88 Left 2
SYMATTR InstName R24
SYMATTR Value {bias_be1}
SYMBOL res 1360 720 R0
SYMATTR InstName R25
SYMATTR Value {1.3*bias_b1}
SYMBOL res 1392 1344 M0
SYMATTR InstName R26
SYMATTR Value {bias_b1}
SYMBOL res 1360 1504 R0
SYMATTR InstName R27
SYMATTR Value 1m
SYMBOL res 1360 576 R0
SYMATTR InstName R28
SYMATTR Value 1m
SYMBOL source-I 1376 576 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I3
SYMATTR Value {IK3}
SYMBOL source-I 1376 1696 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I4
SYMATTR Value {Ik3}
SYMBOL res 1856 976 R0
SYMATTR InstName R37
SYMATTR Value {Rs}
SYMBOL res 1888 1232 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R38
SYMATTR Value {Rs}
SYMBOL cap 1584 1312 R0
SYMATTR InstName C6
SYMATTR Value 1p
SYMBOL cap 1616 816 M0
SYMATTR InstName C7
SYMATTR Value 1n
SYMBOL MJ11015G_D 1712 1472 M180
SYMATTR InstName U6
SYMBOL MJ11016G_D 1712 720 R0
SYMATTR InstName U7
SYMBOL diode 1360 944 R0
WINDOW 3 73 21 VRight 2
SYMATTR Value 1N4148
SYMATTR InstName D7
SYMBOL diode 1360 864 R0
WINDOW 3 73 21 VRight 2
SYMATTR Value 1N4148
SYMATTR InstName D8
SYMBOL diode 1360 1152 R0
WINDOW 3 73 21 VRight 2
SYMATTR Value 1N4148
SYMATTR InstName D9
SYMBOL diode 1360 1264 R0
WINDOW 3 73 21 VRight 2
SYMATTR Value 1N4148
SYMATTR InstName D10
SYMBOL Misc\\jumper 1328 976 R0
SYMATTR InstName X2
SYMBOL Misc\\jumper 1328 1056 R0
SYMATTR InstName X6
SYMBOL crtl-V-V 2400 1136 M0
SYMATTR InstName E1
SYMATTR Value 6
SYMBOL Misc\\jumper 2320 1040 R0
SYMATTR InstName X3
SYMBOL res 832 912 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R9
SYMATTR Value {1m+100t*(1-JP)}
SYMBOL res 832 1072 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R10
SYMATTR Value {1m+100t*(1-JP)}
TEXT 744 88 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/ADA4700.sub
TEXT 744 56 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/LM358.sub
TEXT 1816 1752 Left 2 ;Shunt monitor Gain
TEXT 552 384 Left 2 !.tran 0 10m 6m startup
TEXT 1632 144 Left 2 !; ---------------------\n;   Power amp\n; ---------------------\n.param Ik1 = 3m\n.param bias = 1k\n;.param bias_b = 100\n.param Rs = 10m\n.param Rset_bias = 100
TEXT 1064 152 Left 2 !; ---------------------\n;   Compensator\n; ---------------------\n.param Rsu = 10k\n.param Kpv = 6\n.param Kpi = 4\n.param Ki = 15000
TEXT 1336 144 Left 2 !; ---------------------\n;   SOURCES\n; ---------------------\n.param Vsup = 30V\n.param Vstim_peak = 5
TEXT -440 576 Left 2 ;PULSE(-{Vstim_peak} {Vstim_peak} 0.5m 10n 10n 1m 2m)
TEXT -440 608 Left 2 ;SINE(-0 20 500 0.5m)
TEXT 1168 -144 Left 2 !.MEAS TRAN slewHi DERIV I(Rshunt) WHEN I(Rshunt)='15'\n.MEAS TRAN slewLo DERIV I(Rshunt) WHEN I(Rshunt)='-15'\n.MEAS TRAN tRise TRIG I(Rshunt) VAL=-15 RISE=1\n+ TARG I(Rshunt) VAL=15 TD 10ns RISE=1\n.MEAS TRAN tFall TRIG I(Rshunt) VAL=15 FALL=1\n+ TARG I(Rshunt) VAL=-15 TD 10ns FALL=2
TEXT 760 600 Left 2 ;.step param Kpv list 1 7\n.step param Kpi list 1 2 5
TEXT 456 536 Left 2 !;--- JP=0  -->  LTC6090 ---\n;--- JP=1  -->  ADA4700 ---\n.param JP =1\n.param JP2 =1
TEXT 760 568 Left 2 ;.step TEMP 10 100 20
TEXT -312 168 Left 2 ;.dc Vstim -10 10 0.001
TEXT 648 736 Left 2 !.step param JP1 list 1 0
TEXT 544 424 Left 2 ;.dc Vstim -.2 .2 0.01
TEXT 2048 248 Left 2 ;.step param Rset_bias 100 2k 200
TEXT 1328 320 Left 2 !.param Ik3 = 1m\n.param UV1 = 0.5V\n.param bias_be1 = 10\n.param bias_b1 = {UV1/Ik3}
RECTANGLE Normal 1056 1120 -448 672 2
RECTANGLE Normal 1056 1616 -448 1152 2
