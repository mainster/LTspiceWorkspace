Version 4
SHEET 1 4408 6248
WIRE 768 240 720 240
WIRE 800 240 768 240
WIRE 768 304 720 304
WIRE 800 304 768 304
WIRE 768 384 720 384
WIRE 800 384 768 384
WIRE 768 448 720 448
WIRE 800 448 768 448
WIRE 80 464 48 464
WIRE 112 464 80 464
WIRE 1376 496 1376 480
WIRE 1872 496 1872 480
WIRE 48 512 48 464
WIRE 1376 544 1376 496
WIRE 1872 592 1872 496
WIRE 1872 592 1552 592
WIRE 48 624 48 592
WIRE 96 624 48 624
WIRE 112 624 96 624
WIRE 48 656 48 624
WIRE 1552 656 1552 592
WIRE 1376 704 1376 624
WIRE 1488 704 1376 704
WIRE 1872 704 1872 592
WIRE 1376 720 1376 704
WIRE 48 752 48 736
WIRE 1552 768 1552 752
WIRE 1600 768 1552 768
WIRE 1664 768 1600 768
WIRE 1696 768 1664 768
WIRE 1664 800 1664 768
WIRE 1376 816 1376 800
WIRE 1376 816 1360 816
WIRE 1600 816 1600 768
WIRE 1376 832 1376 816
WIRE 2336 832 2304 832
WIRE 2368 832 2336 832
WIRE 80 880 48 880
WIRE 128 880 80 880
WIRE 336 880 320 880
WIRE 384 880 336 880
WIRE 2304 880 2304 832
WIRE 48 912 48 880
WIRE 320 912 320 880
WIRE 1376 928 1376 896
WIRE 1600 960 1600 880
WIRE 1664 960 1664 880
WIRE 1664 960 1600 960
WIRE 1840 960 1664 960
WIRE 1872 960 1872 912
WIRE 1872 960 1840 960
WIRE 48 1008 48 992
WIRE 320 1008 320 992
WIRE 1872 1008 1872 960
WIRE 1216 1040 1200 1040
WIRE 1296 1040 1216 1040
WIRE 1376 1040 1376 992
WIRE 1376 1040 1360 1040
WIRE 1216 1120 1200 1120
WIRE 1296 1120 1216 1120
WIRE 1872 1120 1872 1088
WIRE 1872 1120 1360 1120
WIRE 2000 1120 1872 1120
WIRE 2032 1120 2000 1120
WIRE 2128 1120 2096 1120
WIRE 2304 1120 2128 1120
WIRE 1872 1152 1872 1120
WIRE 2304 1152 2304 1120
WIRE -256 1184 -320 1184
WIRE -176 1184 -192 1184
WIRE 1296 1184 1232 1184
WIRE 1376 1184 1376 1040
WIRE 1376 1184 1360 1184
WIRE 1376 1216 1376 1184
WIRE -256 1248 -320 1248
WIRE -176 1248 -176 1184
WIRE -176 1248 -192 1248
WIRE 2128 1248 2128 1120
WIRE 2304 1248 2304 1232
WIRE 1664 1264 1600 1264
WIRE 1824 1264 1664 1264
WIRE 1872 1264 1872 1232
WIRE 1872 1264 1824 1264
WIRE 752 1280 736 1280
WIRE 752 1296 752 1280
WIRE -256 1312 -320 1312
WIRE -176 1312 -176 1248
WIRE -176 1312 -192 1312
WIRE -128 1312 -176 1312
WIRE -16 1312 -48 1312
WIRE 16 1312 -16 1312
WIRE 112 1312 96 1312
WIRE 1376 1312 1376 1280
WIRE 1872 1312 1872 1264
WIRE 1664 1328 1664 1264
WIRE 2304 1328 2304 1312
WIRE 736 1344 704 1344
WIRE 1600 1344 1600 1264
WIRE -256 1360 -304 1360
WIRE -176 1360 -176 1312
WIRE -176 1360 -192 1360
WIRE 48 1360 32 1360
WIRE 48 1376 48 1360
WIRE 944 1376 896 1376
WIRE 1040 1376 1008 1376
WIRE 1072 1376 1040 1376
WIRE -16 1392 -16 1312
WIRE 16 1392 -16 1392
WIRE 1376 1392 1376 1376
WIRE 1376 1392 1360 1392
WIRE 112 1408 80 1408
WIRE 160 1408 112 1408
WIRE 192 1408 160 1408
WIRE 320 1408 272 1408
WIRE 448 1408 400 1408
WIRE 496 1408 448 1408
WIRE 576 1408 560 1408
WIRE 704 1408 656 1408
WIRE 736 1408 704 1408
WIRE 1376 1408 1376 1392
WIRE 16 1424 -16 1424
WIRE 400 1440 400 1408
WIRE 48 1456 48 1440
WIRE 48 1456 32 1456
WIRE 320 1456 320 1408
WIRE 1600 1456 1600 1408
WIRE 1600 1456 1552 1456
WIRE 1632 1456 1600 1456
WIRE 1664 1456 1664 1408
WIRE 1664 1456 1632 1456
WIRE 1696 1456 1664 1456
WIRE 2128 1456 2128 1328
WIRE 2208 1456 2128 1456
WIRE 752 1472 752 1456
WIRE 752 1472 736 1472
WIRE 1552 1472 1552 1456
WIRE -256 1488 -320 1488
WIRE -176 1488 -192 1488
WIRE -144 1488 -176 1488
WIRE -16 1488 -16 1424
WIRE -16 1488 -64 1488
WIRE 0 1488 -16 1488
WIRE 112 1488 112 1408
WIRE 112 1488 80 1488
WIRE 2352 1488 2352 1456
WIRE 2128 1504 2128 1456
WIRE 1376 1520 1376 1488
WIRE 1488 1520 1376 1520
WIRE -256 1536 -304 1536
WIRE -176 1536 -176 1488
WIRE -176 1536 -192 1536
WIRE 320 1536 320 1504
WIRE 400 1536 400 1520
WIRE 704 1536 704 1408
WIRE 768 1536 704 1536
WIRE 912 1536 848 1536
WIRE 944 1536 912 1536
WIRE 1040 1536 1008 1536
WIRE 1072 1536 1040 1536
WIRE 1376 1552 1376 1520
WIRE 2352 1584 2352 1568
WIRE 704 1632 704 1536
WIRE 784 1632 704 1632
WIRE 912 1632 912 1536
WIRE 912 1632 848 1632
WIRE 1552 1632 1552 1568
WIRE 1872 1632 1872 1520
WIRE 1872 1632 1552 1632
WIRE 2128 1632 2128 1584
WIRE 2208 1632 2128 1632
WIRE 2432 1648 2400 1648
WIRE 2432 1664 2432 1648
WIRE 1376 1680 1376 1632
WIRE 1872 1680 1872 1632
WIRE 1872 1696 1872 1680
WIRE 2352 1696 2352 1664
WIRE 2432 1760 2432 1744
WIRE 1808 1776 1696 1776
WIRE 1952 1776 1872 1776
WIRE 1696 1888 1696 1776
WIRE 1824 1888 1696 1888
WIRE 1952 1888 1952 1776
WIRE 1952 1888 1904 1888
WIRE 2000 1888 1952 1888
WIRE 2128 1888 2128 1632
WIRE 2128 1888 2080 1888
WIRE 1840 1936 1824 1936
WIRE 2128 1936 2128 1888
WIRE 1840 1952 1840 1936
WIRE 1952 2000 1952 1888
WIRE 1952 2000 1872 2000
WIRE 1600 2032 1536 2032
WIRE 1696 2032 1696 1888
WIRE 1696 2032 1664 2032
WIRE 1728 2032 1696 2032
WIRE 2128 2064 2128 2016
WIRE 2128 2064 1872 2064
WIRE 2128 2112 2128 2064
WIRE 1840 2144 1840 2112
WIRE 1536 2384 1472 2384
WIRE 1584 2384 1536 2384
WIRE 1680 2384 1648 2384
WIRE 1728 2384 1680 2384
WIRE 1840 2384 1808 2384
WIRE 1968 2384 1904 2384
WIRE 2064 2384 1968 2384
WIRE 1680 2416 1680 2384
WIRE 2064 2416 2064 2384
WIRE 2144 2432 2144 2384
WIRE 1680 2496 1680 2480
WIRE 2144 2496 2144 2480
WIRE 2064 2512 2064 2496
WIRE 176 2688 176 2656
FLAG 2128 2112 0
FLAG 2128 1888 shunt
FLAG 2304 1328 0
FLAG 2064 2512 0
FLAG 1968 2384 fbSens
FLAG 1680 2496 0
FLAG 1536 2384 jjIsensA
FLAG 768 304 V2-
FLAG 768 240 V2+
FLAG -320 1312 stimac
FLAG -320 1248 stimOffs
FLAG -304 1360 0
FLAG 48 1360 V2-
FLAG 48 1456 V2+
FLAG 112 1312 0
FLAG -320 1488 IsensA
FLAG 160 1408 sumB
FLAG 752 1472 V+
FLAG 752 1280 V-
FLAG 704 1344 0
FLAG 2000 1120 out_A
FLAG 1872 1680 V-
FLAG 1872 496 V+
FLAG 1216 1120 Ucoil
FLAG 1664 768 b_hi
FLAG 1840 960 e_hi
FLAG 1824 1264 e_lo
FLAG 1632 1456 b_lo
FLAG 1360 1392 bias_lo1
FLAG 1376 1520 bias_lo2
FLAG 1376 704 bias_hi1
FLAG 1360 816 bias_hi2
FLAG 1216 1040 opV
FLAG 1040 1536 ucoil
FLAG 1040 1376 opV
FLAG 2400 1600 0
FLAG 2432 1760 0
FLAG 800 1296 0
FLAG 2352 1696 0
FLAG 1376 496 V+
FLAG 1376 1680 V-
FLAG 80 464 stimOffs
FLAG 400 1536 0
FLAG 320 1536 0
FLAG 448 1408 sumBinv
FLAG -304 1536 0
FLAG 320 1008 0
FLAG 336 880 calcSum
FLAG 48 1008 0
FLAG 80 880 stimpwl
FLAG -320 1184 stimpwl
FLAG 2144 2496 0
FLAG 2144 2384 shunt
FLAG 1536 2032 Isensa
FLAG 176 2688 0
FLAG 48 752 0
FLAG 96 624 stimac
FLAG 768 448 V-
FLAG 768 384 V+
FLAG 1232 1184 stimac
FLAG 2304 960 0
FLAG 2224 944 0
FLAG 2224 896 stimac
FLAG 2336 832 la1
SYMBOL res 2112 1488 R0
SYMATTR InstName R14
SYMATTR Value 1.5
SYMBOL ind 2112 1232 R0
SYMATTR InstName L1
SYMATTR Value 170µ
SYMBOL res 2112 1920 R0
SYMATTR InstName Rshunt
SYMATTR Value 0.01
SYMBOL res 2288 1136 R0
SYMATTR InstName R4
SYMATTR Value 1t
SYMBOL cap 2288 1248 R0
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL Misc\\jumper 2064 1056 R0
SYMATTR InstName X4
SYMBOL Misc\\jumper 1872 2320 R0
SYMATTR InstName X7
SYMBOL crtl-V-V 2064 2400 M0
SYMATTR InstName E4
SYMATTR Value -25
SYMBOL res 1824 2368 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 1
SYMBOL cap 1664 2416 R0
SYMATTR InstName C1
SYMATTR Value 1n
SYMBOL source-Vmarker 720 240 R0
SYMATTR Value V=16
SYMATTR InstName U1
SYMBOL source-Vmarker 720 304 R0
SYMATTR Value V=-16
SYMATTR InstName U2
SYMBOL Misc\\jumper -224 1184 R0
SYMATTR InstName X9
SYMBOL res -48 1472 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {Rsu}
SYMBOL res -144 1296 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R6
SYMATTR Value {Rsu}
SYMBOL res -16 1472 M90
WINDOW 0 56 114 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R7
SYMATTR Value {Rsu}
SYMBOL res 112 1328 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 81 59 VBottom 2
SYMATTR InstName R8
SYMATTR Value {Rsu}
SYMBOL NJM4580 48 1472 M180
SYMATTR InstName U4
SYMBOL res 176 1424 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL Opamps\\LTC6090 800 1376 M180
WINDOW 0 63 -48 Left 2
SYMATTR InstName U5
SYMBOL res 560 1392 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL res 752 1520 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R17
SYMATTR Value {10k*Kpi}
SYMBOL EIT_Semiconductors\\npn 1488 656 R0
SYMATTR InstName T3
SYMATTR Value FMMT624
SYMBOL EIT_Semiconductors\\pnp 1488 1568 M180
SYMATTR InstName T4
SYMATTR Value FMMT723
SYMBOL res 1680 784 M0
WINDOW 3 63 201 Right 2
SYMATTR Value {bias_be1}
SYMATTR InstName R23
SYMBOL res 1648 1312 R0
WINDOW 3 -17 -88 Left 2
SYMATTR Value {bias_be1}
SYMATTR InstName R24
SYMBOL res 1360 704 R0
SYMATTR InstName R25
SYMATTR Value {bias_b1}
SYMBOL res 1392 1392 M0
SYMATTR InstName R26
SYMATTR Value {bias_b1}
SYMBOL source-I 1376 624 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 29 -11 Left 2
SYMATTR InstName I3
SYMATTR Value {IK3}
SYMATTR SpiceLine load
SYMBOL source-I 1376 1632 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 29 -11 Left 2
SYMATTR InstName I4
SYMATTR Value {Ik3}
SYMATTR SpiceLine load
SYMBOL res 1856 992 R0
SYMATTR InstName R37
SYMATTR Value {Rs}
SYMBOL res 1888 1248 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R38
SYMATTR Value {Rs}
SYMBOL cap 1616 1344 M0
SYMATTR InstName C6
SYMATTR Value 10p
SYMBOL cap 1616 816 M0
SYMATTR InstName C7
SYMATTR Value 10p
SYMBOL MJ11015G_D 1712 1504 M180
SYMATTR InstName U6
SYMBOL MJ11016G_D 1712 720 R0
SYMATTR InstName U7
SYMBOL diode 1360 928 R0
WINDOW 3 73 21 VRight 2
SYMATTR Value 1N4148
SYMATTR InstName D8
SYMBOL diode 1360 1216 R0
WINDOW 3 73 21 VRight 2
SYMATTR Value 1N4148
SYMATTR InstName D10
SYMBOL Misc\\jumper 1328 976 R0
SYMATTR InstName X2
SYMBOL Misc\\jumper 1328 1056 R0
SYMATTR InstName X6
SYMBOL res 2336 1472 R0
SYMATTR InstName R11
SYMATTR Value 2
SYMBOL sw 2352 1568 M0
SYMATTR InstName S1
SYMATTR Value SWx
SYMBOL source-V 2432 1648 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -106 145 Left 2
SYMATTR Value PULSE(-1 1 5m 100u 100u 5m 80m)
SYMATTR InstName V1
SYMBOL Misc\\jumper 976 1312 R0
SYMATTR InstName X5
SYMBOL Misc\\jumper 976 1472 R0
SYMATTR InstName X8
SYMBOL source-V 48 496 R0
WINDOW 0 -27 56 VBottom 2
WINDOW 3 212 42 Top 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value PULSE({Vstim_peak} 0 0 100u)
SYMBOL Misc\\jumper -224 1424 R0
SYMATTR InstName X10
SYMBOL diode 1360 832 R0
WINDOW 3 73 21 VRight 2
SYMATTR Value 1N4148
SYMATTR InstName D1
SYMBOL diode 1360 1312 R0
WINDOW 3 73 21 VRight 2
SYMATTR Value 1N4148
SYMATTR InstName D2
SYMBOL Misc\\jumper 528 1344 R0
SYMATTR InstName X11
SYMBOL crtl-V-V 400 1424 R0
SYMATTR InstName E2
SYMATTR Value 1
SYMBOL cap 784 1648 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C4
SYMATTR Value {Cf}
SYMBOL bv 320 896 R0
WINDOW 3 49 50 Left 2
SYMATTR Value V=V(stimoffs)-V(isensa)
SYMATTR InstName B2
SYMBOL source-V 48 896 R0
WINDOW 3 -112 173 Left 2
WINDOW 123 -311 -37 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PWL(0 0 200u 1u 201u {V1} 900u {V1-1u} 901u 0 1.6m 1u 1.601m {-V1} 2.3m {-V1+1u} 2.301m 0)
SYMATTR InstName V2
SYMBOL Misc\\jumper 1632 1968 M0
SYMATTR InstName X1
SYMBOL Misc\\jumper 1616 2320 R0
SYMATTR InstName X3
SYMBOL Opamps\\LTC2050 1840 2032 M0
SYMATTR InstName U8
SYMBOL source-Vmarker 1824 1936 R0
SYMATTR InstName U10
SYMBOL source-Vmarker 1840 2144 R180
SYMATTR Value V=-5V
SYMATTR InstName U11
SYMBOL res 1808 1904 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R9
SYMATTR Value 2.5k
SYMBOL res 1984 1904 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R10
SYMATTR Value 25
SYMBOL cap 1808 1792 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C8
SYMATTR Value 1f
SYMBOL source-V 48 640 R0
WINDOW 3 116 61 Left 2
WINDOW 123 43 67 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PULSE({-Vstim_peak} {Vstim_peak} 0 100n 100n 500u 1m)
SYMATTR Value2 AC 1
SYMATTR InstName V3
SYMBOL source-Vmarker 720 384 R0
SYMATTR Value V={Vsup}
SYMATTR InstName U20
SYMBOL source-Vmarker 720 448 R0
SYMATTR Value V={-Vsup}
SYMATTR InstName U21
SYMBOL source-Vmarker 1792 2112 R0
SYMATTR InstName U3
SYMBOL Misc\\jumper 1328 1152 R0
SYMATTR InstName X12
SYMBOL crtl-V-V 2304 864 R0
SYMATTR InstName E1
SYMATTR Value 1
TEXT 744 88 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/ADA4700.sub
TEXT 744 56 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/LM358.sub
TEXT 1776 2544 Left 2 ;Shunt monitor Gain
TEXT 1000 456 Left 2 !.tran 0 2.8m 1.9m
TEXT 1632 144 Left 2 !; ---------------------\n;   Power amp\n; ---------------------\n.param Ik1 = 3m\n.param bias = 1k\n;.param bias_b = 100\n.param Rs = 10m\n.param Rset_bias = 100
TEXT 1064 152 Left 2 !; ---------------------\n;   Compensator\n; ---------------------\n.param Rsu = 10k\n.param Kpi = 10\n.param Ki = 15000
TEXT 1336 144 Left 2 !; ---------------------\n;   SOURCES\n; ---------------------\n.param Vsup = 30V\n.param Vstim_peak = 1
TEXT 736 -168 Left 2 !.MEAS TRAN slewHi DERIV I(Rshunt) WHEN I(Rshunt)='15'\n.MEAS TRAN slewLo DERIV I(Rshunt) WHEN I(Rshunt)='-15'\n.MEAS TRAN tRise TRIG I(Rshunt) VAL=-15 RISE=1\n+ TARG I(Rshunt) VAL=15 TD 10ns RISE=1\n.MEAS TRAN tFall TRIG I(Rshunt) VAL=15 FALL=1\n+ TARG I(Rshunt) VAL=-15 TD 10ns FALL=2
TEXT 984 664 Left 2 ;.step TEMP list 27 150
TEXT 992 496 Left 2 ;.tran 0 2.8m 1.9m 1e-7
TEXT 1328 320 Left 2 !.param Ik3 = 1m\n.param UV1 = 0.75V\n.param bias_be1 = 15\n.param bias_b1 = {UV1/Ik3}
TEXT 744 24 Left 2 !.model SWx SW(Ron=1u Roff=100Meg Vt=0 Vh=-.5 )
TEXT 992 536 Left 2 !.option noopiter
TEXT 128 1632 Left 2 !.param Cfe = 1p
TEXT 128 1600 Left 2 ;.step param Cfe list 1f 1p 2p 4p 10p
TEXT 792 1728 Left 2 !.param Cf = 2p\n;.step param Cf 1p 250p 25p
TEXT 1864 2416 Left 2 ;MINUS 25\nMINUS 25\nMINUS 25\nMINUS 25
TEXT 1632 2608 Left 2 ;.step param sg 0 50 5
TEXT 280 1224 Left 2 ;.step param Kpi list 4.5 10 20
TEXT 984 584 Left 2 !.options plotwinsize=0
TEXT 256 1296 Left 2 ;.step param Kpi 2.5 5 0.5
TEXT 984 624 Left 2 ;.ac oct 100 1 100k
TEXT 88 960 Left 2 !.param V1=1;
TEXT -16 1776 Left 2 !.param Rein 100\n;.step param Rein list 1k 500 200 100
TEXT -16 824 Left 2 ;PULSE({-Vstim_peak} {Vstim_peak} 0 100n 100n 1m 2m)
TEXT 2176 760 Left 2 ;laplace=1/(s*170e-6+1.51)
TEXT 704 896 Left 2 !.step param Kpi list 27 10
RECTANGLE Normal 1104 1680 -448 1152 2
