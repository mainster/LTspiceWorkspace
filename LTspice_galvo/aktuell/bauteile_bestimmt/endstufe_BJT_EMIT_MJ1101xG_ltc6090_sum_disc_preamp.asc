Version 4
SHEET 1 4408 6248
WIRE 48 128 16 128
WIRE 80 128 48 128
WIRE 16 160 16 128
WIRE 768 240 720 240
WIRE 800 240 768 240
WIRE 352 256 352 208
WIRE 480 256 480 208
WIRE 16 272 16 240
WIRE 48 272 16 272
WIRE 80 272 48 272
WIRE 768 304 720 304
WIRE 800 304 768 304
WIRE 16 320 16 272
WIRE 352 352 352 336
WIRE 480 352 480 336
WIRE 480 352 352 352
WIRE 352 368 352 352
WIRE 16 416 16 400
WIRE 1296 464 1264 464
WIRE 1312 464 1296 464
WIRE 1424 464 1392 464
WIRE 1632 464 1424 464
WIRE 1840 464 1632 464
WIRE 1424 528 1424 464
WIRE 1632 528 1632 464
WIRE 1504 576 1488 576
WIRE 1568 576 1504 576
WIRE 1840 608 1840 464
WIRE 1200 640 1168 640
WIRE 1264 640 1200 640
WIRE 1360 640 1328 640
WIRE 1424 656 1424 624
WIRE 1504 656 1504 576
WIRE 1504 656 1424 656
WIRE 1632 656 1632 624
WIRE 1712 656 1632 656
WIRE 1776 656 1712 656
WIRE 1632 688 1632 656
WIRE 1200 720 1168 720
WIRE 1264 720 1200 720
WIRE 1360 720 1328 720
WIRE -272 736 -304 736
WIRE -192 736 -208 736
WIRE 1424 736 1424 656
WIRE 1568 736 1536 736
WIRE 1712 752 1712 656
WIRE 1744 752 1712 752
WIRE 1840 752 1840 704
WIRE 1840 752 1824 752
WIRE -272 800 -304 800
WIRE -192 800 -192 736
WIRE -192 800 -208 800
WIRE -144 800 -192 800
WIRE -32 800 -64 800
WIRE 0 800 -32 800
WIRE 96 800 80 800
WIRE 304 800 272 800
WIRE 416 800 384 800
WIRE 1840 800 1840 752
WIRE 1632 816 1632 784
WIRE 1632 832 1632 816
WIRE -272 848 -336 848
WIRE -192 848 -192 800
WIRE -192 848 -208 848
WIRE 32 848 16 848
WIRE 656 848 640 848
WIRE 32 864 32 848
WIRE 352 864 336 864
WIRE 656 864 656 848
WIRE -32 880 -32 800
WIRE 0 880 -32 880
WIRE 352 880 352 864
WIRE 624 880 608 880
WIRE 1248 880 1216 880
WIRE 1264 880 1248 880
WIRE 1440 880 1328 880
WIRE 1536 880 1536 736
WIRE 1536 880 1520 880
WIRE 96 896 64 896
WIRE 144 896 96 896
WIRE 176 896 144 896
WIRE 272 896 272 800
WIRE 272 896 256 896
WIRE 320 896 272 896
WIRE 736 896 688 896
WIRE 816 896 800 896
WIRE 848 896 816 896
WIRE 0 912 -32 912
WIRE 416 912 416 800
WIRE 416 912 384 912
WIRE 448 912 416 912
WIRE 480 912 448 912
WIRE 592 912 560 912
WIRE 624 912 592 912
WIRE 320 928 288 928
WIRE 32 944 32 928
WIRE 32 944 16 944
WIRE 592 944 592 912
WIRE 656 944 656 928
WIRE 656 944 640 944
WIRE 1248 944 1216 944
WIRE 1840 944 1840 880
WIRE 1840 944 1248 944
WIRE 1920 944 1840 944
WIRE 1984 944 1920 944
WIRE 2080 944 2048 944
WIRE 2208 944 2080 944
WIRE 352 960 352 944
WIRE 352 960 336 960
WIRE -160 976 -192 976
WIRE -32 976 -32 912
WIRE -32 976 -80 976
WIRE -16 976 -32 976
WIRE 96 976 96 896
WIRE 96 976 64 976
WIRE 1840 1024 1840 944
WIRE 2208 1024 2208 944
WIRE 2080 1040 2080 944
WIRE 592 1056 592 1024
WIRE 736 1056 592 1056
WIRE 816 1056 800 1056
WIRE 848 1056 816 1056
WIRE 1632 1056 1632 1040
WIRE 1632 1088 1632 1056
WIRE 1536 1136 1536 880
WIRE 1568 1136 1536 1136
WIRE 1744 1136 1712 1136
WIRE 1840 1136 1840 1104
WIRE 1840 1136 1824 1136
WIRE 2208 1136 2208 1104
WIRE 2080 1152 2080 1120
WIRE 1840 1184 1840 1136
WIRE -288 1216 -320 1216
WIRE -208 1216 -224 1216
WIRE 1632 1232 1632 1184
WIRE 1712 1232 1712 1136
WIRE 1712 1232 1632 1232
WIRE 1776 1232 1712 1232
WIRE 2208 1232 2208 1200
WIRE 304 1248 256 1248
WIRE 496 1248 384 1248
WIRE 1424 1264 1424 816
WIRE 1504 1264 1424 1264
WIRE -288 1280 -320 1280
WIRE -208 1280 -208 1216
WIRE -208 1280 -224 1280
WIRE -160 1280 -208 1280
WIRE -48 1280 -80 1280
WIRE -16 1280 -48 1280
WIRE 80 1280 64 1280
WIRE 704 1280 688 1280
WIRE 704 1296 704 1280
WIRE 1424 1296 1424 1264
WIRE 1632 1296 1632 1232
WIRE 304 1312 288 1312
WIRE -288 1328 -352 1328
WIRE -208 1328 -208 1280
WIRE -208 1328 -224 1328
WIRE 16 1328 0 1328
WIRE 304 1328 304 1312
WIRE 16 1344 16 1328
WIRE 688 1344 656 1344
WIRE 1504 1344 1504 1264
WIRE 1504 1344 1488 1344
WIRE 1568 1344 1504 1344
WIRE 2080 1344 2080 1232
WIRE -48 1360 -48 1280
WIRE -16 1360 -48 1360
WIRE 80 1376 48 1376
WIRE 128 1376 80 1376
WIRE 160 1376 128 1376
WIRE 256 1376 256 1248
WIRE 256 1376 240 1376
WIRE 288 1376 256 1376
WIRE 896 1376 848 1376
WIRE 976 1376 960 1376
WIRE 1024 1376 976 1376
WIRE -16 1392 -48 1392
WIRE 496 1408 496 1248
WIRE 496 1408 448 1408
WIRE 528 1408 496 1408
WIRE 560 1408 528 1408
WIRE 656 1408 640 1408
WIRE 688 1408 656 1408
WIRE 16 1424 16 1408
WIRE 16 1424 0 1424
WIRE 288 1440 256 1440
WIRE -176 1456 -208 1456
WIRE -48 1456 -48 1392
WIRE -48 1456 -96 1456
WIRE -32 1456 -48 1456
WIRE 80 1456 80 1376
WIRE 80 1456 48 1456
WIRE 1424 1456 1424 1392
WIRE 1632 1456 1632 1392
WIRE 1632 1456 1424 1456
WIRE 1760 1456 1632 1456
WIRE 1840 1456 1840 1280
WIRE 1840 1456 1760 1456
WIRE 704 1472 704 1456
WIRE 704 1472 688 1472
WIRE 304 1504 304 1488
WIRE 304 1504 288 1504
WIRE 656 1536 656 1408
WIRE 704 1536 656 1536
WIRE 896 1536 784 1536
WIRE 976 1536 960 1536
WIRE 1024 1536 976 1536
WIRE 1408 1616 1344 1616
WIRE 1472 1616 1408 1616
WIRE 1520 1616 1472 1616
WIRE 1632 1616 1600 1616
WIRE 1760 1616 1696 1616
WIRE 1856 1616 1760 1616
WIRE 2080 1616 2080 1344
WIRE 2080 1616 1936 1616
WIRE 2080 1632 2080 1616
WIRE 1856 1648 1856 1616
WIRE 1472 1664 1472 1616
WIRE 1936 1664 1936 1616
WIRE 1936 1728 1936 1712
WIRE 2080 1728 2080 1712
WIRE 2080 1728 1936 1728
WIRE 1856 1744 1856 1728
WIRE 1472 1760 1472 1728
WIRE 2080 1760 2080 1728
FLAG 352 368 0
FLAG 352 208 V+
FLAG 480 208 V-
FLAG 16 416 0
FLAG 1760 1456 V-
FLAG 2080 1760 0
FLAG 1920 944 Ucoil
FLAG 2080 1344 shunt
FLAG 304 1312 V+
FLAG 304 1504 V-
FLAG 48 272 stimac
FLAG 2208 1232 0
FLAG 1200 720 stim
FLAG 1200 640 I_cmd
FLAG 1856 1744 0
FLAG 1760 1616 fbSens
FLAG 1632 816 V-
FLAG 1632 1056 V+
FLAG -304 800 stimac
FLAG 48 128 stimOffs
FLAG -304 736 stimOffs
FLAG 1296 464 V+
FLAG -336 848 0
FLAG 32 848 V2-
FLAG 32 944 V2+
FLAG 96 800 0
FLAG -192 976 Isens
FLAG 144 896 sumA
FLAG 288 928 0
FLAG 352 960 V-
FLAG 352 864 V+
FLAG 1472 1760 0
FLAG 1408 1616 Isens
FLAG 448 912 errA
FLAG 768 304 V2-
FLAG 768 240 V2+
FLAG 256 1440 0
FLAG 608 880 0
FLAG 656 848 V-
FLAG 656 944 V+
FLAG 816 896 opV
FLAG 1248 880 opV
FLAG 1248 944 Ucoil
FLAG 816 1056 ucoil
FLAG -320 1280 stimac
FLAG -320 1216 stimOffs
FLAG -352 1328 0
FLAG 16 1328 V2-
FLAG 16 1424 V2+
FLAG 80 1280 0
FLAG -208 1456 Isens
FLAG 128 1376 sumB
FLAG 704 1472 V+
FLAG 704 1280 V-
FLAG 656 1344 0
FLAG 528 1408 errB
FLAG 976 1376 opV
FLAG 976 1536 ucoil
SYMBOL voltage 352 240 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value 30
SYMBOL voltage 480 240 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V7
SYMATTR Value -30
SYMBOL voltage 16 304 R0
WINDOW 123 -98 180 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -460 247 Left 2
SYMATTR Value PULSE({-Vstim_peak} {Vstim_peak} 0.5m 50n 50n 1m 2m)
SYMATTR InstName Vstim
SYMBOL npn 1568 1296 R0
SYMATTR InstName Q1
SYMATTR Value FMMT624
SYMBOL pnp 1568 624 M180
SYMATTR InstName Q2
SYMATTR Value FMMT723
SYMBOL res 1840 1120 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value {bias}
SYMBOL res 1728 768 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R10
SYMATTR Value {bias}
SYMBOL res 1824 784 R0
SYMATTR InstName R11
SYMATTR Value {Rs}
SYMBOL res 1824 1120 M180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R12
SYMATTR Value {Rs}
SYMBOL res 2064 1136 R0
SYMATTR InstName R14
SYMATTR Value 1.5
SYMBOL ind 2064 1024 R0
SYMATTR InstName L1
SYMATTR Value 170µ
SYMBOL res 2064 1616 R0
SYMATTR InstName Rshunt
SYMATTR Value 0.01
SYMBOL res 2192 1008 R0
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL cap 2192 1136 R0
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL Misc\\jumper 1296 816 R0
SYMATTR InstName X2
SYMBOL Misc\\jumper 1296 640 R0
SYMATTR InstName X3
SYMBOL Misc\\jumper 2016 880 R0
SYMATTR InstName X4
SYMBOL Misc\\jumper 1296 560 R0
SYMATTR InstName X6
SYMBOL Misc\\jumper 1664 1552 R0
SYMATTR InstName X7
SYMBOL crtl-V-V 1856 1632 M0
SYMATTR InstName E4
SYMATTR Value 25
SYMBOL pnp 1568 784 M180
WINDOW 0 -54 97 Left 2
WINDOW 3 -56 127 Left 2
SYMATTR InstName Q4
SYMATTR Value FMMT723
SYMBOL npn 1568 1088 R0
WINDOW 0 50 27 Left 2
WINDOW 3 48 58 Left 2
SYMATTR InstName Q5
SYMATTR Value FMMT624
SYMBOL MJ11016G 1776 608 R0
SYMATTR InstName U9
SYMBOL MJ11015G 1776 1280 M180
SYMATTR InstName U10
SYMBOL pnp 1488 624 R180
SYMATTR InstName Q6
SYMATTR Value FMMT723
SYMBOL npn 1488 1296 M0
SYMATTR InstName Q7
SYMATTR Value FMMT624
SYMBOL res 1408 720 R0
WINDOW 0 -125 46 Left 2
WINDOW 3 -125 76 Left 2
SYMATTR InstName R40
SYMATTR Value {Rset_bias}
SYMBOL res 1536 864 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R42
SYMATTR Value 100
SYMBOL source-V 16 144 R0
WINDOW 0 -27 56 VBottom 2
WINDOW 3 -223 300 Top 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value PULSE({Vstim_peak} 0 0.5m 50n 50n 1)
SYMBOL Misc\\jumper -240 672 R0
SYMATTR InstName X1
SYMBOL source-V 1296 464 M90
WINDOW 0 -27 56 VBottom 2
WINDOW 3 -57 200 VTop 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value SINE(0 1 5k 3.4m)
SYMBOL res -64 960 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R50
SYMATTR Value {Rsu}
SYMBOL res -160 784 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R51
SYMATTR Value {Rsu}
SYMBOL res -32 960 M90
WINDOW 0 56 114 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R52
SYMATTR Value {Rsu}
SYMBOL res 96 816 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 81 59 VBottom 2
SYMATTR InstName R53
SYMATTR Value {Rsu}
SYMBOL NJM4580 32 960 M180
SYMATTR InstName U17
SYMBOL res 288 816 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R54
SYMATTR Value {10k*Kpi}
SYMBOL res 160 912 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R55
SYMATTR Value 10k
SYMBOL res 1616 1600 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 680
SYMBOL cap 1456 1664 R0
SYMATTR InstName C1
SYMATTR Value 1n
SYMBOL source-Vmarker 720 240 R0
SYMATTR Value V=16
SYMATTR InstName U1
SYMBOL source-Vmarker 720 304 R0
SYMATTR Value V=-16
SYMATTR InstName U2
SYMBOL Opamps\\opamp2 352 848 R0
WINDOW 3 13 9 Left 2
SYMATTR Value ada4700
SYMATTR InstName U11
SYMATTR SpiceModel ada4700
SYMBOL Opamps\\LTC6090 352 1408 R0
SYMATTR InstName U16
SYMBOL res 608 928 M0
SYMATTR InstName R1
SYMATTR Value {10k*Kpv}
SYMBOL Opamps\\opamp2 656 960 M180
WINDOW 3 18 101 Left 2
SYMATTR Value ada4700
SYMATTR InstName U3
SYMATTR SpiceModel ada4700
SYMBOL res 464 928 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL Misc\\jumper 768 832 R0
WINDOW 0 1 97 Bottom 2
SYMATTR InstName X5
SYMBOL Misc\\jumper 768 992 R0
SYMATTR InstName X8
SYMBOL Misc\\jumper -256 1152 R0
SYMATTR InstName X9
SYMBOL res -80 1440 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {Rsu}
SYMBOL res -176 1264 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R6
SYMATTR Value {Rsu}
SYMBOL res -48 1440 M90
WINDOW 0 56 114 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R7
SYMATTR Value {Rsu}
SYMBOL res 80 1296 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 81 59 VBottom 2
SYMATTR InstName R8
SYMATTR Value {Rsu}
SYMBOL NJM4580 16 1440 M180
SYMATTR InstName U4
SYMBOL res 144 1392 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res 288 1264 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R15
SYMATTR Value {10k*Kpi}
SYMBOL Opamps\\LTC6090 752 1376 M180
SYMATTR InstName U5
SYMBOL res 544 1392 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL res 688 1520 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R17
SYMATTR Value {10k*Kpi}
TEXT 744 88 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/ADA4700.sub
TEXT 744 56 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/LM358.sub
TEXT 1768 1560 Left 2 ;Shunt monitor Gain
TEXT 552 384 Left 2 !.tran 7m startup
TEXT 1632 144 Left 2 !; ---------------------\n;   Power amp\n; ---------------------\n.param Ik1 = 3m\n.param bias = 2.5k\n.param bias_b = 100\n.param Rs = 10m
TEXT 1064 152 Left 2 !; ---------------------\n;   Compensator\n; ---------------------\n.param Uset = 3\n.param Rsu = 10k\n.param Kpv = 7\n.param Kpi = 2\n.param Ki = 15000
TEXT 1336 144 Left 2 !; ---------------------\n;   SOURCES\n; ---------------------\n.param Vsup = 30V\n.param Vstim_peak = 5
TEXT -440 576 Left 2 ;PULSE(-{Vstim_peak} {Vstim_peak} 0.5m 10n 10n 1m 2m)
TEXT -440 608 Left 2 ;SINE(-0 20 500 0.5m)
TEXT 1168 -144 Left 2 !.MEAS TRAN slewHi DERIV I(Rshunt) WHEN I(Rshunt)='15'\n.MEAS TRAN slewLo DERIV I(Rshunt) WHEN I(Rshunt)='-15'\n.MEAS TRAN tRise TRIG I(Rshunt) VAL=-15 RISE=1\n+ TARG I(Rshunt) VAL=15 TD 10ns RISE=1\n.MEAS TRAN tFall TRIG I(Rshunt) VAL=15 FALL=1\n+ TARG I(Rshunt) VAL=-15 TD 10ns FALL=2
TEXT 760 600 Left 2 ;.step param Kpv list 1 7\n.step param Kpi list 1 2 5
TEXT 480 632 Left 2 !.param Rset_bias = 2k
TEXT 760 568 Left 2 ;.step TEMP 10 100 20
TEXT -314 166 Left 2 ;.dc Vstim -10 10 0.001
RECTANGLE Normal 1056 1120 -448 672 2
RECTANGLE Normal 1056 1616 -448 1152 2
