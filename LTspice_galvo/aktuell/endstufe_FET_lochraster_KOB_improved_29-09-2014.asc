Version 4
SHEET 1 1316 868
WIRE -1008 -1744 -1040 -1744
WIRE -976 -1744 -1008 -1744
WIRE -1040 -1712 -1040 -1744
WIRE -1040 -1600 -1040 -1632
WIRE -1008 -1600 -1040 -1600
WIRE -976 -1600 -1008 -1600
WIRE -1040 -1552 -1040 -1600
WIRE -1040 -1456 -1040 -1472
WIRE -1440 -1152 -1504 -1152
WIRE -1328 -1152 -1360 -1152
WIRE -1296 -1152 -1328 -1152
WIRE -1200 -1152 -1216 -1152
WIRE -992 -1152 -1024 -1152
WIRE -880 -1152 -912 -1152
WIRE -1264 -1104 -1280 -1104
WIRE -1264 -1088 -1264 -1104
WIRE -944 -1088 -960 -1088
WIRE -1328 -1072 -1328 -1152
WIRE -1296 -1072 -1328 -1072
WIRE -944 -1072 -944 -1088
WIRE 272 -1072 272 -1120
WIRE 368 -1072 368 -1120
WIRE -1200 -1056 -1232 -1056
WIRE -1152 -1056 -1200 -1056
WIRE -1120 -1056 -1152 -1056
WIRE -1024 -1056 -1024 -1152
WIRE -1024 -1056 -1040 -1056
WIRE -976 -1056 -1024 -1056
WIRE -304 -1056 -304 -1088
WIRE -1296 -1040 -1328 -1040
WIRE -880 -1040 -880 -1152
WIRE -880 -1040 -912 -1040
WIRE -976 -1024 -1008 -1024
WIRE -1264 -1008 -1264 -1024
WIRE -1264 -1008 -1280 -1008
WIRE -944 -992 -944 -1008
WIRE -944 -992 -960 -992
WIRE -1456 -976 -1488 -976
WIRE -1328 -976 -1328 -1040
WIRE -1328 -976 -1376 -976
WIRE -1312 -976 -1328 -976
WIRE -1200 -976 -1200 -1056
WIRE -1200 -976 -1232 -976
WIRE 16 -976 16 -1088
WIRE 16 -976 -128 -976
WIRE 272 -944 272 -992
WIRE 368 -944 368 -992
WIRE 368 -944 272 -944
WIRE -304 -928 -304 -976
WIRE -224 -928 -304 -928
WIRE -192 -928 -224 -928
WIRE 16 -928 16 -976
WIRE -304 -912 -304 -928
WIRE 368 -912 368 -944
WIRE -128 -848 -128 -880
WIRE -80 -848 -128 -848
WIRE -32 -848 -80 -848
WIRE -304 -816 -304 -832
WIRE -128 -784 -128 -848
WIRE -96 -784 -128 -784
WIRE 16 -784 16 -832
WIRE 16 -784 -16 -784
WIRE 16 -736 16 -784
WIRE -528 -720 -544 -720
WIRE -528 -704 -528 -720
WIRE -560 -688 -592 -688
WIRE -1216 -672 -1232 -672
WIRE -1104 -672 -1136 -672
WIRE -1056 -672 -1104 -672
WIRE -960 -672 -976 -672
WIRE -464 -672 -496 -672
WIRE -400 -672 -464 -672
WIRE -304 -672 -304 -752
WIRE -304 -672 -336 -672
WIRE -560 -656 -608 -656
WIRE -464 -656 -464 -672
WIRE -528 -624 -528 -640
WIRE -528 -624 -544 -624
WIRE -1024 -608 -1040 -608
WIRE -304 -608 -304 -672
WIRE -1024 -592 -1024 -608
WIRE -1104 -576 -1104 -672
WIRE -1056 -576 -1104 -576
WIRE -960 -560 -960 -672
WIRE -960 -560 -992 -560
WIRE -896 -560 -960 -560
WIRE -736 -560 -800 -560
WIRE -608 -560 -608 -656
WIRE -608 -560 -656 -560
WIRE -464 -560 -464 -592
WIRE -464 -560 -608 -560
WIRE -416 -560 -464 -560
WIRE 16 -560 16 -656
WIRE 16 -560 -336 -560
WIRE 128 -560 16 -560
WIRE 160 -560 128 -560
WIRE 256 -560 224 -560
WIRE -1264 -544 -1328 -544
WIRE -1232 -544 -1264 -544
WIRE -1104 -544 -1152 -544
WIRE -1056 -544 -1104 -544
WIRE 16 -528 16 -560
WIRE -1024 -512 -1024 -528
WIRE -1024 -512 -1040 -512
WIRE -304 -496 -304 -608
WIRE 608 -496 496 -496
WIRE -1456 -480 -1488 -480
WIRE -1344 -480 -1376 -480
WIRE -1104 -480 -1104 -544
WIRE 608 -448 608 -496
WIRE -1408 -416 -1424 -416
WIRE 256 -416 256 -560
WIRE -1408 -400 -1408 -416
WIRE -96 -400 -128 -400
WIRE 16 -400 16 -448
WIRE 16 -400 -16 -400
WIRE -1600 -384 -1616 -384
WIRE -1584 -384 -1600 -384
WIRE -1488 -384 -1488 -480
WIRE -1488 -384 -1504 -384
WIRE -1440 -384 -1488 -384
WIRE -1344 -368 -1344 -480
WIRE -1344 -368 -1376 -368
WIRE -1296 -368 -1344 -368
WIRE -1280 -368 -1296 -368
WIRE -1104 -368 -1104 -400
WIRE -1072 -368 -1104 -368
WIRE -1040 -368 -1072 -368
WIRE -304 -368 -304 -432
WIRE 16 -368 16 -400
WIRE -1440 -352 -1472 -352
WIRE 16 -352 16 -368
WIRE -128 -336 -128 -400
WIRE -64 -336 -128 -336
WIRE -32 -336 -64 -336
WIRE -1408 -320 -1408 -336
WIRE -1408 -320 -1424 -320
WIRE 256 -320 256 -336
WIRE 496 -320 496 -496
WIRE 496 -320 256 -320
WIRE 608 -320 608 -368
WIRE -128 -304 -128 -336
WIRE -304 -256 -304 -288
WIRE -240 -256 -304 -256
WIRE -192 -256 -240 -256
WIRE 688 -256 656 -256
WIRE -304 -224 -304 -256
WIRE 688 -224 688 -256
WIRE 16 -208 16 -256
WIRE 16 -208 -128 -208
WIRE 256 -208 256 -240
WIRE 608 -208 608 -240
WIRE 608 -208 256 -208
WIRE 688 -208 688 -224
WIRE -1024 -160 -1136 -160
WIRE -800 -160 -960 -160
WIRE -304 -128 -304 -144
WIRE 688 -96 688 -144
WIRE 16 -80 16 -208
WIRE 16 -80 0 -80
WIRE -912 -16 -928 -16
WIRE -928 0 -928 -16
WIRE -800 16 -800 -160
WIRE -800 16 -896 16
WIRE -656 16 -800 16
WIRE -592 16 -656 16
WIRE -416 16 -512 16
WIRE 256 16 256 -208
WIRE 256 16 -416 16
WIRE 288 16 256 16
WIRE -1216 32 -1488 32
WIRE -1136 32 -1136 -160
WIRE -1136 32 -1216 32
WIRE -1008 32 -1136 32
WIRE -960 32 -1008 32
WIRE -1008 48 -1008 32
WIRE -864 48 -896 48
WIRE 256 48 256 16
WIRE -656 64 -656 16
WIRE -928 80 -928 64
WIRE -912 80 -928 80
WIRE -1008 144 -1008 128
WIRE -864 144 -864 48
WIRE -864 144 -1008 144
WIRE -1008 160 -1008 144
WIRE -656 160 -656 128
WIRE 256 160 256 128
WIRE -1008 256 -1008 240
WIRE 368 352 368 320
WIRE 480 400 480 352
WIRE 368 448 368 432
WIRE 416 448 368 448
WIRE 368 496 368 448
WIRE 736 512 736 464
WIRE 480 528 480 496
WIRE 480 528 400 528
WIRE 480 560 480 528
WIRE 736 640 736 592
WIRE 368 656 368 560
WIRE 432 656 368 656
WIRE 480 656 480 640
WIRE 480 656 432 656
FLAG 128 -560 out_A
FLAG -64 -336 Gp1
FLAG 16 -368 Sp1
FLAG 16 -784 Sn1
FLAG -80 -848 Gn1
FLAG 432 656 Vmin
FLAG 368 -912 0
FLAG -224 -928 b1
FLAG -240 -256 b2
FLAG 256 160 0
FLAG 480 272 0
FLAG 736 464 Vcs
FLAG 736 640 0
FLAG 768 656 0
FLAG -1456 672 0
FLAG 288 16 shunt
FLAG 272 -1120 V+
FLAG 16 -1088 V+
FLAG 368 320 V+
FLAG 368 -1120 V-
FLAG 0 -80 V-
FLAG -592 -688 0
FLAG -528 -624 V+
FLAG -528 -720 V-
FLAG -1040 -1456 0
FLAG -1008 -1600 stimac
FLAG -1008 -1744 stimOffs
FLAG -304 -1168 V+
FLAG -304 -48 V-
FLAG -304 -608 dd
FLAG 656 -304 0
FLAG 688 -96 0
FLAG -1264 -1104 V-
FLAG -1264 -1008 V+
FLAG -1200 -1152 0
FLAG -1504 -1152 stimoffs
FLAG -1488 -976 Isens
FLAG -1152 -1056 sum5
FLAG -1008 -1024 0
FLAG -944 -992 V-
FLAG -944 -1088 V+
FLAG -800 -560 ctrl
FLAG -928 -16 V-
FLAG -928 80 V+
FLAG -1008 256 0
FLAG -1216 32 IsensA
FLAG -416 16 shunt
FLAG -656 160 0
FLAG -1472 -352 0
FLAG -1232 -672 0
FLAG -1024 -512 V-
FLAG -1408 -320 V-
FLAG -1024 -608 V+
FLAG -1408 -416 V+
FLAG -1296 -368 preAmp
FLAG -1600 -384 stimac
FLAG -1072 -368 isensA
FLAG -1264 -544 stimac
FLAG -896 -560 ctrl
FLAG -560 -448 0
FLAG -560 -512 0
SYMBOL res -112 -768 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value {bias}
SYMBOL res 0 -384 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 78 92 VBottom 2
SYMATTR InstName R2
SYMATTR Value {bias*0.7}
SYMBOL res 240 -336 R0
SYMATTR InstName Rload1
SYMATTR Value {load2}
SYMBOL EIT_Semiconductors\\nmos -32 -928 R0
SYMATTR InstName M1
SYMATTR Value IRFP240
SYMBOL EIT_Semiconductors\\pmos -32 -256 M180
SYMATTR InstName M2
SYMATTR Value IRFP9240
SYMBOL ind 240 -432 R0
SYMATTR InstName L1
SYMATTR Value 170µ
SYMBOL res 384 336 M0
SYMATTR InstName R10
SYMATTR Value 4.7k
SYMBOL EIT_Semiconductors\\npn 416 400 R0
SYMATTR InstName Q1
SYMATTR Value BC547B
SYMBOL res 464 544 R0
SYMATTR InstName R11
SYMATTR Value 315
SYMBOL source-V 272 -1088 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -87 92 Left 2
SYMATTR Value {vsup}
SYMATTR InstName V1
SYMBOL source-V 368 -1088 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -72 98 Left 2
SYMATTR Value {-vsup}
SYMATTR InstName V2
SYMBOL res -320 -240 R0
SYMATTR InstName R12
SYMATTR Value 1m
SYMBOL res -320 -1072 R0
SYMATTR InstName R13
SYMATTR Value 1m
SYMBOL source-I -304 -1088 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I1
SYMATTR Value {IK1}
SYMBOL source-I -304 -48 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I2
SYMATTR Value {Ik1}
SYMBOL res 240 32 R0
SYMATTR InstName R5
SYMATTR Value {0.1+(100t*jp)}
SYMBOL res 0 -752 R0
SYMATTR InstName R8
SYMATTR Value {Rs}
SYMBOL res 0 -544 R0
SYMATTR InstName R9
SYMATTR Value {Rs}
SYMBOL res 464 256 R0
SYMATTR InstName R16
SYMATTR Value 100
SYMBOL source-V 736 496 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -87 92 Left 2
SYMATTR Value 30
SYMATTR InstName V8
SYMBOL Misc\\jumper 192 -624 R0
SYMATTR InstName X1
SYMBOL EXTRA\\VolReg\\TL431 384 496 M0
SYMATTR InstName U2
SYMBOL res -432 -576 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 32 57 VTop 2
SYMATTR InstName R17
SYMATTR Value {10k*10}
SYMBOL voltage -1040 -1568 R0
WINDOW 123 -533 90 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -530 57 Left 2
SYMATTR Value2 AC 1
SYMATTR Value PULSE({-Vstim_peak} {Vstim_peak} 0 50n 50n 1)
SYMATTR InstName Vstim1
SYMBOL source-V -1040 -1728 R0
WINDOW 0 -27 56 VBottom 2
WINDOW 3 -274 36 Top 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value PULSE({Vstim_peak} 0 0.5m 50n 50n 1)
SYMBOL res -320 -928 R0
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res -320 -384 R0
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL Misc\\jumper -368 -736 R0
SYMATTR InstName X3
SYMBOL diode -320 -816 R0
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode -320 -496 R0
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL NJM4580 -528 -608 M180
WINDOW 3 -82 164 Left 2
SYMATTR InstName U1
SYMBOL EIT_Semiconductors\\npn -192 -976 R0
SYMATTR InstName T1
SYMATTR Value 2N2222
SYMBOL EIT_Semiconductors\\pnp -192 -208 M180
SYMATTR InstName T2
SYMATTR Value 2N4403
SYMBOL cap -576 -512 R0
SYMATTR InstName C2
SYMATTR Value {cm}
SYMBOL res 592 -464 R0
SYMATTR InstName R6
SYMATTR Value 2
SYMBOL sw 608 -336 M0
SYMATTR InstName S1
SYMATTR Value SWx
SYMBOL source-V 688 -240 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -87 92 Left 2
SYMATTR Value PULSE(-1 1 3m 500u 100u 5m)
SYMATTR InstName V3
SYMBOL res -1360 -992 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R26
SYMATTR Value {Rsu}
SYMBOL res -1456 -1168 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R27
SYMATTR Value {Rsu}
SYMBOL res -1328 -992 M90
WINDOW 0 56 114 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R28
SYMATTR Value {Rsu}
SYMBOL res -1200 -1136 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 81 59 VBottom 2
SYMATTR InstName R29
SYMATTR Value {Rsu}
SYMBOL NJM4580 -1264 -992 M180
SYMATTR InstName U6
SYMBOL res -1008 -1136 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R30
SYMATTR Value {10k*Gain}
SYMBOL res -1136 -1040 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R31
SYMATTR Value 10k
SYMBOL NJM4580 -944 -1104 R0
SYMATTR InstName U7
SYMBOL res -752 -576 M90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL res -1024 32 R0
WINDOW 0 -32 45 Left 2
WINDOW 3 -117 14 Left 2
SYMATTR InstName R7
SYMATTR Value {10k*Gstat}
SYMBOL NJM4580 -928 96 R180
SYMATTR InstName U3
SYMBOL res -992 144 M0
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL res -496 0 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 680
SYMBOL res -1472 -464 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R19
SYMATTR Value {10k*Gain}
SYMBOL res -1600 -368 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL res -1120 -656 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R21
SYMATTR Value {Rsu}
SYMBOL res -1248 -528 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R22
SYMATTR Value {Rsu}
SYMBOL res -1072 -656 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R23
SYMATTR Value {Rsu}
SYMBOL res -1088 -384 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R24
SYMATTR Value {Rsu}
SYMBOL NJM4580 -1024 -624 R0
SYMATTR InstName U4
SYMBOL NJM4580 -1408 -432 R0
SYMATTR InstName U5
TEXT -688 304 Left 2 !.model npnx npn (Bf=200 Is={10m/exp(0.7/26m)}\n.model pnpx pnp (Bf=200 Is={10m/exp(0.7/26m)}\n.model Dx D (Is={(20*50u)/exp(0.7/26m)}\n.model Osw SW(Ron=10u Roff=10meg Vt=12 Vh=-.2)
TEXT 128 -1280 Left 2 !;ac oct 100 1 100meg
TEXT 248 -1360 Left 2 ;.dc Vstim1 -0.1 0.1 0.0001
TEXT -760 -1536 Left 2 !; ---------------------\n;   Power amp\n; ---------------------\n.param Ik1 = 4.2m\n.param bias = 420\n.param bias_b = 200\n.param Rs = 1u
TEXT -248 -1544 Left 2 !; ---------------------\n;   Compensator\n; ---------------------\n.param Rsu = 1k\n.param Kpv = 3\n.param Gain = 1
TEXT -512 -1528 Left 2 !; ---------------------\n;   SOURCES\n; ---------------------\n.param Vsup =  12\n.param Ipeak = 10A\n.param Vstim_peak = 3
TEXT 248 -1336 Left 2 ;.option noopiter
TEXT 248 -1416 Left 2 !.ac oct 100 1 1meg
TEXT -656 -1296 Left 3 ;PCB mit fix
TEXT -1712 -256 Left 3 ;Externer Regler V1
TEXT 96 -48 Left 2 !.param jp = 0
TEXT -48 280 Left 2 ;.step param jp list 0 1
TEXT -776 -872 Left 2 !.param Cm = 10p\n;.step param cm list 1p 10p 50p 150p 500p
TEXT -592 -1208 Left 2 ;.step param gain list 1 2 5 8
TEXT -376 544 Left 2 !.model SWx SW(Ron=1u Roff=100Meg Vt=0 Vh=-.5 )
TEXT -1008 -104 Left 2 !.param Gstat = 8
TEXT -1712 -824 Left 3 ;Externer Regler V2
TEXT -1512 -1600 Left 2 ;PULSE({Vstim_peak} 0 0.5m 50n 50n 1)
TEXT 568 32 Left 2 !.step param load2 list 1.5 0.75
RECTANGLE Normal 448 224 -768 -1248 1
RECTANGLE Normal -816 -288 -1712 -816 2
RECTANGLE Normal -816 -848 -1712 -1376 2
