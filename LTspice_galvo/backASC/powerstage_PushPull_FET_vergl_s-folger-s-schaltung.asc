Version 4
SHEET 1 4496 6248
WIRE 672 -640 624 -640
WIRE 1856 -640 1840 -640
WIRE 2000 -640 1984 -640
WIRE 848 -624 768 -624
WIRE 1856 -608 1856 -640
WIRE 1984 -608 1984 -640
WIRE 624 -592 624 -640
WIRE 672 -576 672 -640
WIRE 768 -576 768 -624
WIRE 848 -496 848 -624
WIRE 848 -496 800 -496
WIRE 1856 -480 1856 -528
WIRE 1984 -480 1984 -528
WIRE 2144 -480 2144 -528
WIRE 2272 -480 2272 -528
WIRE 624 -448 624 -496
WIRE 768 -432 768 -480
WIRE 768 -416 768 -432
WIRE 1184 -384 1184 -464
WIRE 1552 -384 1552 -464
WIRE 1856 -384 1856 -400
WIRE 1920 -384 1856 -384
WIRE 1984 -384 1984 -400
WIRE 1984 -384 1920 -384
WIRE 2144 -384 2144 -400
WIRE 2272 -384 2272 -400
WIRE 2272 -384 2144 -384
WIRE 1232 -368 1216 -368
WIRE 1312 -368 1232 -368
WIRE 1456 -368 1312 -368
WIRE 1504 -368 1456 -368
WIRE 2144 -368 2144 -384
WIRE 960 -320 960 -464
WIRE 1184 -240 1184 -288
WIRE 1312 -240 1312 -368
WIRE 1312 -240 1184 -240
WIRE 1184 -192 1184 -240
WIRE 960 -112 960 -240
WIRE 1104 -112 960 -112
WIRE 1136 -112 1104 -112
WIRE 1184 -80 1184 -96
WIRE 960 -48 960 -112
WIRE 1184 -48 1184 -80
WIRE 912 -32 864 -32
WIRE 960 64 960 48
WIRE 1184 80 1184 32
WIRE 1200 80 1184 80
WIRE 1328 80 1280 80
WIRE 1392 80 1328 80
WIRE 1552 80 1552 -288
WIRE 1552 80 1472 80
WIRE 1664 80 1552 80
WIRE 1840 80 1664 80
WIRE 960 96 960 64
WIRE 768 112 688 112
WIRE 864 112 864 -32
WIRE 864 112 832 112
WIRE 1040 128 1040 112
WIRE 1328 128 1328 80
WIRE 1840 128 1840 80
WIRE 960 160 960 128
WIRE 1184 160 1184 80
WIRE 960 176 960 160
WIRE 576 208 560 208
WIRE 576 224 576 208
WIRE 1040 224 1040 208
WIRE 544 240 496 240
WIRE 1840 240 1840 208
WIRE 768 256 608 256
WIRE 864 256 864 112
WIRE 864 256 832 256
WIRE 912 256 864 256
WIRE 1328 256 1328 208
WIRE 368 272 352 272
WIRE 400 272 368 272
WIRE 528 272 480 272
WIRE 544 272 528 272
WIRE 1184 272 1184 240
WIRE 576 304 576 288
WIRE 576 304 560 304
WIRE 528 320 528 272
WIRE 1184 320 1184 272
WIRE 960 336 960 272
WIRE 1104 336 960 336
WIRE 1136 336 1104 336
WIRE 1680 352 1632 352
WIRE 1840 352 1840 320
WIRE 1840 352 1680 352
WIRE 1680 400 1632 400
WIRE 1712 400 1680 400
WIRE 1840 416 1840 352
WIRE 1840 416 1792 416
WIRE 528 432 528 400
WIRE 576 432 528 432
WIRE 624 432 576 432
WIRE 768 432 688 432
WIRE 816 432 768 432
WIRE 960 432 960 336
WIRE 1712 432 1712 400
WIRE 1840 432 1840 416
WIRE 1792 448 1792 416
WIRE 528 480 528 432
WIRE 624 480 528 480
WIRE 768 480 688 480
WIRE 800 480 768 480
WIRE 1184 480 1184 416
WIRE 1296 480 1184 480
WIRE 1184 512 1184 480
WIRE 1552 512 1552 80
WIRE 1712 528 1712 512
WIRE 1792 528 1792 496
WIRE 1840 528 1840 512
WIRE 1840 528 1792 528
WIRE 1840 560 1840 528
WIRE 1296 592 1296 480
WIRE 1296 592 1232 592
WIRE 1472 592 1296 592
WIRE 1504 592 1472 592
WIRE 624 672 576 672
WIRE 1184 672 1184 608
WIRE 1552 672 1552 608
WIRE 960 688 960 512
WIRE 576 752 576 672
WIRE 1776 800 1616 800
WIRE 1616 848 1616 800
WIRE 1616 864 1616 848
WIRE 576 880 576 832
WIRE 1776 896 1776 800
WIRE 1568 928 1488 928
WIRE 1488 960 1488 928
WIRE 1616 976 1616 944
WIRE 1488 1056 1488 1040
FLAG 2144 -368 0
FLAG 2144 -528 V+
FLAG 2272 -528 V-
FLAG 576 880 0
FLAG 1664 80 out_A
FLAG 624 672 stim
FLAG 688 112 stim
FLAG 1552 -464 V+
FLAG 1328 256 0
FLAG 1040 224 0
FLAG 1104 -112 G4
FLAG 1104 336 G5
FLAG 1184 -80 S4
FLAG 1184 272 S5
FLAG 1456 -368 G2
FLAG 1472 592 G1
FLAG 960 160 V+drv
FLAG 960 64 V-drv
FLAG 624 -448 0
FLAG 784 -448 0
FLAG 768 -432 0
FLAG 1776 976 0
FLAG 1616 976 0
FLAG 1488 1056 0
FLAG 1840 560 0
FLAG 1184 672 V-drv
FLAG 1920 -384 0
FLAG 1856 -640 V+drv
FLAG 1984 -640 V-drv
FLAG 576 208 V-drv
FLAG 1552 672 V-
FLAG 576 304 V+drv
FLAG 960 -464 V+drv
FLAG 1184 -464 V+drv
FLAG 960 688 V-drv
FLAG 368 272 stim
FLAG 496 240 0
FLAG 1680 352 shunt
FLAG 768 432 shunt
FLAG 1712 528 0
FLAG 1680 400 N_shunt
FLAG 768 480 N_shunt
FLAG 576 432 fb_in
SYMBOL voltage 2144 -496 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value 30
SYMBOL voltage 2272 -496 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V7
SYMATTR Value -30
SYMBOL voltage 576 736 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -114 178 Left 2
SYMATTR Value2 AC 1
SYMATTR InstName V8
SYMATTR Value PULSE(-5 5 0 10n 10n 1m 2m)
SYMBOL nmos 1504 512 R0
SYMATTR InstName M1
SYMATTR Value IRFP240
SYMBOL pmos 1504 -288 M180
SYMATTR InstName M2
SYMATTR Value IRF9640
SYMBOL res 384 288 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res 1824 416 R0
SYMATTR InstName Rsh
SYMATTR Value 0.01
SYMBOL ind 1824 112 R0
SYMATTR InstName L1
SYMATTR Value 170µ
SYMBOL Opamps\\opamp2 576 320 M180
SYMATTR InstName U4
SYMATTR Value ada4700
SYMATTR SpiceModel ada4700
SYMBOL res 544 304 M0
SYMATTR InstName R1
SYMATTR Value 12k
SYMBOL pmos 672 -496 R180
SYMATTR InstName M7
SYMATTR Value BSS84
SYMBOL res 1488 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res 1344 224 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R4
SYMATTR Value 100
SYMBOL current 960 -320 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I1
SYMATTR Value {I1}
SYMBOL current 960 432 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I2
SYMATTR Value {I1}
SYMBOL res 1184 96 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value 1µ
SYMBOL res 1024 112 R0
WINDOW 3 25 11 Left 2
SYMATTR Value 10meg
SYMATTR InstName R7
SYMBOL res 1200 256 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R8
SYMATTR Value 1µ
SYMBOL res 1168 -64 R0
SYMATTR InstName R9
SYMATTR Value 1µ
SYMBOL nmos 1136 -192 R0
SYMATTR InstName M5
SYMATTR Value nmosA
SYMBOL nmos 1568 848 R0
SYMATTR InstName M6
SYMATTR Value IRFP240
SYMBOL voltage 1776 880 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL voltage 1488 944 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 5
SYMBOL pmos 912 48 M180
SYMATTR InstName M4
SYMATTR Value BSS84
SYMBOL pmos 1136 416 M180
SYMATTR InstName M3
SYMATTR Value pmosA
SYMBOL pmos 1232 -288 R180
SYMATTR InstName M9
SYMATTR Value pmosA
SYMBOL nmos 912 176 R0
SYMATTR InstName M8
SYMATTR Value nmosA
SYMBOL nmos 1232 512 M0
SYMATTR InstName M10
SYMATTR Value nmosA
SYMBOL voltage 1856 -496 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value 30V
SYMBOL voltage 1984 -496 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value -30
SYMBOL voltage 1856 -624 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value {10V*hv}
SYMBOL voltage 1984 -624 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V9
SYMATTR Value {-10V*hv}
SYMBOL Misc\\jumper 800 192 R0
SYMATTR InstName X1
SYMBOL res 1824 224 R0
SYMATTR InstName Rc
SYMATTR Value 1.5
SYMBOL crtl-V-V 1712 416 M0
SYMATTR InstName E1
SYMATTR Value 100
SYMBOL Misc\\jumper 656 416 R0
SYMATTR InstName X2
TEXT 808 -592 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/ADA4700.sub
TEXT 808 -560 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/LM358.sub
TEXT 584 -384 Left 2 !.param I1 = 0.8m\n.param bias = 30\n.param Rs = 1u\n.param vsup = 20\n.param poti = 10k\n.param set = 0.5\n.param Rll = 5k\n.param FT = 10meg
TEXT 760 1064 Left 2 ;.step param set 0.1 0.9 0.25
TEXT 1704 -96 Left 2 !;ac oct 100 1 10meg
TEXT 1864 -288 Left 2 !.tran 5m
TEXT 976 72 Left 2 ;???
TEXT 976 -752 Left 2 !.model nmosA nmos (Kp=.2m VT0=2)\n.model pmosA pmos (Kp=.2m VT0=-2)\n.model nmosP nmos (Kp=3 VT0=4)\n.model pmosP pmos (Kp=-3 VT0=-4)
TEXT 1560 1040 Left 2 ;----------------------------------------\nIRFP240\n----------------------------------------\nId = K * (Ugs - Vp)^2\nVT0 =^ Vp\nKP = 2*K\n--->\nK = Id / (Ugs - Vp)^2\n--------------------------------------------\n2.718 A/V = 348mA / (4.36V - 4V)^2\n--------------------------------------------\nId(M6) ~= (2.718A/(1V**2))*(V(Gt)-4V)**2\nId(M6) = (Id(M6)/(V(Gt)-4V)**2)*(V(Gt)-4V)**2\nK = Id(M6)/(V(Gt)-4V)**2
TEXT 1592 -296 Left 2 ;IRFP9240\nKp = 8.2 (spice)\n--> K = 0.5*8.2 = 4.1
TEXT 1600 632 Left 2 ;IRFP240\nKp = 4.9 (spice)\n--> K = 0.5*4.9 = 2.45
TEXT 1032 8 Left 2 ;BSS84
TEXT 984 272 Left 2 ;BSS123
TEXT 1856 -328 Left 2 !.param hv=0
