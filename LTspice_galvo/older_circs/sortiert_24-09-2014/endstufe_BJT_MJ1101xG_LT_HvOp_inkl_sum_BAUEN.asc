Version 4
SHEET 1 3760 2336
WIRE 2160 80 2160 32
WIRE 2256 80 2256 32
WIRE 1552 208 1552 192
WIRE 2160 208 2160 160
WIRE 2256 208 2256 160
WIRE 2256 208 2160 208
WIRE 2256 240 2256 208
WIRE 1936 288 1936 176
WIRE 1936 288 1728 288
WIRE 1552 336 1552 288
WIRE 1632 336 1552 336
WIRE 1664 336 1632 336
WIRE 1936 352 1936 288
WIRE 1552 368 1552 336
WIRE 1728 400 1728 384
WIRE 1776 400 1728 400
WIRE 1840 400 1776 400
WIRE 1872 400 1840 400
WIRE 1840 432 1840 400
WIRE 1776 448 1776 400
WIRE 1552 480 1552 448
WIRE 1776 544 1776 512
WIRE 1840 544 1840 512
WIRE 1840 544 1776 544
WIRE 1936 544 1936 448
WIRE 1936 544 1840 544
WIRE 1312 560 1296 560
WIRE 1936 560 1936 544
WIRE 1312 576 1312 560
WIRE 1280 592 1120 592
WIRE 544 608 512 608
WIRE 624 608 544 608
WIRE 768 608 704 608
WIRE 800 608 768 608
WIRE 928 608 880 608
WIRE 1408 608 1344 608
WIRE 1456 608 1408 608
WIRE 1552 608 1552 544
WIRE 1552 608 1520 608
WIRE 1280 624 1232 624
WIRE 1312 656 1312 640
WIRE 1312 656 1296 656
WIRE 1936 656 1936 640
WIRE 1936 656 1680 656
WIRE 2048 656 1936 656
WIRE 2128 656 2048 656
WIRE 2256 656 2192 656
WIRE 1936 672 1936 656
WIRE 832 688 832 672
WIRE 832 704 832 688
WIRE 2048 704 2048 656
WIRE 624 720 592 720
WIRE 768 720 768 608
WIRE 768 720 704 720
WIRE 800 720 768 720
WIRE 928 736 928 608
WIRE 928 736 864 736
WIRE 960 736 928 736
WIRE 1072 736 1024 736
WIRE 1120 736 1120 592
WIRE 1120 736 1072 736
WIRE 1232 736 1232 624
WIRE 1232 736 1200 736
WIRE 1264 736 1232 736
WIRE 1360 736 1360 688
WIRE 1360 736 1344 736
WIRE 1680 736 1680 656
WIRE 1680 736 1424 736
WIRE 800 752 768 752
WIRE 1232 752 1232 736
WIRE 2256 752 2256 656
WIRE 768 768 768 752
WIRE 1840 768 1776 768
WIRE 1936 768 1936 752
WIRE 1936 768 1840 768
WIRE 928 800 928 736
WIRE 1024 800 1024 736
WIRE 1840 800 1840 768
WIRE 2048 800 2048 784
WIRE 1344 816 1344 736
WIRE 1360 816 1344 816
WIRE 1440 816 1424 816
WIRE 1552 816 1552 608
WIRE 1776 816 1776 768
WIRE 768 864 768 848
WIRE 1232 864 1232 832
WIRE 1936 880 1936 768
WIRE 1024 896 1024 864
WIRE 1552 896 1552 880
WIRE 2048 896 2048 864
WIRE 2256 896 2256 832
WIRE 1776 928 1776 880
WIRE 1776 928 1728 928
WIRE 1840 928 1840 880
WIRE 1840 928 1776 928
WIRE 1872 928 1840 928
WIRE 2576 928 2576 864
WIRE 1728 944 1728 928
WIRE 1552 992 1552 976
WIRE 1616 992 1552 992
WIRE 1632 992 1632 960
WIRE 1632 992 1616 992
WIRE 1664 992 1632 992
WIRE 2688 992 2624 992
WIRE 1552 1024 1552 992
WIRE 2688 1024 2688 992
WIRE 1936 1040 1936 976
WIRE 1936 1040 1728 1040
WIRE 2576 1072 2576 1008
WIRE 1552 1120 1552 1104
WIRE 2688 1152 2688 1104
WIRE 1936 1168 1936 1040
WIRE 1936 1168 1920 1168
WIRE 1152 1200 1104 1200
WIRE 1264 1200 1216 1200
WIRE 2576 1200 2576 1152
WIRE 592 1248 592 720
WIRE 1104 1248 1104 1200
WIRE 1104 1248 592 1248
WIRE 1152 1248 1104 1248
WIRE 1440 1248 1440 816
WIRE 1440 1248 1216 1248
WIRE 1584 1248 1440 1248
WIRE 1920 1248 1648 1248
WIRE 1984 1248 1920 1248
WIRE 2112 1344 2032 1344
WIRE 2256 1344 2256 976
WIRE 2256 1344 2112 1344
WIRE 1984 1360 1984 1248
WIRE 2256 1360 2256 1344
WIRE 2032 1376 2032 1344
WIRE 768 1424 736 1424
WIRE 784 1424 768 1424
WIRE 736 1440 736 1424
WIRE 2640 1440 2608 1440
WIRE 2032 1456 2032 1424
WIRE 2256 1456 2256 1440
WIRE 2256 1456 2032 1456
WIRE 1984 1472 1984 1440
WIRE 2256 1472 2256 1456
WIRE 1552 1552 1552 1504
WIRE 784 1584 736 1584
WIRE 816 1584 784 1584
WIRE 816 1600 816 1584
WIRE 1136 1600 1088 1600
WIRE 1184 1600 1136 1600
WIRE 1312 1600 1232 1600
WIRE 1472 1600 1440 1600
WIRE 1504 1600 1472 1600
WIRE 736 1616 736 1584
WIRE 1088 1648 1088 1600
WIRE 1232 1648 1232 1600
WIRE 1552 1648 1552 1632
WIRE 1184 1664 1184 1600
WIRE 1504 1664 1504 1600
WIRE 2304 1680 2192 1680
WIRE 2368 1680 2304 1680
WIRE 736 1712 736 1696
WIRE 816 1712 816 1680
WIRE 2368 1712 2368 1680
WIRE 1824 1728 1808 1728
WIRE 1856 1728 1824 1728
WIRE 1936 1728 1904 1728
WIRE 1968 1728 1936 1728
WIRE 1904 1744 1904 1728
WIRE 1088 1760 1088 1728
WIRE 1184 1760 1184 1712
WIRE 1232 1760 1232 1728
WIRE 1280 1760 1232 1760
WIRE 1312 1760 1280 1760
WIRE 1504 1760 1504 1712
WIRE 1552 1760 1552 1728
WIRE 1856 1760 1856 1728
WIRE 2192 1824 2192 1680
WIRE 2096 1840 2064 1840
WIRE 2144 1840 2096 1840
WIRE 1856 1856 1856 1808
WIRE 1904 1856 1904 1824
WIRE 2368 1856 2368 1792
WIRE 1824 1936 1808 1936
WIRE 1856 1936 1824 1936
WIRE 1936 1936 1904 1936
WIRE 1968 1936 1936 1936
WIRE 1904 1952 1904 1936
WIRE 1856 1968 1856 1936
WIRE 2368 1984 2368 1936
WIRE 1856 2064 1856 2016
WIRE 1904 2064 1904 2032
WIRE 2368 2096 2368 2064
FLAG 1936 176 Vplus
FLAG 1920 1168 Vmin
FLAG 2048 656 out_A
FLAG 2256 240 0
FLAG 2256 32 Vmin
FLAG 2160 32 Vplus
FLAG 736 1520 0
FLAG 1632 336 b1
FLAG 1616 992 b2
FLAG 1552 1200 0
FLAG 1552 112 0
FLAG 2256 1472 0
FLAG 768 1424 stim
FLAG 1312 560 Vmin
FLAG 1312 656 Vplus
FLAG 2048 896 0
FLAG 736 1712 0
FLAG 816 1712 0
FLAG 784 1584 I_cmd
FLAG 1984 1472 0
FLAG 2112 1344 shunt
FLAG 544 608 stim
FLAG 1184 1760 0
FLAG 1088 1760 0
FLAG 1136 1600 short_I
FLAG 1312 1600 no_I1
FLAG 1312 1760 no_I2
FLAG 1504 1760 0
FLAG 1472 1600 short_I
FLAG 1552 1760 0
FLAG 1552 1504 Vplus
FLAG 1280 1760 0
FLAG 1904 1856 0
FLAG 1856 1856 0
FLAG 1936 1728 pwrStage
FLAG 1824 1728 stim
FLAG 1904 2064 0
FLAG 1856 2064 0
FLAG 1936 1936 pwrStageLoad
FLAG 1824 1936 stim
FLAG 1408 608 opOut
FLAG 832 688 Vplus
FLAG 832 768 Vmin
FLAG 768 864 0
FLAG 1264 1200 0
FLAG 2144 1888 0
FLAG 2192 1904 0
FLAG 2096 1840 stim
FLAG 2368 2096 0
FLAG 2304 1680 test
FLAG 2624 944 0
FLAG 2688 1152 0
FLAG 2576 1200 0
FLAG 2576 864 0
FLAG 2688 992 dynLoad
FLAG 2640 1440 0
FLAG 2528 1440 0
FLAG 2560 1632 0
FLAG 2560 1552 0
FLAG 1920 1248 Umon
FLAG 1072 912 stim
FLAG 1024 976 0
FLAG 1072 960 0
FLAG 1072 736 Uset
FLAG 1232 864 0
SYMBOL EIT_Semiconductors\\npn 1664 288 R0
SYMATTR InstName T2
SYMATTR Value 2N3019
SYMBOL EIT_Semiconductors\\pnp 1664 1040 M180
SYMATTR InstName T3
SYMATTR Value BD242C
SYMBOL res 1856 416 M0
WINDOW 3 -23 125 VLeft 2
SYMATTR Value {bias}
SYMATTR InstName R6
SYMBOL res 1824 784 R0
SYMATTR InstName R7
SYMATTR Value {bias*1.5}
SYMBOL res 1536 352 R0
SYMATTR InstName R8
SYMATTR Value {bias_b}
SYMBOL res 1568 880 M0
SYMATTR InstName R9
SYMATTR Value {bias_b}
SYMBOL diode 1536 480 R0
WINDOW 3 73 21 VRight 2
SYMATTR Value 1N4148
SYMATTR InstName D2
SYMBOL diode 1536 816 R0
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL res 2240 880 R0
WINDOW 3 59 99 Left 2
SYMATTR Value 1.5
SYMATTR InstName Rload1
SYMBOL source-V 2160 64 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -87 92 Left 2
SYMATTR Value {vsup}
SYMATTR InstName V3
SYMBOL source-V 2256 64 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -72 98 Left 2
SYMATTR Value {-vsup}
SYMATTR InstName V4
SYMBOL source-V 736 1424 R0
WINDOW 123 28 56 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -157 113 Left 2
SYMATTR Value2 AC 1
SYMATTR Value PULSE(-1 1 1m 10n 10n 2m 4m)
SYMATTR InstName V5
SYMBOL res 1536 1008 R0
SYMATTR InstName R10
SYMATTR Value 1m
SYMBOL res 1536 192 R0
SYMATTR InstName R11
SYMATTR Value 1m
SYMBOL source-I 1552 192 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I2
SYMATTR Value {IK1}
SYMBOL source-I 1552 1200 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I3
SYMATTR Value {Ik1}
SYMBOL res 2240 1344 R0
SYMATTR InstName Rshunt
SYMATTR Value 0.01
SYMBOL res 1920 544 R0
SYMATTR InstName R13
SYMATTR Value {Rs}
SYMBOL res 1952 768 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R14
SYMATTR Value {Rs}
SYMBOL res 2032 688 R0
SYMATTR InstName R22
SYMATTR Value 1k
SYMBOL cap 2032 800 R0
SYMATTR InstName C3
SYMATTR Value 1µ
SYMBOL Opamps\\LT1797 1312 672 M180
SYMATTR InstName U3
SYMBOL res 1216 736 R0
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL res 1248 720 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {10k*Kp}
SYMBOL ind 2240 736 R0
SYMATTR InstName L2
SYMATTR Value 170µ
SYMATTR SpiceLine Rpar=1meg Cpar=100p
SYMBOL current 736 1696 R180
WINDOW 0 24 80 Left 2
WINDOW 3 -193 -75 Left 2
WINDOW 123 -193 -103 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I_cmd1
SYMATTR Value PULSE({-Ipeak} {Ipeak} 0 20n 20n 1m 2m)
SYMBOL res 800 1584 R0
SYMATTR InstName RI_cmd
SYMATTR Value 1
SYMBOL e 1984 1344 M0
SYMATTR InstName E1
SYMATTR Value 10
SYMBOL Misc\\jumper 992 672 R0
SYMATTR InstName X1
SYMBOL Misc\\jumper 1488 544 R0
SYMATTR InstName X2
SYMBOL sw 1232 1744 M180
SYMATTR InstName Short_I
SYMATTR Value SWA
SYMBOL source-V 1088 1632 R0
WINDOW 123 28 56 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -119 177 Left 2
SYMATTR Value {10k*Ki+1u}
SYMATTR InstName V1
SYMBOL sw 1552 1744 M180
SYMATTR InstName Short_I1
SYMATTR Value SWA
SYMBOL res 1536 1536 R0
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL MJ11016G 1872 352 R0
SYMATTR InstName U1
SYMBOL MJ11015G 1872 976 M180
WINDOW 3 89 -48 Left 2
SYMATTR InstName U4
SYMBOL e 1904 1728 R0
SYMATTR InstName E2
SYMATTR Value 1
SYMBOL Misc\\jumper 1392 880 R180
SYMATTR InstName X3
SYMBOL e 1904 1936 R0
WINDOW 3 15 161 Left 2
SYMATTR Value 1
SYMATTR InstName E3
SYMBOL cap 1760 816 R0
SYMATTR InstName C1
SYMATTR Value 1p
SYMBOL cap 1792 448 M0
SYMATTR InstName C2
SYMATTR Value 1p
SYMBOL Misc\\jumper 2160 592 R0
SYMATTR InstName X4
SYMBOL Opamps\\opamp2 832 672 R0
SYMATTR InstName U2
SYMATTR Value ada4700
SYMATTR SpiceModel ada4700
SYMBOL res 720 592 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {Rsu}
SYMBOL res 720 704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value {Rsu}
SYMBOL res 784 864 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R12
SYMATTR Value {2*Rsu}
SYMBOL res 784 624 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R15
SYMATTR Value {2*Rsu}
SYMBOL e 2192 1808 R0
SYMATTR InstName E4
SYMATTR Value 28
SYMBOL res 2352 1840 R0
WINDOW 3 59 99 Left 2
SYMATTR Value 1.5
SYMATTR InstName Rload2
SYMBOL ind 2352 1696 R0
SYMATTR InstName L1
SYMATTR Value 170µ
SYMATTR SpiceLine Rpar=1meg Cpar=100p
SYMBOL res 2352 1968 R0
SYMATTR InstName Rshunt1
SYMATTR Value 0.01
SYMBOL Misc\\jumper 1168 1072 R0
SYMATTR InstName X5
SYMBOL sw 2576 912 M0
SYMATTR InstName S1
SYMATTR Value swA
SYMBOL source-V 2688 1008 R0
WINDOW 123 28 56 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 94 -90 VRight 2
SYMATTR Value PULSE(0 1 3.8m 10n 10n 2m 3m)
SYMATTR InstName V2
SYMBOL res 2592 1056 M0
WINDOW 3 59 99 Left 2
SYMATTR Value 1.5
SYMATTR InstName Rload3
SYMBOL bi 2608 1440 R90
WINDOW 0 -32 40 VBottom 2
WINDOW 3 32 40 VTop 2
SYMATTR InstName B1
SYMATTR Value I=2A*V(dynLoad)
SYMBOL bv 2560 1536 R0
SYMATTR InstName B2
SYMATTR Value V=5V*V(dynLoad)
SYMBOL e 1024 880 M0
SYMATTR InstName E5
SYMATTR Value 1
SYMBOL Misc\\jumper 944 832 M90
SYMATTR InstName X6
SYMBOL Misc\\jumper 1616 1184 R0
SYMATTR InstName X7
TEXT 2136 320 Left 2 !.ac oct 100 1 100meg
TEXT 2048 280 Left 2 !;ac oct 500 1 1000meg
TEXT 544 120 Left 5 ;bis jetzt 19.09.2014 #1
TEXT 528 1936 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/ADA4700.sub
TEXT 528 1968 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/LM358.sub
TEXT 776 2248 Left 2 ;.model IRFP240 VDMOS(Rg=3 Vto=4 Rd=72m Rs=18m Rb=36m Kp=4.9 Lambda=.03 Cgdmax=1.34n Cgdmin=.1n Cgs=1.25n Cjo=1.25n Is=67p mfg=International_Rectifier Vds=200 Ron=180m Qg=70n)\n.model IRFP250N VDMOS(Rg=1.44 Vto=4.0 Rd=47m Rs=0m Rb=5.6m Kp=13 Cgdmax=3.9n Cgdmin=0.10n Cgs=1.9n Cjo=1.25n Is=5p tt=186n mfg=International_Rectifier Vds=200 Ron=75m Qg=123n)
TEXT 1184 192 Left 2 !; ---------------------\n;   Power amp\n; ---------------------\n.param Ik1 = 3m\n.param bias = 220\n.param bias_b = 390\n.param Rs = 10m
TEXT 968 200 Left 2 !; ---------------------\n;   SOURCES\n; ---------------------\n.param Vsup = 30V\n.param Ipeak = 10A
TEXT 736 216 Left 2 !; ---------------------\n;   Compensator\n; ---------------------\n.param Rsu = 10k\n.param Kp = 1\n.param Ki = 15000
TEXT 968 1536 Left 2 !.model swA SW(Ron=.1 Roff=100Meg Vt=0.1 Vh=-.5 )
TEXT 1104 432 Left 2 ;.step param Kp 1 50 5
TEXT 400 2296 Left 2 !;ac oct 100 10 10meg
TEXT 400 2320 Left 2 !;ac oct 200 1 1000meg
TEXT 600 -264 Left 4 ;Leerlauf:    laplace=(0.1723*s**2-1.645e7*s-4.932e14)/(1.224e7*s+s**2+6.152e13)\n 170u / 1.51ohm last: (nur 84%):    laplace=(1.508e7*s+4.603e14)/(1.135e7*s+s**2+6.051e13)\n- Reiner P- Regler (inv. Verstärker), Kp=8, \n   nicht von OpOut sondern von out_A knoten auf inv eingang zurück koppeln, +eingang auf gnd\n- Keine Last, keine Rückführungen sonst\n- AC -1 einstellen sonst fängt das Bodediag. bei +180deg an und meine Approximation in matlab kackt
TEXT 784 432 Left 2 ;kp=20
