Version 4
SHEET 1 3760 2336
WIRE 816 -80 800 -80
WIRE 240 -16 240 -32
WIRE 352 -16 336 -16
WIRE 368 -16 352 -16
WIRE 704 0 688 0
WIRE 800 0 800 -80
WIRE 800 0 784 0
WIRE 800 48 800 0
WIRE 688 96 688 0
WIRE 736 96 688 96
WIRE 2224 96 2224 48
WIRE 2320 96 2320 48
WIRE 240 112 240 64
WIRE 352 112 352 64
WIRE 352 112 240 112
WIRE 688 160 688 96
WIRE 1936 160 1936 48
WIRE 1936 160 1760 160
WIRE 352 176 352 112
WIRE 800 192 800 144
WIRE 800 192 720 192
WIRE 1552 208 1552 176
WIRE 1664 208 1552 208
WIRE 1696 208 1664 208
WIRE 1936 208 1936 160
WIRE 800 224 800 192
WIRE 2224 224 2224 176
WIRE 2320 224 2320 176
WIRE 2320 224 2224 224
WIRE 1552 240 1552 208
WIRE 1808 256 1760 256
WIRE 1872 256 1808 256
WIRE 2320 256 2320 224
WIRE 464 272 464 192
WIRE 1760 288 1760 256
WIRE 352 320 352 256
WIRE 400 320 352 320
WIRE 688 336 688 224
WIRE 800 336 800 304
WIRE 800 336 688 336
WIRE 1664 336 1664 208
WIRE 1696 336 1664 336
WIRE 1808 336 1808 256
WIRE 1824 336 1808 336
WIRE 1936 336 1936 304
WIRE 1936 336 1904 336
WIRE 1552 352 1552 320
WIRE 352 368 352 320
WIRE 1936 384 1936 336
WIRE 1936 384 1760 384
WIRE 464 400 464 368
WIRE 464 400 384 400
WIRE 800 416 800 336
WIRE 464 432 464 400
WIRE 1424 432 1408 432
WIRE 1424 448 1424 432
WIRE 1936 448 1936 384
WIRE 1392 464 1360 464
WIRE 1472 480 1456 480
WIRE 1552 480 1552 416
WIRE 1552 480 1536 480
WIRE 1392 496 1344 496
WIRE 1424 528 1424 512
WIRE 1424 528 1408 528
WIRE 352 560 352 432
WIRE 416 560 352 560
WIRE 464 560 464 512
WIRE 464 560 416 560
WIRE 1344 608 1344 496
WIRE 1376 608 1344 608
WIRE 1616 608 1456 608
WIRE 1936 608 1936 528
WIRE 1936 608 1680 608
WIRE 2048 608 1936 608
WIRE 2128 608 2048 608
WIRE 2256 608 2192 608
WIRE 736 672 736 608
WIRE 736 672 720 672
WIRE 1936 672 1936 608
WIRE 1344 704 1344 608
WIRE 2048 704 2048 608
WIRE 992 736 976 736
WIRE 1104 736 1072 736
WIRE 1152 736 1104 736
WIRE 1248 736 1232 736
WIRE 816 752 784 752
WIRE 928 752 896 752
WIRE 2256 752 2256 608
WIRE 1184 800 1168 800
WIRE 1936 800 1936 752
WIRE 1936 800 1744 800
WIRE 2048 800 2048 784
WIRE 864 816 848 816
WIRE 1184 816 1184 800
WIRE 1552 816 1552 480
WIRE 864 832 864 816
WIRE 1104 832 1104 736
WIRE 1152 832 1104 832
WIRE 688 848 672 848
WIRE 784 848 784 752
WIRE 784 848 768 848
WIRE 832 848 784 848
WIRE 1248 848 1248 736
WIRE 1248 848 1216 848
WIRE 1344 848 1344 784
WIRE 1344 848 1248 848
WIRE 1680 848 1664 848
WIRE 928 864 928 752
WIRE 928 864 896 864
WIRE 976 864 928 864
WIRE 1104 864 1056 864
WIRE 1152 864 1104 864
WIRE 1824 864 1792 864
WIRE 1936 864 1936 800
WIRE 1936 864 1904 864
WIRE 832 880 800 880
WIRE 1184 896 1184 880
WIRE 1184 896 1168 896
WIRE 1552 896 1552 880
WIRE 1936 896 1936 864
WIRE 2048 896 2048 864
WIRE 2256 896 2256 832
WIRE 864 912 864 896
WIRE 864 912 848 912
WIRE 1104 944 1104 864
WIRE 1744 944 1744 896
WIRE 1792 944 1792 864
WIRE 1792 944 1744 944
WIRE 1872 944 1792 944
WIRE 1552 992 1552 976
WIRE 1616 992 1552 992
WIRE 1664 992 1664 848
WIRE 1664 992 1616 992
WIRE 1680 992 1664 992
WIRE 1552 1024 1552 992
WIRE 1936 1040 1936 992
WIRE 1936 1040 1744 1040
WIRE 496 1104 496 1088
WIRE 1936 1120 1936 1040
WIRE 1936 1120 1920 1120
WIRE 1104 1200 1104 1024
WIRE 1392 1200 1104 1200
WIRE 1728 1200 1456 1200
WIRE 1984 1200 1728 1200
WIRE 2112 1200 2032 1200
WIRE 2256 1200 2256 976
WIRE 2256 1200 2112 1200
WIRE 1984 1248 1984 1200
WIRE 2256 1248 2256 1200
WIRE 2032 1264 2032 1200
WIRE 1216 1344 1216 1296
WIRE 2032 1344 2032 1312
WIRE 2256 1344 2256 1328
WIRE 2256 1344 2032 1344
WIRE 1984 1360 1984 1328
WIRE 2256 1360 2256 1344
WIRE 400 1424 384 1424
WIRE 432 1424 400 1424
WIRE 512 1424 480 1424
WIRE 544 1424 512 1424
WIRE 768 1424 736 1424
WIRE 784 1424 768 1424
WIRE 480 1440 480 1424
WIRE 736 1440 736 1424
WIRE 432 1456 432 1424
WIRE 1840 1520 1840 1456
WIRE 432 1552 432 1504
WIRE 480 1552 480 1520
WIRE 1552 1552 1552 1504
WIRE 784 1584 736 1584
WIRE 816 1584 784 1584
WIRE 1952 1584 1888 1584
WIRE 816 1600 816 1584
WIRE 1136 1600 1088 1600
WIRE 1184 1600 1136 1600
WIRE 1312 1600 1232 1600
WIRE 1472 1600 1440 1600
WIRE 1504 1600 1472 1600
WIRE 736 1616 736 1584
WIRE 1952 1616 1952 1584
WIRE 400 1632 384 1632
WIRE 432 1632 400 1632
WIRE 512 1632 480 1632
WIRE 544 1632 512 1632
WIRE 480 1648 480 1632
WIRE 1088 1648 1088 1600
WIRE 1232 1648 1232 1600
WIRE 1552 1648 1552 1632
WIRE 432 1664 432 1632
WIRE 1184 1664 1184 1600
WIRE 1504 1664 1504 1600
WIRE 1840 1664 1840 1600
WIRE 736 1712 736 1696
WIRE 816 1712 816 1680
WIRE 1952 1744 1952 1696
WIRE 432 1760 432 1712
WIRE 480 1760 480 1728
WIRE 1088 1760 1088 1728
WIRE 1184 1760 1184 1712
WIRE 1232 1760 1232 1728
WIRE 1280 1760 1232 1760
WIRE 1312 1760 1280 1760
WIRE 1504 1760 1504 1712
WIRE 1552 1760 1552 1728
WIRE 1840 1792 1840 1744
FLAG 1936 48 Vplus
FLAG 1920 1120 Vmin
FLAG 2048 608 out_A
FLAG 2320 256 0
FLAG 2320 48 Vmin
FLAG 2224 48 Vplus
FLAG 736 1520 0
FLAG 1664 208 b1
FLAG 1616 992 b2
FLAG 496 1104 0
FLAG 1424 0 0
FLAG 2256 1360 0
FLAG 768 1424 stim
FLAG 1424 432 Vmin
FLAG 1424 528 Vplus
FLAG 2048 896 0
FLAG 736 1712 0
FLAG 816 1712 0
FLAG 784 1584 I_cmd
FLAG 1984 1360 0
FLAG 2112 1200 shunt
FLAG 1360 464 0
FLAG 672 848 stim
FLAG 1184 1760 0
FLAG 1088 1760 0
FLAG 1136 1600 short_I
FLAG 1312 1600 no_I1
FLAG 1312 1760 no_I2
FLAG 1504 1760 0
FLAG 1472 1600 short_I
FLAG 1552 1760 0
FLAG 1552 1504 Vplus
FLAG 1280 1760 0
FLAG 480 1552 0
FLAG 432 1552 0
FLAG 512 1424 pwrStage
FLAG 400 1424 stim
FLAG 480 1760 0
FLAG 432 1760 0
FLAG 512 1632 pwrStageLoad
FLAG 400 1632 stim
FLAG 1888 1536 0
FLAG 1952 1744 0
FLAG 1840 1792 0
FLAG 1840 1456 0
FLAG 1952 1584 dynLoad
FLAG 1728 1200 Umon
FLAG 1168 1360 stim
FLAG 1216 1424 0
FLAG 1168 1408 0
FLAG 800 880 0
FLAG 1664 -160 0
FLAG 1728 -160 0
FLAG 976 736 0
FLAG 1184 896 Vmin
FLAG 1184 800 Vplus
FLAG 864 912 Vmin
FLAG 864 816 Vplus
FLAG 816 -80 Vplus
FLAG 720 672 Vmin
FLAG -64 128 0
FLAG -64 64 0
FLAG -64 -32 0
FLAG -64 -48 0
FLAG 0 0 0
FLAG 352 -16 Vplus
FLAG 464 192 Isink
FLAG 416 560 Vmin
FLAG 496 1008 0
FLAG 1424 80 0
FLAG 1552 1024 Isink
FLAG 1552 176 Isource
FLAG 736 528 0
FLAG 800 416 Isource
FLAG 240 -32 0
SYMBOL pnp 1680 1040 M180
SYMATTR InstName T3
SYMATTR Value 2N5401
SYMBOL res 1808 320 M90
WINDOW 3 25 56 VTop 2
WINDOW 0 7 56 VBottom 2
SYMATTR Value {bias}
SYMATTR InstName R6
SYMBOL res 1920 848 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R7
SYMATTR Value {bias}
SYMBOL res 1536 224 R0
SYMATTR InstName R8
SYMATTR Value {bias_b}
SYMBOL res 1568 880 M0
SYMATTR InstName R9
SYMATTR Value {bias_b}
SYMBOL diode 1536 352 R0
WINDOW 3 73 21 VRight 2
SYMATTR Value 1N4148
SYMATTR InstName D2
SYMBOL diode 1536 816 R0
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL res 2240 880 R0
WINDOW 3 59 99 Left 2
SYMATTR Value 1.5
SYMATTR InstName Rload1
SYMBOL source-V 2224 80 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -87 92 Left 2
SYMATTR Value {vsup}
SYMATTR InstName V3
SYMBOL source-V 2320 80 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -72 98 Left 2
SYMATTR Value {-vsup}
SYMATTR InstName V4
SYMBOL source-V 736 1424 R0
WINDOW 123 28 56 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -256 -43 Left 2
SYMATTR Value2 AC 1
SYMATTR Value PULSE( {-Uset} {Uset} 1m 10n 10n 2m 4m)
SYMATTR InstName V5
SYMBOL source-I 1424 80 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I2
SYMATTR Value {IK1}
SYMBOL source-I 496 1088 R180
WINDOW 0 29 73 Left 2
WINDOW 3 29 17 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I3
SYMATTR Value {Ik1}
SYMBOL res 2240 1232 R0
SYMATTR InstName Rshunt
SYMATTR Value 0.01
SYMBOL res 1920 432 R0
SYMATTR InstName R13
SYMATTR Value {Rs}
SYMBOL res 1952 768 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R14
SYMATTR Value {Rs}
SYMBOL res 2032 688 R0
SYMATTR InstName R22
SYMATTR Value 100
SYMBOL cap 2032 800 R0
SYMATTR InstName C3
SYMATTR Value 100µ
SYMBOL res 1360 800 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL res 1360 592 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {10k*Kp}
SYMBOL ind 2240 736 R0
SYMATTR InstName L2
SYMATTR Value 170µ
SYMATTR SpiceLine Rpar=1meg Cpar=100p
SYMBOL current 736 1696 R180
WINDOW 0 24 80 Left 2
WINDOW 3 -193 -75 Left 2
WINDOW 123 -193 -103 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I_cmd1
SYMATTR Value PULSE({-Ipeak} {Ipeak} 0 20n 20n 1m 2m)
SYMBOL res 800 1584 R0
SYMATTR InstName RI_cmd
SYMATTR Value 1
SYMBOL e 1984 1232 M0
SYMATTR InstName E1
SYMATTR Value 100
SYMBOL Misc\\jumper 1504 416 R0
SYMATTR InstName X2
SYMBOL sw 1232 1744 M180
SYMATTR InstName Short_I
SYMATTR Value SWA
SYMBOL source-V 1088 1632 R0
WINDOW 123 28 56 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -119 177 Left 2
SYMATTR Value {10k*Ki+1u}
SYMATTR InstName V1
SYMBOL sw 1552 1744 M180
SYMATTR InstName Short_I1
SYMATTR Value SWA
SYMBOL res 1536 1536 R0
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL MJ11016G 1872 208 R0
SYMATTR InstName U1
SYMBOL MJ11015G 1872 992 M180
WINDOW 3 89 -48 Left 2
SYMATTR InstName U4
SYMBOL e 480 1424 R0
SYMATTR InstName E2
SYMATTR Value 1
SYMBOL Misc\\jumper 1648 672 R180
SYMATTR InstName X3
SYMBOL e 480 1632 R0
WINDOW 3 15 161 Left 2
SYMATTR Value 1
SYMATTR InstName E3
SYMBOL Misc\\jumper 2160 544 R0
SYMATTR InstName X4
SYMBOL Misc\\jumper 1424 1136 R0
SYMATTR InstName X5
SYMBOL sw 1840 1504 M0
SYMATTR InstName S1
SYMATTR Value swA
SYMBOL source-V 1952 1600 R0
WINDOW 123 28 56 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 94 -113 VRight 2
SYMATTR Value PULSE(0 1 3.8m 10n 10n 2m 3m)
SYMATTR InstName V2
SYMBOL res 1856 1648 M0
WINDOW 3 59 99 Left 2
SYMATTR Value 1.5
SYMATTR InstName Rload3
SYMBOL e 1216 1328 R0
SYMATTR InstName E5
SYMATTR Value -6
SYMBOL res 800 768 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R16
SYMATTR Value {Kvv*10k}
SYMBOL res 672 864 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R17
SYMATTR Value 10k
SYMBOL cap 1664 -144 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 87 113 VBottom 2
SYMATTR InstName C4
SYMATTR Value {1/(1k*Ki+1u)}
SYMBOL npn 1696 160 R0
SYMATTR InstName Q1
SYMATTR Value 2N5550
SYMBOL pnp 1696 384 M180
SYMATTR InstName T2
SYMATTR Value 2N5401
SYMBOL npn 1680 800 R0
SYMATTR InstName Q3
SYMATTR Value 2N5550
SYMBOL res 1088 752 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R18
SYMATTR Value {Rsu}
SYMBOL res 960 880 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R19
SYMATTR Value {Rsu}
SYMBOL res 1088 1040 M180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R20
SYMATTR Value {Rsu}
SYMBOL res 1136 752 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R21
SYMATTR Value {Rsu}
SYMBOL npn 736 48 R0
SYMATTR InstName Q4
SYMATTR Value BC550C
SYMBOL res 800 16 M270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R27
SYMATTR Value 4.7k
SYMBOL res 784 208 R0
SYMATTR InstName R28
SYMATTR Value 561
SYMBOL res 720 512 R0
SYMATTR InstName R10
SYMATTR Value 100
SYMBOL ADA4700 1424 544 M180
SYMATTR InstName U3
SYMBOL ADA4700 864 800 R0
SYMATTR InstName U5
SYMBOL ADA4700 1184 784 R0
SYMATTR InstName U6
SYMBOL SBORKA\\REF\\tlv431_my 704 160 M0
SYMATTR InstName U7
SYMBOL res 336 160 R0
SYMATTR InstName R2
SYMATTR Value 4.7k
SYMBOL EIT_Semiconductors\\npn 400 272 R0
SYMATTR InstName Q2
SYMATTR Value BC550C
SYMBOL res 448 416 R0
SYMATTR InstName R11
SYMATTR Value 561
SYMBOL SBORKA\\REF\\tlv431_my 368 368 M0
SYMATTR InstName U2
SYMBOL res 336 -32 R0
SYMATTR InstName R5
SYMATTR Value {100t*(1-jp1)+1u}
SYMBOL res 224 -32 R0
WINDOW 3 -165 57 Left 2
SYMATTR InstName R12
SYMATTR Value {100t*jp1+1u}
TEXT 2112 296 Left 2 !;ac oct 500 1 1000meg
TEXT 528 1936 Left 2 ;.inc lib/sub/ADA4700.sub
TEXT 528 1968 Left 2 ;.inc lib/sub/LM358.sub
TEXT 984 64 Left 2 !; ---------------------\n;   Power amp\n; ---------------------\n.param Ik1 = 3m\n.param bias = 2.5k\n.param bias_b = 200\n.param Rs = 10m
TEXT 1304 -216 Left 2 !; ---------------------\n;   SOURCES\n; ---------------------\n.param Vsup = 30V\n.param Ipeak = 10A
TEXT 976 -240 Left 2 !; ---------------------\n;   Compensator\n; ---------------------\n.param Uset = 3\n.param Rsu = 10k\n.param Kp = 7\n.param Ki = 15000\n; Vorverstärker: Ic=Kvv*Uset\n.param Kvv = 6
TEXT 968 1536 Left 2 !.model swA SW(Ron=.1 Roff=100Meg Vt=0.1 Vh=-.5 )
TEXT 1776 -112 Left 2 ;.step param Kp 5 15 1
TEXT 1768 -136 Left 2 ;.step param Kvv 1 4 0.5
TEXT 1656 -32 Left 2 !.tran 5m
TEXT 472 -72 Left 2 !.param jp1 = 1\n.step param jp1 list 1 0
