Version 4
SHEET 1 2756 680
WIRE -848 -1328 -848 -1344
WIRE -752 -1328 -752 -1344
WIRE -848 -1232 -848 -1248
WIRE -752 -1232 -752 -1248
WIRE 2000 -1184 1952 -1184
WIRE 2048 -1184 2000 -1184
WIRE 464 -1168 432 -1168
WIRE 576 -1168 544 -1168
WIRE 1952 -1152 1952 -1184
WIRE -560 -1120 -1520 -1120
WIRE 496 -1088 496 -1104
WIRE 320 -1072 208 -1072
WIRE 432 -1072 432 -1168
WIRE 432 -1072 400 -1072
WIRE 464 -1072 432 -1072
WIRE -560 -1056 -560 -1120
WIRE -512 -1056 -560 -1056
WIRE -480 -1056 -512 -1056
WIRE -352 -1056 -400 -1056
WIRE -320 -1056 -352 -1056
WIRE -208 -1056 -240 -1056
WIRE 576 -1056 576 -1168
WIRE 576 -1056 528 -1056
WIRE 624 -1056 576 -1056
WIRE 1952 -1056 1952 -1072
WIRE 464 -1040 432 -1040
WIRE -1520 -1024 -1520 -1040
WIRE -1168 -1024 -1184 -1024
WIRE -1024 -1024 -1088 -1024
WIRE -992 -1024 -1024 -1024
WIRE -896 -1024 -912 -1024
WIRE 496 -1008 496 -1024
WIRE 624 -992 624 -1056
WIRE -288 -976 -288 -992
WIRE -1216 -960 -1328 -960
WIRE -352 -960 -352 -1056
WIRE -320 -960 -352 -960
WIRE -208 -944 -208 -1056
WIRE -208 -944 -256 -944
WIRE -128 -944 -208 -944
WIRE -16 -944 -128 -944
WIRE 208 -944 208 -1072
WIRE 208 -944 64 -944
WIRE -512 -928 -560 -928
WIRE -480 -928 -512 -928
WIRE -352 -928 -400 -928
WIRE -320 -928 -352 -928
WIRE 208 -928 208 -944
WIRE 768 -928 736 -928
WIRE 880 -928 848 -928
WIRE 64 -912 64 -944
WIRE -1328 -896 -1328 -960
WIRE -1296 -896 -1328 -896
WIRE -768 -896 -768 -912
WIRE -352 -896 -352 -928
WIRE -288 -896 -288 -912
WIRE -16 -896 -16 -944
WIRE -1216 -880 -1216 -960
WIRE -1216 -880 -1232 -880
WIRE -1104 -880 -1216 -880
WIRE -992 -880 -1104 -880
WIRE -896 -880 -896 -1024
WIRE -896 -880 -912 -880
WIRE -800 -880 -896 -880
WIRE -1408 -864 -1520 -864
WIRE -1296 -864 -1408 -864
WIRE -704 -864 -736 -864
WIRE -560 -864 -560 -928
WIRE -560 -864 -704 -864
WIRE -800 -848 -832 -848
WIRE -704 -848 -704 -864
WIRE 800 -848 800 -864
WIRE -1520 -832 -1520 -864
WIRE -896 -832 -896 -880
WIRE 208 -832 208 -848
WIRE 736 -832 736 -928
WIRE 768 -832 736 -832
WIRE -1104 -816 -1104 -880
WIRE -768 -816 -768 -832
WIRE 880 -816 880 -928
WIRE 880 -816 832 -816
WIRE 976 -816 880 -816
WIRE 1008 -816 976 -816
WIRE 1120 -816 1088 -816
WIRE 1296 -816 1296 -832
WIRE 1296 -816 1168 -816
WIRE 1552 -816 1520 -816
WIRE 1632 -816 1616 -816
WIRE 1760 -816 1632 -816
WIRE 1904 -816 1904 -848
WIRE 1952 -816 1904 -816
WIRE -352 -800 -352 -816
WIRE -16 -800 -16 -848
WIRE 64 -800 64 -832
WIRE 624 -800 624 -832
WIRE 768 -800 624 -800
WIRE 1296 -800 1296 -816
WIRE 1952 -800 1952 -816
WIRE -1360 -784 -1360 -800
WIRE -1184 -784 -1312 -784
WIRE 624 -768 624 -800
WIRE 800 -768 800 -784
WIRE -832 -752 -832 -848
WIRE -704 -752 -704 -768
WIRE -704 -752 -832 -752
WIRE 1696 -752 1696 -768
WIRE -1520 -736 -1520 -752
WIRE -896 -736 -896 -752
WIRE -704 -736 -704 -752
WIRE 208 -736 208 -752
WIRE 208 -736 64 -736
WIRE 1232 -736 1232 -752
WIRE 1632 -736 1632 -816
WIRE 1664 -736 1632 -736
WIRE -1312 -720 -1312 -784
WIRE -1264 -720 -1312 -720
WIRE 1168 -720 1168 -816
WIRE 1200 -720 1168 -720
WIRE 1760 -720 1760 -816
WIRE 1760 -720 1728 -720
WIRE 1792 -720 1760 -720
WIRE 1904 -720 1904 -752
WIRE 1904 -720 1792 -720
WIRE 1952 -720 1952 -736
WIRE 1952 -720 1904 -720
WIRE 2176 -720 1952 -720
WIRE -1184 -704 -1184 -784
WIRE -1184 -704 -1200 -704
WIRE -1104 -704 -1104 -752
WIRE -1104 -704 -1184 -704
WIRE 64 -704 64 -736
WIRE 1296 -704 1296 -720
WIRE 1296 -704 1264 -704
WIRE 1392 -704 1296 -704
WIRE 1424 -704 1392 -704
WIRE 1520 -704 1520 -816
WIRE 1520 -704 1504 -704
WIRE 1536 -704 1520 -704
WIRE 1632 -704 1616 -704
WIRE 1664 -704 1632 -704
WIRE 1904 -704 1904 -720
WIRE 1952 -704 1952 -720
WIRE -1264 -688 -1312 -688
WIRE 976 -688 848 -688
WIRE 1008 -688 976 -688
WIRE 1120 -688 1120 -816
WIRE 1120 -688 1088 -688
WIRE 1200 -688 1120 -688
WIRE -1360 -672 -1360 -704
WIRE 1632 -672 1632 -704
WIRE 1696 -672 1696 -688
WIRE 1232 -656 1232 -672
WIRE 848 -640 848 -688
WIRE 1120 -624 1120 -688
WIRE 1904 -624 1904 -640
WIRE 1952 -624 1952 -640
WIRE 1952 -624 1904 -624
WIRE 1904 -608 1904 -624
WIRE -1312 -592 -1312 -688
WIRE -1312 -592 -1360 -592
WIRE -1296 -592 -1312 -592
WIRE -1200 -592 -1216 -592
WIRE 1632 -592 1632 -608
WIRE 624 -576 624 -608
WIRE 1008 -560 976 -560
WIRE 1120 -560 1120 -624
WIRE 1120 -560 1088 -560
WIRE 1200 -560 1120 -560
WIRE 2128 -560 1280 -560
WIRE 848 -544 848 -560
WIRE 2128 -544 2128 -560
WIRE 1120 -480 1120 -560
WIRE 2128 -448 2128 -464
WIRE 1120 -400 1120 -416
WIRE -1200 -96 -1200 -112
FLAG -752 -1232 0
FLAG -752 -1344 Vp
FLAG -848 -1232 0
FLAG -848 -1344 Vm
FLAG -1184 -1024 0
FLAG -1520 -1024 0
FLAG -288 -992 Vp
FLAG -288 -896 Vm
FLAG -352 -800 0
FLAG -128 -944 out2_lv
FLAG -512 -928 ue2_lv
FLAG -768 -816 Vp
FLAG -768 -912 Vm
FLAG -704 -656 0
FLAG -896 -736 0
FLAG -1520 -736 0
FLAG -1024 -1024 u1
FLAG -1104 -880 u2_lv
FLAG -16 -800 0
FLAG 64 -800 0
FLAG 64 -704 0
FLAG -512 -1056 ue1_lv
FLAG -1264 -912 Vp
FLAG -1264 -848 Vm
FLAG -1232 -736 Vp
FLAG -1232 -672 Vm
FLAG -1200 -592 0
FLAG -1360 -800 Vp
FLAG 624 -576 0
FLAG 624 -800 div
FLAG 800 -864 Vp
FLAG 800 -768 Vm
FLAG 1232 -752 Vp
FLAG 1232 -656 Vm
FLAG 848 -544 0
FLAG 1296 -912 0
FLAG 2128 -448 0
FLAG 976 -560 0
FLAG 976 -816 u1_tr
FLAG 976 -688 u2_tr
FLAG 1120 -624 u5_tr
FLAG 1696 -768 Vp
FLAG 1696 -672 Vm
FLAG 1632 -592 0
FLAG 1792 -720 fil_tr
FLAG 1392 -704 sum_tr
FLAG 1904 -608 0
FLAG 1952 -1056 0
FLAG 2000 -1184 +3.3V
FLAG 1904 -848 +3.3V
FLAG 1120 -400 0
FLAG 208 -1072 DemodChan
FLAG 496 -1104 Vp
FLAG 496 -1008 Vm
FLAG 432 -1040 0
FLAG 624 -1056 DemodChan_inv
FLAG -2112 -944 0
FLAG -1408 -864 voff
FLAG 0 0 voff
SYMBOL source-V -848 -1344 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value -15
SYMBOL source-V -752 -1344 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value 15
SYMBOL source-V -1520 -1136 M0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value SINE(1.25 1.2 500 0)
SYMBOL Opamps\\opamp2 -288 -1008 R0
SYMATTR InstName U1
SYMATTR Value OPA404
SYMBOL res -496 -1040 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value {R1}
SYMBOL res -496 -912 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R2
SYMATTR Value {R3}
SYMBOL res -368 -912 R0
SYMATTR InstName R3
SYMATTR Value {R4}
SYMBOL res -336 -1040 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R4
SYMATTR Value {R2}
SYMBOL source-V -1072 -1024 M270
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 0 42 78 VLeft 2
WINDOW 3 -41 79 VLeft 2
SYMATTR InstName Vref1
SYMATTR Value 2.5V
SYMBOL res -720 -864 R0
SYMATTR InstName R5
SYMATTR Value {Ra}
SYMBOL Opamps\\opamp2 -768 -800 M180
WINDOW 3 10 104 Left 2
SYMATTR Value OPA404
SYMATTR InstName U2
SYMBOL res -720 -752 R0
SYMATTR InstName R6
SYMATTR Value {Ra}
SYMBOL res -1008 -1040 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 1.45k
SYMBOL res -1008 -896 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL res -880 -848 M0
SYMATTR InstName R9
SYMATTR Value {R10}
SYMBOL source-V -1520 -848 M0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value PULSE(0 3 0 8m)
SYMBOL crtl-V-I 64 -928 R0
WINDOW 0 -10 -43 Left 2
WINDOW 3 -29 98 Left 2
SYMATTR InstName G1
SYMATTR Value 1
SYMBOL res 192 -944 R0
SYMATTR InstName R10
SYMATTR Value 1
SYMBOL ind 192 -848 R0
SYMATTR InstName L1
SYMATTR Value 160p
SYMBOL Opamps\\opamp2 -1264 -944 R0
WINDOW 3 14 104 Left 2
SYMATTR Value OPA404
SYMATTR InstName U3
SYMBOL Opamps\\opamp2 -1232 -768 R0
WINDOW 3 14 104 Left 2
SYMATTR Value OPA404
SYMATTR InstName U4
SYMBOL res -1376 -688 R0
WINDOW 3 -19 12 VRight 2
SYMATTR Value {pot1*set1}
SYMATTR InstName R11
SYMBOL res -1312 -576 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R12
SYMATTR Value {pot1*(1-set1)}
SYMBOL res -1344 -800 M0
SYMATTR InstName R13
SYMATTR Value {2*pot1}
SYMBOL res 608 -1008 R0
SYMATTR InstName R21
SYMATTR Value 2k
SYMBOL res 608 -704 R0
SYMATTR InstName R22
SYMATTR Value 150
SYMBOL res 608 -928 R0
SYMATTR InstName R23
SYMATTR Value 2k
SYMBOL res 608 -784 R0
SYMATTR InstName R24
SYMATTR Value 560
SYMBOL res 864 -944 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -19 10 VTop 2
SYMATTR InstName R25
SYMATTR Value 1m
SYMBOL Opamps\\opamp2 800 -880 R0
SYMATTR InstName U8
SYMATTR Value OPA404
SYMBOL res 1280 -704 M180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R26
SYMATTR Value {Ra*2}
SYMBOL Opamps\\opamp2 1232 -768 R0
WINDOW 3 41 104 Left 2
SYMATTR Value OPA404
SYMATTR InstName U9
SYMBOL res 1280 -816 M180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R27
SYMATTR Value {Ra}
SYMBOL res 1104 -672 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R28
SYMATTR Value {Ra}
SYMBOL res 1104 -832 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R29
SYMATTR Value {Ra}
SYMBOL res 1296 -576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R30
SYMATTR Value {8*Ra}
SYMBOL res 1104 -576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R31
SYMATTR Value {8/7*Ra}
SYMBOL source-V 848 -656 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V7
SYMATTR Value 1.24
SYMBOL source-V 2128 -560 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V8
SYMATTR Value {0.26*8}
SYMBOL cap 1552 -800 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C3
SYMATTR Value 4.7n
SYMBOL cap 1648 -672 M0
SYMATTR InstName C4
SYMATTR Value 4.7n
SYMATTR SpiceLine Rser=10
SYMBOL res 1520 -688 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R33
SYMATTR Value 1.2k
SYMBOL res 1408 -688 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R34
SYMATTR Value 1.2k
SYMBOL Opamps\\opamp2 1696 -784 R0
WINDOW 3 41 104 Left 2
SYMATTR Value OPA404
SYMATTR InstName U12
SYMBOL schottky 1920 -752 R180
WINDOW 0 24 72 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky 1920 -640 R180
WINDOW 0 24 72 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL source-V 1952 -1168 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V11
SYMATTR Value 3.3V
SYMBOL cap 1104 -480 R0
SYMATTR InstName C5
SYMATTR Value {c3}
SYMBOL cap 1936 -736 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C6
SYMATTR Value 7p
SYMBOL cap 1936 -640 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C7
SYMATTR Value 7p
SYMBOL res 560 -1184 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -19 10 VTop 2
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL Opamps\\opamp2 496 -1120 R0
SYMATTR InstName U5
SYMATTR Value OPA404
SYMBOL res 416 -1088 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -19 10 VTop 2
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL Misc\\jumper -1024 -784 R90
SYMATTR InstName X1
TEXT -1208 -1472 Left 2 ;Messwandler v1 \nSTM32 DAC out --> Endstufe Vin_ctrl\n0 ... 3V                --> -5V ... 5V\n \nENDSTUFE INVERTIERT!!!!
TEXT -1592 -1416 Left 2 ;STM32f4
TEXT -1624 -1208 Left 2 ;STM32 DAC \nVout_ctrl
TEXT -1200 -1272 Left 2 !.param R1=10k\n.param R2={10/3*R1}\n.param R3=7k\n.param R4=6k\n;.step param R3 list 7k 7.5k
TEXT -656 -1440 Left 2 ;------------------------------------------------------------------------\nUa=Ue2 * (R1+R2)/R1 * R4/(R3+R4) - Ue1 * R2/R1\nUe1 * R2/R1 @ Ue1=3V  !=  10V  \n -->  R2=10/3*R1\n------------------------------------------------------------------------\nUe2* 13/3 * R4/(R3+R4) @ Ue2=2.5V (ref)  !=  +5V\n --> R4/(R3+R4)  !=  5V * 3/(13 * 2.5V)\n<--> (R3+R4)/R4  !=  13/6\n--> R3=7a   R4=6a     a el. |R\n------------------------------------------------------------------------
TEXT -872 -1160 Left 2 !.param Ra=22k
TEXT -24 -1440 Left 2 ;powerstage
TEXT -1072 -560 Left 2 !.param pot1 = 10k\n.param set1 = 0.5
TEXT -1056 -608 Left 2 ;siehe MATLAB OpAmp_addierer_spannTeiler.m
TEXT -1080 -488 Left 2 !.param R10 = 1.4k\n;.step param R10 list 1.4k 1.421k
TEXT 824 -1304 Left 2 ;Position Demodulator\n2 deg / V\n \n---> +-10V @ +-20deg
TEXT 2120 -1064 VRight 2 ;xmega128a1 ADC mit Vref=3V
TEXT 1632 -1368 Left 2 ;20Vpp --> 3Vpp
TEXT 2120 -416 VRight 2 ;xmega128a1 DAC \nzur offset feintrimmung
TEXT 1040 -936 Left 2 ;.param Ra=18k\n.param Rs=1k
TEXT 192 -256 Left 2 ;(u1*R2*R5+u2*R1*R5+u5*R1*R2)*R3/(R4*(R1*R2+R5*(R1+R2))) + (u1*R2*R5+u2*R1*R5+u5*R1*R2)/(R1*R2+R5*(R1+R2))==ua\nua=u1+u2+u5/5
TEXT 928 -480 Left 2 ;R5=R18 || R19
TEXT 1528 -944 Left 2 ;Butterworth/Sallenkey\nFg=28kHz Unity gain
TEXT 1936 -848 Left 2 ;BAT42
TEXT 1320 -496 Left 2 !.param c3=1e-15\n;.step param c3 list 1e-15 10n
TEXT 1520 -1008 Left 2 !.param n=0.1\n;.step param n list 0.1 1
TEXT 544 -1408 Left 2 !.tran 8m
TEXT -1856 -976 Left 2 ;PULSE(0 3 2m 10n 10n 500u 1m)
TEXT -224 -1552 Left 2 !.include OPA404.LIB
TEXT -224 -1528 Left 2 !.include LM358.lib
LINE Normal -48 -464 -48 -1480 2
LINE Normal -1472 -432 -1472 -1456 2
LINE Normal 128 -464 128 -1480 2
LINE Normal 2080 -304 2080 -1104 2
RECTANGLE Normal -848 -704 -1008 -1072 2
RECTANGLE Normal 1296 -496 944 -608 2
