Version 4
SHEET 1 4496 6248
WIRE 672 -640 624 -640
WIRE 848 -624 768 -624
WIRE 624 -592 624 -640
WIRE 672 -576 672 -640
WIRE 768 -576 768 -624
WIRE 848 -496 848 -624
WIRE 848 -496 800 -496
WIRE 624 -448 624 -496
WIRE 768 -432 768 -480
WIRE 768 -416 768 -432
WIRE 1184 -384 1184 -464
WIRE 1552 -384 1552 -464
WIRE 1232 -368 1216 -368
WIRE 1312 -368 1232 -368
WIRE 1456 -368 1312 -368
WIRE 1504 -368 1456 -368
WIRE 960 -320 960 -464
WIRE 1184 -240 1184 -288
WIRE 1312 -240 1312 -368
WIRE 1312 -240 1184 -240
WIRE 1184 -192 1184 -240
WIRE 1408 -144 1376 -144
WIRE 2048 -128 2048 -176
WIRE 2176 -128 2176 -176
WIRE 960 -112 960 -240
WIRE 1104 -112 960 -112
WIRE 1136 -112 1104 -112
WIRE 1184 -80 1184 -96
WIRE 1408 -80 1376 -80
WIRE 2368 -80 2352 -80
WIRE 2512 -80 2496 -80
WIRE 2784 -64 2768 -64
WIRE 960 -48 960 -112
WIRE 1184 -48 1184 -80
WIRE 2368 -48 2368 -80
WIRE 2496 -48 2496 -80
WIRE 912 -32 864 -32
WIRE 2048 -32 2048 -48
WIRE 2176 -32 2176 -48
WIRE 2176 -32 2048 -32
WIRE 2048 -16 2048 -32
WIRE 2784 -16 2784 -64
WIRE 2960 32 2960 -16
WIRE 960 64 960 48
WIRE 1184 80 1184 32
WIRE 1200 80 1184 80
WIRE 1328 80 1280 80
WIRE 1392 80 1328 80
WIRE 1552 80 1552 -288
WIRE 1552 80 1472 80
WIRE 1664 80 1552 80
WIRE 1840 80 1664 80
WIRE 2368 80 2368 32
WIRE 2496 80 2496 32
WIRE 960 96 960 64
WIRE 864 112 864 -32
WIRE 864 112 688 112
WIRE 2784 112 2784 64
WIRE 2896 112 2784 112
WIRE 2912 112 2896 112
WIRE 1040 128 1040 112
WIRE 1328 128 1328 80
WIRE 1840 128 1840 80
WIRE 960 160 960 128
WIRE 1184 160 1184 80
WIRE 960 176 960 160
WIRE 2368 176 2368 160
WIRE 2432 176 2368 176
WIRE 2496 176 2496 160
WIRE 2496 176 2432 176
WIRE 2784 176 2784 112
WIRE 2736 192 2672 192
WIRE 1040 224 1040 208
WIRE 864 256 864 112
WIRE 912 256 864 256
WIRE 1328 256 1328 208
WIRE 1184 272 1184 240
WIRE 1840 272 1840 208
WIRE 2784 288 2784 272
WIRE 2784 288 2768 288
WIRE 2960 304 2960 128
WIRE 3040 304 2960 304
WIRE 3168 304 3040 304
WIRE 1184 320 1184 272
WIRE 960 336 960 272
WIRE 1104 336 960 336
WIRE 1136 336 1104 336
WIRE 2496 368 2448 368
WIRE 2544 368 2496 368
WIRE 2784 368 2768 368
WIRE 2784 384 2784 368
WIRE 1840 400 1840 352
WIRE 2544 400 2544 368
WIRE 2672 400 2672 192
WIRE 2672 400 2608 400
WIRE 2464 416 2448 416
WIRE 3168 416 3168 304
WIRE 960 432 960 336
WIRE 2448 432 2448 416
WIRE 2240 448 2208 448
WIRE 2288 448 2240 448
WIRE 2416 448 2368 448
WIRE 784 464 784 448
WIRE 2544 464 2480 464
WIRE 2672 464 2672 400
WIRE 2672 464 2608 464
WIRE 2736 464 2672 464
WIRE 784 480 784 464
WIRE 1184 480 1184 416
WIRE 1296 480 1184 480
WIRE 2416 480 2400 480
WIRE 576 496 528 496
WIRE 624 496 576 496
WIRE 752 496 704 496
WIRE 800 512 768 512
WIRE 816 512 800 512
WIRE 912 512 912 496
WIRE 912 512 816 512
WIRE 1184 512 1184 480
WIRE 1552 512 1552 80
WIRE 2448 512 2448 496
WIRE 2464 512 2448 512
WIRE 752 528 736 528
WIRE 2960 544 2960 304
WIRE 3168 544 3168 496
WIRE 2784 560 2784 480
WIRE 2896 560 2784 560
WIRE 2912 560 2896 560
WIRE 528 576 528 496
WIRE 784 576 784 544
WIRE 1296 592 1296 480
WIRE 1296 592 1232 592
WIRE 1472 592 1296 592
WIRE 1504 592 1472 592
WIRE 2784 608 2784 560
WIRE 2400 640 2400 480
WIRE 736 656 736 528
WIRE 736 656 720 656
WIRE 768 656 736 656
WIRE 848 656 800 656
WIRE 912 656 912 512
WIRE 912 656 848 656
WIRE 1184 672 1184 608
WIRE 1552 672 1552 608
WIRE 3168 672 3168 624
WIRE 736 688 736 656
WIRE 960 688 960 512
WIRE 2960 688 2960 640
WIRE 528 704 528 656
WIRE 2400 752 2400 720
WIRE 2784 752 2784 688
WIRE 2784 752 2768 752
WIRE 736 800 736 768
WIRE 1776 800 1616 800
WIRE 1616 848 1616 800
WIRE 1616 864 1616 848
WIRE 1776 896 1776 800
WIRE 1536 928 1488 928
WIRE 1568 928 1536 928
WIRE 1488 960 1488 928
WIRE 1616 976 1616 944
WIRE 1488 1056 1488 1040
FLAG 2048 -16 0
FLAG 2048 -176 Vplus
FLAG 2176 -176 Vmin
FLAG 528 704 0
FLAG 784 464 Vplus
FLAG 784 576 Vmin
FLAG 1664 80 out_A
FLAG 576 496 stim
FLAG 800 512 opOut
FLAG 736 800 0
FLAG 688 112 stim
FLAG 1552 -464 Vplus
FLAG 1552 672 Vmin
FLAG 1328 256 0
FLAG 960 688 VminC
FLAG 1040 224 0
FLAG 1104 -112 G4
FLAG 1104 336 G5
FLAG 1184 -80 S4
FLAG 1184 272 S5
FLAG 960 -464 VplusC
FLAG 1456 -368 G2
FLAG 1472 592 G1
FLAG 960 160 VplusC
FLAG 960 64 VminC
FLAG 624 -448 0
FLAG 784 -448 0
FLAG 768 -432 0
FLAG 1776 976 0
FLAG 1616 976 0
FLAG 1488 1056 0
FLAG 1536 928 Gt
FLAG 1840 400 0
FLAG 1184 -464 VplusC
FLAG 1184 672 VminC
FLAG 1408 -144 VplusC
FLAG 1408 -80 VminC
FLAG 3168 672 0
FLAG 3040 304 out_fet
FLAG 2784 752 V-drv
FLAG 2896 112 Gph
FLAG 2896 560 Gpl
FLAG 2448 416 VplusC
FLAG 2448 512 VminC
FLAG 2240 448 stim
FLAG 2400 752 0
FLAG 2496 368 stim
FLAG 2432 176 0
FLAG 2368 -80 V+drv
FLAG 2496 -80 V-drv
FLAG 2784 -64 V+drv
FLAG 2784 288 V-drv
FLAG 2784 368 V+drv
SYMBOL voltage 2048 -144 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value 30
SYMBOL voltage 2176 -144 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V7
SYMATTR Value -30
SYMBOL voltage 528 560 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value2 AC 1
SYMATTR InstName V8
SYMATTR Value PULSE(-5 5 0 10n 10n 1m 2m)
SYMBOL nmos 1504 512 R0
SYMATTR InstName M1
SYMATTR Value IRFP240
SYMBOL pmos 1504 -288 M180
SYMATTR InstName M2
SYMATTR Value IRF9640
SYMBOL res 608 512 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res 1824 256 R0
SYMATTR InstName Rcc
SYMATTR Value 1.5
SYMBOL ind 1824 112 R0
SYMATTR InstName L1
SYMATTR Value 170µ
SYMBOL Opamps\\opamp2 784 448 R0
SYMATTR InstName U4
SYMATTR Value ada4700
SYMATTR SpiceModel ada4700
SYMBOL res 720 672 R0
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res 864 640 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 100t
SYMBOL pmos 672 -496 R180
SYMATTR InstName M7
SYMATTR Value BSS84
SYMBOL res 1488 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res 1344 224 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R4
SYMATTR Value 100
SYMBOL current 960 -320 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I1
SYMATTR Value {I1}
SYMBOL current 960 432 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I2
SYMATTR Value {I1}
SYMBOL res 1184 96 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value 1µ
SYMBOL res 1024 112 R0
WINDOW 3 25 11 Left 2
SYMATTR Value 10meg
SYMATTR InstName R7
SYMBOL res 1200 256 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R8
SYMATTR Value 1µ
SYMBOL res 1168 -64 R0
SYMATTR InstName R9
SYMATTR Value 1µ
SYMBOL nmos 1136 -192 R0
SYMATTR InstName M5
SYMATTR Value nmosA
SYMBOL nmos 1568 848 R0
SYMATTR InstName M6
SYMATTR Value IRFP240
SYMBOL voltage 1776 880 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL voltage 1488 944 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 5
SYMBOL pmos 912 48 M180
SYMATTR InstName M4
SYMATTR Value BSS84
SYMBOL pmos 1136 416 M180
SYMATTR InstName M3
SYMATTR Value pmosA
SYMBOL pmos 1232 -288 R180
SYMATTR InstName M9
SYMATTR Value pmosA
SYMBOL nmos 912 176 R0
SYMATTR InstName M8
SYMATTR Value nmosA
SYMBOL nmos 1232 512 M0
SYMATTR InstName M10
SYMATTR Value nmosA
SYMBOL source-Vmarker 1376 -144 R0
SYMATTR Value V=40V
SYMATTR InstName U1
SYMBOL source-Vmarker 1376 -80 R0
SYMATTR Value V=-40V
SYMATTR InstName U2
SYMBOL pmos 2912 640 M180
SYMATTR InstName M11
SYMATTR Value IRF9640
SYMBOL nmos 2912 32 R0
SYMATTR InstName M12
SYMATTR Value IRFP240
SYMBOL nmos 2736 384 R0
SYMATTR InstName M13
SYMATTR Value BSS145
SYMBOL pmos 2736 272 M180
SYMATTR InstName M14
SYMATTR Value BSS84
SYMBOL current 2784 -16 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I3
SYMATTR Value {ictrl}
SYMBOL current 2784 608 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I4
SYMATTR Value {ictrl}
SYMBOL source-Vmarker 2960 688 R0
SYMATTR Value V=-30V
SYMATTR InstName U5
SYMBOL source-Vmarker 2960 -16 R0
SYMATTR Value V=30V
SYMATTR InstName U7
SYMBOL res 3152 528 R0
SYMATTR InstName R5
SYMATTR Value 1.51
SYMBOL ind 3152 400 R0
SYMATTR InstName L2
SYMATTR Value 170µ
SYMBOL res 2272 464 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL Opamps\\opamp2 2448 400 R0
SYMATTR InstName U8
SYMATTR Value ada4700
SYMATTR SpiceModel ada4700
SYMBOL res 2384 624 R0
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL Misc\\jumper 2576 336 R0
SYMATTR InstName X3
SYMBOL voltage 2368 64 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value 30V
SYMBOL voltage 2496 64 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value -30
SYMBOL voltage 2368 -64 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value {10V*hv}
SYMBOL voltage 2496 -64 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V9
SYMATTR Value {-10V*hv}
TEXT 808 -592 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/ADA4700.sub
TEXT 808 -560 Left 2 !.inc /home/mainster/.wine/drive_c/Program Files (x86)/LTC_orig/LTspiceIV_4.18/lib/sub/LM358.sub
TEXT 584 -384 Left 2 !.param I1 = 0.8m\n.param bias = 30\n.param Rs = 1u\n.param vsup = 20\n.param poti = 10k\n.param set = 0.5\n.param Rll = 5k\n.param FT = 10meg
TEXT 760 1064 Left 2 ;.step param set 0.1 0.9 0.25
TEXT 1704 -96 Left 2 !;ac oct 100 1 10meg
TEXT 2664 -160 Left 2 !.tran 5m
TEXT 976 72 Left 2 ;???
TEXT 1672 -496 Left 2 !.model nmosA nmos (Kp=.2m VT0=2)\n.model pmosA pmos (Kp=.2m VT0=-2)\n.model nmosP nmos (Kp=3 VT0=4)\n.model pmosP pmos (Kp=-3 VT0=-4)
TEXT 1560 1040 Left 2 ;----------------------------------------\nIRFP240\n----------------------------------------\nId = K * (Ugs - Vp)^2\nVT0 =^ Vp\nKP = 2*K\n--->\nK = Id / (Ugs - Vp)^2\n--------------------------------------------\n2.718 A/V = 348mA / (4.36V - 4V)^2\n--------------------------------------------\nId(M6) ~= (2.718A/(1V**2))*(V(Gt)-4V)**2\nId(M6) = (Id(M6)/(V(Gt)-4V)**2)*(V(Gt)-4V)**2\nK = Id(M6)/(V(Gt)-4V)**2
TEXT 1592 -296 Left 2 ;IRFP9240\nKp = 8.2 (spice)\n--> K = 0.5*8.2 = 4.1
TEXT 1600 632 Left 2 ;IRFP240\nKp = 4.9 (spice)\n--> K = 0.5*4.9 = 2.45
TEXT 1032 8 Left 2 ;BSS84
TEXT 984 272 Left 2 ;BSS123
TEXT 96 -984 Left 2 ;.model IRF9640 VDMOS(pchan Rg=3 Vto=-3.5 Rd=.15 Rs=.15 Rb=.15 Kp=8 lambda=.01 mtriode=.5 Cgdmax=1.5n Cgdmin=.07n Cgs=1n Cjo=1n Is=38p mfg=International_Rectifier Vds=-200 Ron=.5 Qg=44n)\n.model IRFP9240 VDMOS(pchan Rg=3 Vto=-4 Rd=200m Rs=50m Rb=100m Kp=8.2 Lambda=.10 Cgdmax=1.8n Cgdmin=.07n Cgs=.77n Cjo=.77n Is=76p mfg=International_Rectifier Vds=-200 Ron=500m Qg=44n)\n.model IRFP240 VDMOS(Rg=3 Vto=4 Rd=72m Rs=18m Rb=36m Kp=4.9 Lambda=.03 Cgdmax=1.34n Cgdmin=.1n Cgs=1.25n Cjo=1.25n Is=67p mfg=International_Rectifier Vds=200 Ron=180m Qg=70n)\n.model IRFP250N VDMOS(Rg=1.44 Vto=4.0 Rd=47m Rs=0m Rb=5.6m Kp=13 Cgdmax=3.9n Cgdmin=0.10n Cgs=1.9n Cjo=1.25n Is=5p tt=186n mfg=International_Rectifier Vds=200 Ron=75m Qg=123n)
TEXT 648 1512 Left 2 ;.model IRFP240 VDMOS(Rg=3 Vto=4 Rd=72m Rs=18m Rb=36m Kp=4.9 Lambda=.03 Cgdmax=1.34n Cgdmin=.1n Cgs=1.25n Cjo=1.25n Is=67p mfg=International_Rectifier Vds=200 Ron=180m Qg=70n)\n.model IRFP250N VDMOS(Rg=1.44 Vto=4.0 Rd=47m Rs=0m Rb=5.6m Kp=13 Cgdmax=3.9n Cgdmin=0.10n Cgs=1.9n Cjo=1.25n Is=5p tt=186n mfg=International_Rectifier Vds=200 Ron=75m Qg=123n)
TEXT 1984 256 Left 2 !.param ictrl = 1m
TEXT 2368 216 Left 2 !.param hv=0
TEXT 2528 -136 Left 2 !.step param hv list 0 1
