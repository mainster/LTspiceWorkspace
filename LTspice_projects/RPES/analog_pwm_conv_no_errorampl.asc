Version 4
SHEET 1 880 2276
WIRE -800 784 -800 768
WIRE -1200 880 -1312 880
WIRE -1040 880 -1200 880
WIRE -624 880 -656 880
WIRE -592 880 -624 880
WIRE -1312 896 -1312 880
WIRE -960 896 -960 880
WIRE -1040 912 -1040 880
WIRE -992 912 -1040 912
WIRE -656 912 -656 880
WIRE -848 928 -928 928
WIRE -800 928 -800 864
WIRE -800 928 -848 928
WIRE -736 928 -800 928
WIRE -992 944 -1040 944
WIRE -1312 976 -1312 960
WIRE -1040 976 -1040 944
WIRE -1040 976 -1200 976
WIRE -960 992 -960 960
WIRE -960 992 -976 992
WIRE -656 1008 -656 992
WIRE -864 1088 -864 1072
WIRE -1456 1104 -1504 1104
WIRE -1344 1104 -1376 1104
WIRE -1296 1104 -1344 1104
WIRE -1200 1104 -1200 976
WIRE -1200 1104 -1232 1104
WIRE -864 1168 -960 1168
WIRE -960 1184 -960 1168
WIRE -1344 1200 -1344 1104
WIRE -1312 1200 -1344 1200
WIRE -1424 1216 -1424 1200
WIRE -1200 1216 -1200 1104
WIRE -1200 1216 -1248 1216
WIRE -1360 1232 -1392 1232
WIRE -1312 1232 -1360 1232
WIRE -1504 1248 -1504 1104
WIRE -1456 1248 -1504 1248
WIRE -864 1248 -864 1168
WIRE -1360 1264 -1392 1264
WIRE -960 1280 -960 1264
WIRE -896 1280 -960 1280
WIRE -1440 1296 -1440 1280
WIRE -1424 1296 -1424 1280
WIRE -1424 1296 -1440 1296
WIRE -1424 1312 -1424 1296
WIRE -960 1328 -960 1280
WIRE -1504 1376 -1504 1248
WIRE -1472 1376 -1504 1376
WIRE -1360 1376 -1360 1264
WIRE -1360 1376 -1392 1376
WIRE -1328 1376 -1360 1376
WIRE -1200 1376 -1200 1216
WIRE -1200 1376 -1248 1376
WIRE -960 1424 -960 1408
WIRE -864 1424 -864 1312
WIRE -496 1440 -544 1440
WIRE -688 1456 -704 1456
WIRE -608 1456 -688 1456
WIRE -512 1472 -544 1472
WIRE -2240 1584 -2288 1584
WIRE -2208 1584 -2240 1584
WIRE -2080 1584 -2128 1584
WIRE -2048 1584 -2080 1584
WIRE -1920 1584 -1968 1584
WIRE -1888 1584 -1920 1584
WIRE -1760 1584 -1808 1584
WIRE -1728 1584 -1760 1584
WIRE -1392 1584 -1456 1584
WIRE -1376 1584 -1392 1584
WIRE -1152 1584 -1184 1584
WIRE -1040 1584 -1072 1584
WIRE -992 1584 -1040 1584
WIRE -960 1584 -992 1584
WIRE -1456 1600 -1456 1584
WIRE -2288 1616 -2288 1584
WIRE -2128 1616 -2128 1584
WIRE -1968 1616 -1968 1584
WIRE -1808 1616 -1808 1584
WIRE -1040 1616 -1040 1584
WIRE -752 1632 -784 1632
WIRE -736 1632 -752 1632
WIRE -752 1680 -784 1680
WIRE -736 1680 -752 1680
WIRE -2288 1712 -2288 1696
WIRE -2128 1712 -2128 1696
WIRE -1968 1712 -1968 1696
WIRE -1808 1712 -1808 1696
WIRE -1456 1712 -1456 1680
WIRE -1040 1712 -1040 1680
WIRE -1392 1776 -1456 1776
WIRE -1376 1776 -1392 1776
WIRE -1760 1792 -1808 1792
WIRE -1728 1792 -1760 1792
WIRE -1584 1792 -1616 1792
WIRE -1568 1792 -1584 1792
WIRE -1456 1792 -1456 1776
WIRE -1808 1824 -1808 1792
WIRE -1616 1824 -1616 1792
WIRE -1456 1904 -1456 1872
WIRE -1808 1920 -1808 1904
WIRE -1616 1920 -1616 1904
FLAG -1040 1712 0
FLAG -992 1584 pwfil2
FLAG -1184 1584 0
FLAG -1424 1312 0
FLAG -1360 1232 vref
FLAG -752 1632 vref
FLAG -1280 1248 0
FLAG -2128 1712 0
FLAG -2080 1584 R6_in_k
FLAG -1808 1712 0
FLAG -1760 1584 Vtri
FLAG -1968 1712 0
FLAG -1920 1584 R5_in_k
FLAG -2288 1712 0
FLAG -2240 1584 R7_in_k
FLAG -960 880 0
FLAG -1200 976 tri
FLAG -848 928 out
FLAG -1312 976 0
FLAG -1456 1712 0
FLAG -1392 1584 up
FLAG -1456 1904 0
FLAG -1392 1776 lo
FLAG -1616 1920 0
FLAG -1584 1792 Vrm
FLAG -752 1680 Vop
FLAG -1200 880 an1
FLAG -736 976 0
FLAG -656 1008 0
FLAG -624 880 lap
FLAG -1808 1920 0
FLAG -1760 1792 C3_in_uF
FLAG -976 992 Vop
FLAG -1424 1200 Vop
FLAG -1280 1184 Vop
FLAG -800 768 Vop
FLAG -864 1424 0
FLAG -960 1424 0
FLAG -864 1072 Vop
FLAG -576 1424 Vop
FLAG -560 1504 0
FLAG -592 1488 0
FLAG -688 1456 l33
FLAG -512 1472 0
SYMBOL res -1168 1600 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL cap -1056 1616 R0
SYMATTR InstName C6
SYMATTR Value 100n
SYMBOL SBORKA\\OPamp\\TLV3501 -1424 1184 M0
WINDOW 3 11 8 Left 2
SYMATTR InstName U16
SYMBOL res -1472 1120 R270
WINDOW 0 25 56 VTop 2
WINDOW 3 7 56 VBottom 2
SYMATTR InstName R21
SYMATTR Value {R7}
SYMBOL cap -1296 1120 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C7
SYMATTR Value {C3}
SYMBOL source-Vmarker -784 1632 R0
WINDOW 3 -61 -2 Center 2
SYMATTR Value V={Vref}
SYMATTR InstName U17
SYMBOL EXTRA\\AudioOpamp\\TI\\OPA2613_TI -1280 1216 R0
WINDOW 3 -43 71 Left 2
SYMATTR InstName U18
SYMBOL source-V -2128 1600 R0
WINDOW 3 36 62 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value {R6*1e-3}
SYMATTR InstName V5
SYMBOL res -1376 1360 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R22
SYMATTR Value {R6-set*2k}
SYMBOL res -1232 1360 R90
WINDOW 0 7 56 VBottom 2
WINDOW 3 25 56 VTop 2
SYMATTR InstName R23
SYMATTR Value {R5-set*2k}
SYMBOL source-V -1808 1600 R0
WINDOW 3 36 62 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value {R5/R6*Vrm}
SYMATTR InstName V6
SYMBOL source-V -1968 1600 R0
WINDOW 3 36 62 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value {R5*1e-3}
SYMATTR InstName V7
SYMBOL source-V -2288 1600 R0
WINDOW 3 36 62 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value {R7*1e-3}
SYMATTR InstName V8
SYMBOL SBORKA\\COMPARATOR\\lm393 -960 928 M180
WINDOW 0 15 -24 Left 2
WINDOW 38 8 25 Left 2
SYMATTR InstName U4
SYMBOL res -784 768 M0
SYMATTR InstName R12
SYMATTR Value 10k
SYMBOL source-V -1312 880 R0
WINDOW 3 -220 140 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value SINE({Vref} 4 {fan})
SYMATTR InstName V1
SYMBOL bv -1456 1584 R0
SYMATTR InstName B1
SYMATTR Value V=V(vtri)+V(Vrm)
SYMBOL bv -1456 1776 R0
SYMATTR InstName B2
SYMATTR Value V=-(V(vtri)-V(Vrm))
SYMBOL source-V -1616 1808 R0
WINDOW 3 36 62 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value {Vrm}
SYMATTR InstName V9
SYMBOL source-Vmarker -784 1680 R0
WINDOW 3 -61 -2 Center 2
SYMATTR Value V={Vop}
SYMATTR InstName U1
SYMBOL crtl-V-V -656 896 R0
SYMATTR InstName E1
SYMATTR Value laplace=1/(s/(2*pi*fc)+1)**4
SYMBOL source-V -1808 1808 R0
WINDOW 3 36 62 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value {C3*1e6}
SYMATTR InstName V3
SYMBOL SBORKA\\REF\\tlv431_on -880 1248 R0
SYMATTR InstName U2
SYMBOL res -880 1072 R0
SYMATTR InstName R1
SYMATTR Value 590
SYMBOL res -976 1312 R0
SYMATTR InstName R2
SYMATTR Value 5.6k
SYMBOL res -976 1168 R0
WINDOW 3 -159 57 Left 2
SYMATTR Value {18k+set*10k}
SYMATTR InstName R3
SYMBOL EXTRA\\ExtraComparators\\LM311_TI -576 1456 M0
SYMATTR InstName U3
SYMBOL source-Vmarker -496 1440 M0
WINDOW 3 -72 3 Center 2
SYMATTR Value V=5
SYMATTR InstName U5
TEXT -1560 1432 Left 2 ;Triangle wave gen
TEXT -1136 808 Left 2 ;Comparator
TEXT -2320 744 Left 2 !.param Vop = 10V\n; --------------------------\n; Vtri = R5/R6*Vrm\n; --------------------------\n; In this equation, Vrm is the comparator output voltage \n; above or below the reference voltage. For example, in\n; our system the comparator output will be either 5V or \n; 0V. Because this circuit employs a 2.5V reference, Vrm\n; is equal to 2.5V\n.param Vrm = {Vop - Vref}\n;.param Vrm = 5\n \n.param Vref = 5V\n \n.param R6 = 20k    ; oder größer\n.param Vtri = 6V     ; gewünschtes Vpeak für trig\n.param R5 = {(Vtri*R6)/Vrm}\n; --------------------------\n; somit kann bei AnalogIn=[-2...2V] niemals \n; p=100%  erreicht werden!!\n \n; PWM frequenz festlegen\n; --------------------------\n.param C3 = 150n\n.param ft = 500\n.param R7 = {R6/ ( ft*4*R5*C3 )}
TEXT -2320 664 Left 2 !.tran {1/fan} uic
TEXT -2320 688 Left 2 !.options plotwinsize = 0
TEXT -1912 664 Left 2 !.param fan = 10
TEXT -2352 1752 Left 2 !.model mysw SW(Ron=1m Roff=100Meg Vt=0 Vh=-.5 )
TEXT -584 1056 Left 2 !.param fc = 50
TEXT -1568 816 Left 2 ;SINE({Vrm} {0.95*Vtri} {fan})
TEXT -672 1224 Left 2 !.param set = 1
TEXT -672 1280 Left 2 ;.step param set list 0 1
RECTANGLE Normal -1168 1456 -1568 1056 2
RECTANGLE Normal -1656 1480 -2344 632 2
RECTANGLE Normal -880 1024 -1152 784 2
